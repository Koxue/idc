<?php  function D(array $config=array()){ static $conn; if($config!==array()) $conn=new swapsql($config['MYSQL_HOST'].':'.$config['MYSQL_PORT'],$config['MYSQL_USER'],$config['MYSQL_PWD'],$config['MYSQL_NAME'],'swapidc','UTF8'); return $conn; } class swapsql { private $OSWAP_678f572ec0a4b546030b3200235371a9; private $OSWAP_5cbd785dc3074320ddcbd3758b9f6d86; private $OSWAP_b1c304f564d5e61d5af46360316475ab; private $OSWAP_ac9eb06e3fa35f20d40ad29e510b40f8; private $conn; private $OSWAP_2e29d37ed05a8087327b406a5df9d569; private $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e; private $OSWAP_51d4cad9672e6605c99e0c3d678f456e; private $OSWAP_bcaf1b3ec3249a36908603ca28b43c7a; public function __construct($OSWAP_678f572ec0a4b546030b3200235371a9, $OSWAP_5cbd785dc3074320ddcbd3758b9f6d86, $OSWAP_b1c304f564d5e61d5af46360316475ab, $OSWAP_ac9eb06e3fa35f20d40ad29e510b40f8, $conn, $OSWAP_bcaf1b3ec3249a36908603ca28b43c7a) { $this->OSWAP_678f572ec0a4b546030b3200235371a9 = $OSWAP_678f572ec0a4b546030b3200235371a9; $this->OSWAP_5cbd785dc3074320ddcbd3758b9f6d86 = $OSWAP_5cbd785dc3074320ddcbd3758b9f6d86; $this->OSWAP_b1c304f564d5e61d5af46360316475ab = $OSWAP_b1c304f564d5e61d5af46360316475ab; $this->OSWAP_ac9eb06e3fa35f20d40ad29e510b40f8 = $OSWAP_ac9eb06e3fa35f20d40ad29e510b40f8; $this->conn = $conn; $this->OSWAP_bcaf1b3ec3249a36908603ca28b43c7a = $OSWAP_bcaf1b3ec3249a36908603ca28b43c7a; $this->connect(); $this->query("set time_zone = '+8:00';"); $this->query("SET sql_mode='NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';"); } public function connect() { if(class_exists('mysqli')){ $OSWAP_a416a4b07b6f280c968f2f3bb53948d5=explode(':',$this->OSWAP_678f572ec0a4b546030b3200235371a9); $this->conn = new mysqli($OSWAP_a416a4b07b6f280c968f2f3bb53948d5[0],$this->OSWAP_5cbd785dc3074320ddcbd3758b9f6d86,$this->OSWAP_b1c304f564d5e61d5af46360316475ab,$this->OSWAP_ac9eb06e3fa35f20d40ad29e510b40f8,$OSWAP_a416a4b07b6f280c968f2f3bb53948d5[1]); if(!$this->conn) $this->show_error('数据库连接或者登陆失败',mysqli_connect_error()); $this->conn->query("SET NAMES ".$this->OSWAP_bcaf1b3ec3249a36908603ca28b43c7a); }else{ if ($this->conn == "pconn") { if(!$this->conn = @mysql_pconnect($this->OSWAP_678f572ec0a4b546030b3200235371a9, $this->OSWAP_5cbd785dc3074320ddcbd3758b9f6d86, $this->OSWAP_b1c304f564d5e61d5af46360316475ab)){ $this->show_error('数据库连接或者登陆失败',mysql_error($this->conn)); } } else { if(!$this->conn = @mysql_connect($this->OSWAP_678f572ec0a4b546030b3200235371a9, $this->OSWAP_5cbd785dc3074320ddcbd3758b9f6d86, $this->OSWAP_b1c304f564d5e61d5af46360316475ab)){ $this->show_error('数据库连接或者登陆失败',mysql_error($this->conn)); } } if (!mysql_select_db($this->OSWAP_ac9eb06e3fa35f20d40ad29e510b40f8, $this->conn)) { die(swap_main_error_module('数据库错误','数据库不可用')); } mysql_query("SET NAMES ".$this->OSWAP_bcaf1b3ec3249a36908603ca28b43c7a,$this->conn); } } public function query($OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e) { static $ss; if ($OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e == "") { $this->show_error("SQL语句错误", "SQL查询语句为空"); } $this->OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e = $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e.';'; if(!$this->conn) $this->connect(); if(class_exists('mysqli')){ $OSWAP_2e29d37ed05a8087327b406a5df9d569 = $this->conn->query($this->OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e); }else{ $OSWAP_2e29d37ed05a8087327b406a5df9d569 = mysql_query($this->OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e, $this->conn); } if (!$OSWAP_2e29d37ed05a8087327b406a5df9d569) { if(class_exists('mysqli')) $OSWAP_f268be7bf536705b15b92a6f559c8ff4=mysqli_errno($this->conn); else $OSWAP_f268be7bf536705b15b92a6f559c8ff4=mysql_errno($this->conn); if($OSWAP_f268be7bf536705b15b92a6f559c8ff4=='1366') $this->show_error('您数据库不支持SWAP系统,您需要找到您数据库的my.ini,把my.ini里的sql-mode="STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION"这句话修改成sql-mode="NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION"',''); else $this->show_error("错误SQL语句", $OSWAP_f268be7bf536705b15b92a6f559c8ff4.' : '.$this->OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e); } else { $this->OSWAP_2e29d37ed05a8087327b406a5df9d569 = $OSWAP_2e29d37ed05a8087327b406a5df9d569; } return $this->OSWAP_2e29d37ed05a8087327b406a5df9d569; } public function create_database($OSWAP_7965ea9b51917cb407fccb4ce1a0a4d6) { $OSWAP_dc19dc54c784278123e7446e9d6ff7f7 = $OSWAP_7965ea9b51917cb407fccb4ce1a0a4d6; $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eDatabase = 'create database ' . $OSWAP_dc19dc54c784278123e7446e9d6ff7f7; $this->query($OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eDatabase); } public function databases() { $OSWAP_0bee02af3f6e7e00d2aa3b3578db5a45 = $this->query("show databases"); $i = 0; if(class_exists('mysqli')) $OSWAP_5f712bd4681a12634752c64e3ab3ed55 = mysqli_num_rows($OSWAP_0bee02af3f6e7e00d2aa3b3578db5a45); else $OSWAP_5f712bd4681a12634752c64e3ab3ed55 = mysql_num_rows($OSWAP_0bee02af3f6e7e00d2aa3b3578db5a45); while ($i < $OSWAP_5f712bd4681a12634752c64e3ab3ed55) { if(class_exists('mysqli')){ $OSWAP_51d4cad9672e6605c99e0c3d678f456e=$this->fetch_array($OSWAP_0bee02af3f6e7e00d2aa3b3578db5a45); $rs[] = $OSWAP_51d4cad9672e6605c99e0c3d678f456e['Database']; }else{ $rs[] = mysql_db_name($OSWAP_0bee02af3f6e7e00d2aa3b3578db5a45, $i); } $i++; } return $rs; } public function fetch_array($OSWAP_2e29d37ed05a8087327b406a5df9d569t="") { if($OSWAP_2e29d37ed05a8087327b406a5df9d569t<>""){ if(class_exists('mysqli')) return @mysqli_fetch_array($OSWAP_2e29d37ed05a8087327b406a5df9d569t); else return @mysql_fetch_array($OSWAP_2e29d37ed05a8087327b406a5df9d569t); }else{ if(class_exists('mysqli')) return @mysqli_fetch_array($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); else return @mysql_fetch_array($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); } } public function fetch_assoc() { if(class_exists('mysqli')) return mysqli_fetch_assoc($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); else return mysql_fetch_assoc($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); } public function fetch_row() { if(class_exists('mysqli')) return mysqli_fetch_row($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); else return mysql_fetch_row($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); } public function fetch_Object() { if(class_exists('mysqli')) return mysqli_fetch_object($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); else return mysql_fetch_object($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); } public function findall($OSWAP_24da90866e123b1307e0d0715d87665b) { $this->query("SELECT * FROM $OSWAP_24da90866e123b1307e0d0715d87665b"); } public function select($OSWAP_24da90866e123b1307e0d0715d87665b, $OSWAP_72758d583b9247185b8fed1816b80da7 = "*", $condition = '', $debug = '') { $condition = $condition ? ' Where ' . $condition : NULL; if ($debug) { echo "SELECT $OSWAP_72758d583b9247185b8fed1816b80da7 FROM $OSWAP_24da90866e123b1307e0d0715d87665b $condition"; } else { $this->query("SELECT $OSWAP_72758d583b9247185b8fed1816b80da7 FROM $OSWAP_24da90866e123b1307e0d0715d87665b $condition"); } } public function delete($OSWAP_24da90866e123b1307e0d0715d87665b, $condition) { if ($this->query("DELETE FROM $OSWAP_24da90866e123b1307e0d0715d87665b WHERE $condition")) return true; else return false; } public function insert($OSWAP_24da90866e123b1307e0d0715d87665b, $OSWAP_72758d583b9247185b8fed1816b80da7, $OSWAP_31bb5897a4cf8155e2d7054f8ef132dd) { if ($this->query("INSERT INTO $OSWAP_24da90866e123b1307e0d0715d87665b ($OSWAP_72758d583b9247185b8fed1816b80da7) VALUES ($OSWAP_31bb5897a4cf8155e2d7054f8ef132dd)")) return true; else return false; } public function update($OSWAP_24da90866e123b1307e0d0715d87665b, $OSWAP_f362483dc70a2ca824c4fc3b9134899b, $condition) { if ($this->query("UPDATE $OSWAP_24da90866e123b1307e0d0715d87665b SET $OSWAP_f362483dc70a2ca824c4fc3b9134899b WHERE $condition")) return true; else return false; } public function insert_id() { if(class_exists('mysqli')) return mysqli_insert_id($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); else return mysql_insert_id($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); } public function db_data_seek($id) { if ($id > 0) { $id = $id -1; } if(class_exists('mysqli')) $re=@mysqli_data_seek($this->OSWAP_2e29d37ed05a8087327b406a5df9d569, $id); else $re=@mysql_data_seek($this->OSWAP_2e29d37ed05a8087327b406a5df9d569, $id); if (!$re) { $this->show_error("SQL语句有误", "指定的数据为空"); } return $this->OSWAP_2e29d37ed05a8087327b406a5df9d569; } public function db_num_rows() { if ($this->OSWAP_2e29d37ed05a8087327b406a5df9d569 == null) { $this->show_error("SQL语句错误", "暂时为空，没有任何内容！"); } else { if(class_exists('mysqli')) return mysqli_num_rows($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); else return mysql_num_rows($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); } } public function num_rows() { return $this->db_num_rows(); } public function db_affected_rows() { if(class_exists('mysqli')) return mysqli_affected_rows($this->conn); else return mysql_affected_rows($this->conn); } public function show_error($OSWAP_e944d3dfbac154a6a70ca38a065998b0 = "", $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e = "") { die(swap_main_error_module($OSWAP_e944d3dfbac154a6a70ca38a065998b0,$OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e)); } public function free() { if(class_exists('mysqli')) @mysqli_free_result($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); else @mysql_free_result($this->OSWAP_2e29d37ed05a8087327b406a5df9d569); } public function select_db($OSWAP_ac9eb06e3fa35f20d40ad29e510b40f8) { if(class_exists('mysqli')) return mysqli_select_db($this->conn,$OSWAP_ac9eb06e3fa35f20d40ad29e510b40f8); else return mysql_select_db($OSWAP_ac9eb06e3fa35f20d40ad29e510b40f8,$this->conn); } public function mysql_server($OSWAP_b5966f537cc8e7710cdb306ca68f8f18 = '') { switch ($OSWAP_b5966f537cc8e7710cdb306ca68f8f18) { case 1 : if(class_exists('mysqli')) return mysqli_get_server_info($this->conn); else return mysql_get_server_info($this->conn); break; case 2 : if(class_exists('mysqli')) return mysqli_get_host_info($this->conn); else return mysql_get_host_info($this->conn); break; case 3 : if(class_exists('mysqli')) return mysqli_get_client_info($this->conn); else return mysql_get_client_info($this->conn); break; case 4 : if(class_exists('mysqli')) return mysqli_get_proto_info($this->conn); else return mysql_get_proto_info($this->conn); break; default : if(class_exists('mysqli')) return mysqli_get_client_info($this->conn); else return mysql_get_client_info($this->conn); } } public function __destruct() { if(class_exists('mysqli')) $this->conn->close(); else @mysql_close($this->conn); } public function getid() { if(class_exists('mysqli')) return mysqli_insert_id($this->conn); else return mysql_insert_id($this->conn); } public function real_escape_string($OSWAP_b4286e5146d43ef77059871dce9c8fee) { if(class_exists('mysqli')) return mysqli_real_escape_string($this->conn,$OSWAP_b4286e5146d43ef77059871dce9c8fee); else return mysql_real_escape_string($this->conn,$OSWAP_b4286e5146d43ef77059871dce9c8fee); } } 