<?php  abstract class SWAPOauth{ protected $OSWAP_768b2daf114423fcb03e8f62604fc346 = '2.0'; protected $OSWAP_b0de71ed04656e7487be91e612b38d1f = ''; protected $OSWAP_b49497e74dfd183be84caf631c684ca3 = ''; protected $OSWAP_9f98569ba14d1523a581f90d4e30130b = 'code'; protected $OSWAP_356e383a42015689b910ea4539ca6758 = 'authorization_code'; protected $OSWAP_e94566f26da1237080a4a6b49640e4fd = ''; protected $OSWAP_3e9c20ea6e975c5580b078bf52cc1fab = ''; protected $OSWAP_733853c9a76f3f1a18cbbc638cdce6b1 = ''; protected $OSWAP_b8aa71919428a0411ddc917a8e1f9f73 = ''; protected $OSWAP_c1910d287b29a69ea2e85cfae9b899a7 = ''; protected $OSWAP_ccc2685f3c4feb80847c04b6676e2537 = null; private $OSWAP_c75ea562113451e694de0262eb2db2b8 = ''; public function __construct($OSWAP_68f0083ae1729052fe2f7baaa791b6ba = null){ $OSWAP_056e74fcfee629a0932fd34940fa2e1b = get_class($this); $this->OSWAP_c75ea562113451e694de0262eb2db2b8 = strtoupper(substr($OSWAP_056e74fcfee629a0932fd34940fa2e1b, 0, strlen($OSWAP_056e74fcfee629a0932fd34940fa2e1b)-3)); $config = sdk_get_config($this->OSWAP_c75ea562113451e694de0262eb2db2b8); if(empty($config['APP_KEY']) || empty($config['APP_SECRET'])){ swap_main_error_module('SWAPOauth错误:','请配置您申请的APP_KEY和APP_SECRET'); } else { $this->OSWAP_b0de71ed04656e7487be91e612b38d1f = $config['APP_KEY']; $this->OSWAP_b49497e74dfd183be84caf631c684ca3 = $config['APP_SECRET']; $this->OSWAP_ccc2685f3c4feb80847c04b6676e2537 = $OSWAP_68f0083ae1729052fe2f7baaa791b6ba; } } public static function getInstance($OSWAP_5bed70325152f4f084fa2ddcf96f4b8b, $OSWAP_68f0083ae1729052fe2f7baaa791b6ba = null) { $OSWAP_0d07de59261cc2c9023b194184c575fb = ucfirst(strtolower($OSWAP_5bed70325152f4f084fa2ddcf96f4b8b)) . 'SDK'; require_once SWAP_LIB."sdk/{$OSWAP_0d07de59261cc2c9023b194184c575fb}.class.php"; if (class_exists($OSWAP_0d07de59261cc2c9023b194184c575fb)) { return new $OSWAP_0d07de59261cc2c9023b194184c575fb($OSWAP_68f0083ae1729052fe2f7baaa791b6ba); } else { swap_main_error_module('核心类文件损坏:',$OSWAP_0d07de59261cc2c9023b194184c575fb);; } } private function config(){ $config = sdk_get_config($this->OSWAP_c75ea562113451e694de0262eb2db2b8); if(!empty($config['AUTHORIZE'])) $this->OSWAP_3e9c20ea6e975c5580b078bf52cc1fab = $config['AUTHORIZE']; if(!empty($config['CALLBACK'])) $this->OSWAP_e94566f26da1237080a4a6b49640e4fd = $config['CALLBACK']; else swap_main_error_module('SWAPOauth错误:','请配置回调页面地址'); } public function getRequestCodeURL(){ $this->config(); $OSWAP_6c5cee550b682ff7d674773f07a17f33 = array( 'client_id' => $this->OSWAP_b0de71ed04656e7487be91e612b38d1f, 'redirect_uri' => $this->OSWAP_e94566f26da1237080a4a6b49640e4fd, 'response_type' => $this->OSWAP_9f98569ba14d1523a581f90d4e30130b, ); if($this->OSWAP_3e9c20ea6e975c5580b078bf52cc1fab){ parse_str($this->OSWAP_3e9c20ea6e975c5580b078bf52cc1fab, $OSWAP_81a86ef13d7c4f4b8e2a28a80876bf9a); if(is_array($OSWAP_81a86ef13d7c4f4b8e2a28a80876bf9a)){ $OSWAP_6c5cee550b682ff7d674773f07a17f33 = array_merge($OSWAP_6c5cee550b682ff7d674773f07a17f33, $OSWAP_81a86ef13d7c4f4b8e2a28a80876bf9a); } else { swap_main_error_module('SWAPOauth错误:','AUTHORIZE配置不正确！'); } } return $this->OSWAP_733853c9a76f3f1a18cbbc638cdce6b1 . '?' . http_build_query($OSWAP_6c5cee550b682ff7d674773f07a17f33); } public function getAccessToken($OSWAP_9ed21c0d2f12875f606b2694b8646816, $OSWAP_15d3b483d88efbc989957cbea1a8846dend = null){ $this->config(); $OSWAP_6c5cee550b682ff7d674773f07a17f33 = array( 'client_id' => $this->OSWAP_b0de71ed04656e7487be91e612b38d1f, 'client_secret' => $this->OSWAP_b49497e74dfd183be84caf631c684ca3, 'grant_type' => $this->OSWAP_356e383a42015689b910ea4539ca6758, 'code' => $OSWAP_9ed21c0d2f12875f606b2694b8646816, 'redirect_uri' => $this->OSWAP_e94566f26da1237080a4a6b49640e4fd, ); $OSWAP_e77f888b3189036b06b7d47acf75d044 = $this->http($this->OSWAP_b8aa71919428a0411ddc917a8e1f9f73, $OSWAP_6c5cee550b682ff7d674773f07a17f33, 'POST'); $this->OSWAP_ccc2685f3c4feb80847c04b6676e2537 = $this->parseToken($OSWAP_e77f888b3189036b06b7d47acf75d044, $OSWAP_15d3b483d88efbc989957cbea1a8846dend); return $this->OSWAP_ccc2685f3c4feb80847c04b6676e2537; } protected function param($OSWAP_6c5cee550b682ff7d674773f07a17f33, $OSWAP_c3008b3daf2eb5c591f45af59bf3ad06){ if(is_string($OSWAP_c3008b3daf2eb5c591f45af59bf3ad06)) parse_str($OSWAP_c3008b3daf2eb5c591f45af59bf3ad06, $OSWAP_c3008b3daf2eb5c591f45af59bf3ad06); return array_merge($OSWAP_6c5cee550b682ff7d674773f07a17f33, $OSWAP_c3008b3daf2eb5c591f45af59bf3ad06); } protected function url($OSWAP_1fa3bbd0516b0fcdb4e141e0a933d98e, $OSWAP_f4993652539bf9da638220db8ae0d280 = ''){ return $this->OSWAP_c1910d287b29a69ea2e85cfae9b899a7 . $OSWAP_1fa3bbd0516b0fcdb4e141e0a933d98e . $OSWAP_f4993652539bf9da638220db8ae0d280; } protected function http($OSWAP_0b36a49bb9425668c3e1b3792901c03b, $OSWAP_6c5cee550b682ff7d674773f07a17f33, $OSWAP_d24d2b57d10dc1011c9eb09c5125e396 = 'GET', $OSWAP_16c0ab7b45835e1f9256733fd5353d70 = array(), $OSWAP_8b787e73fccb6657cc58692d66835b16 = false){ $OSWAP_8f959530091161a4e000f8f669484802 = array( CURLOPT_TIMEOUT => 30, CURLOPT_RETURNTRANSFER => 1, CURLOPT_SSL_VERIFYPEER => false, CURLOPT_SSL_VERIFYHOST => false, CURLOPT_HTTPHEADER => $OSWAP_16c0ab7b45835e1f9256733fd5353d70 ); switch(strtoupper($OSWAP_d24d2b57d10dc1011c9eb09c5125e396)){ case 'GET': $OSWAP_8f959530091161a4e000f8f669484802[CURLOPT_URL] = $OSWAP_0b36a49bb9425668c3e1b3792901c03b . '?' . http_build_query($OSWAP_6c5cee550b682ff7d674773f07a17f33); break; case 'POST': $OSWAP_6c5cee550b682ff7d674773f07a17f33 = $OSWAP_8b787e73fccb6657cc58692d66835b16 ? $OSWAP_6c5cee550b682ff7d674773f07a17f33 : http_build_query($OSWAP_6c5cee550b682ff7d674773f07a17f33); $OSWAP_8f959530091161a4e000f8f669484802[CURLOPT_URL] = $OSWAP_0b36a49bb9425668c3e1b3792901c03b; $OSWAP_8f959530091161a4e000f8f669484802[CURLOPT_POST] = 1; $OSWAP_8f959530091161a4e000f8f669484802[CURLOPT_POSTFIELDS] = $OSWAP_6c5cee550b682ff7d674773f07a17f33; break; default: swap_main_error_module('SWAPOauth错误:','不支持的请求方式！'); } $ch = curl_init(); curl_setopt_array($ch, $OSWAP_8f959530091161a4e000f8f669484802); $OSWAP_e77f888b3189036b06b7d47acf75d044 = curl_exec($ch); $OSWAP_0ccc3e14ef41636d4776a93725351e09 = curl_error($ch); curl_close($ch); if($OSWAP_0ccc3e14ef41636d4776a93725351e09) swap_main_error_module('SWAPOauth错误:','请求发生错误：' . $OSWAP_0ccc3e14ef41636d4776a93725351e09); return $OSWAP_e77f888b3189036b06b7d47acf75d044; } abstract protected function call($OSWAP_1fa3bbd0516b0fcdb4e141e0a933d98e, $OSWAP_c3008b3daf2eb5c591f45af59bf3ad06 = '', $OSWAP_d24d2b57d10dc1011c9eb09c5125e396 = 'GET', $OSWAP_8b787e73fccb6657cc58692d66835b16 = false); abstract protected function parseToken($OSWAP_2e29d37ed05a8087327b406a5df9d569, $OSWAP_15d3b483d88efbc989957cbea1a8846dend); abstract public function openid(); } function sdk_get_config($OSWAP_1fa3bbd0516b0fcdb4e141e0a933d98e){ if(file_exists(SWAP_CONFIGS.$OSWAP_1fa3bbd0516b0fcdb4e141e0a933d98e.'_sdk.php')) return require SWAP_CONFIGS.$OSWAP_1fa3bbd0516b0fcdb4e141e0a933d98e.'_sdk.php'; else swap_main_error_module('SWAPOauth不存在的配置文件:',$OSWAP_1fa3bbd0516b0fcdb4e141e0a933d98e); }