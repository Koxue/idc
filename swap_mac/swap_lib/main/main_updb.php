<?php  function execQuery($OSWAP_dad895d67b5f0a747b6f7c81ca95569c, $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e) { $OSWAP_9cf4d9bd2924859cdbf870961f1dd6ef = true; if (ACTION == 'OK') { $OSWAP_9cf4d9bd2924859cdbf870961f1dd6ef = D()->query($OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e); } if (!$OSWAP_9cf4d9bd2924859cdbf870961f1dd6ef) { $debug = debug_backtrace(); $OSWAP_dad895d67b5f0a747b6f7c81ca95569c->setMsg('line ' . $debug[0]['line'] . ' : ' . 'sql wrong:' . $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e); } else { $OSWAP_dad895d67b5f0a747b6f7c81ca95569c->setSql($OSWAP_fe7a81a7636f76f8b5ade2206bd80b9e); } } function checkColumnDiff($OSWAP_dad895d67b5f0a747b6f7c81ca95569c, $OSWAP_3143eb6f6633e1ac4a0f21f50703c639, $OSWAP_bcfe725cdbaafd79a688c15a36a7227e) { if (array_keys($OSWAP_3143eb6f6633e1ac4a0f21f50703c639) == array_keys($OSWAP_bcfe725cdbaafd79a688c15a36a7227e)) { return false; } if (count($OSWAP_3143eb6f6633e1ac4a0f21f50703c639) != count($OSWAP_bcfe725cdbaafd79a688c15a36a7227e)) { return false; } $OSWAP_4a4fa9ca3151e228d70430c7938d3f21 = count($OSWAP_3143eb6f6633e1ac4a0f21f50703c639); for ($i=0; $i < $OSWAP_4a4fa9ca3151e228d70430c7938d3f21; $i++) { $OSWAP_5ffa7c95649bf29676359dc8adef0e09 = key($OSWAP_3143eb6f6633e1ac4a0f21f50703c639); $OSWAP_e80303f7f66c0c095649d02e73162070 = key($OSWAP_bcfe725cdbaafd79a688c15a36a7227e); if (!empty($OSWAP_5ffa7c95649bf29676359dc8adef0e09) && !in_array($OSWAP_5ffa7c95649bf29676359dc8adef0e09, array('KEY', 'INDEX', 'UNIQUE', 'PRIMARY')) && $OSWAP_5ffa7c95649bf29676359dc8adef0e09 != $OSWAP_e80303f7f66c0c095649d02e73162070) { $OSWAP_dad895d67b5f0a747b6f7c81ca95569c->setMsg("字段顺序不正确: 第" . ($i+1) . "个字段 sql中字段为 {$OSWAP_5ffa7c95649bf29676359dc8adef0e09} 数据库中字段为 {$OSWAP_e80303f7f66c0c095649d02e73162070}" ); } next($OSWAP_3143eb6f6633e1ac4a0f21f50703c639); next($OSWAP_bcfe725cdbaafd79a688c15a36a7227e); } } function checkTableComment($OSWAP_dcd46da78fd740a9cb5ac945ad1f464e, $OSWAP_cf8c99295af55138d99b30d6f74f6fe0) { if (!$OSWAP_dcd46da78fd740a9cb5ac945ad1f464e || !$OSWAP_cf8c99295af55138d99b30d6f74f6fe0) { return false; } $temp=explode("\n", $OSWAP_dcd46da78fd740a9cb5ac945ad1f464e); $OSWAP_487112f8c887a75ccc8e44061d5a4026 = array_pop($temp); $temp=explode("\n", $OSWAP_cf8c99295af55138d99b30d6f74f6fe0); $OSWAP_b539bbbf08e0549dcfa53885773d0457 = array_pop($temp); $OSWAP_b1a1d34ec60f40d8cffb61eddda76a97 = ''; $OSWAP_421809edca990a7b59979b883ce5359c = ''; if (preg_match("/COMMENT\='(.*)'/is", $OSWAP_487112f8c887a75ccc8e44061d5a4026, $OSWAP_5b666056bee44cf3664ec1cb62a510a7s)) $OSWAP_b1a1d34ec60f40d8cffb61eddda76a97 = $OSWAP_5b666056bee44cf3664ec1cb62a510a7s[1]; if (!$OSWAP_b1a1d34ec60f40d8cffb61eddda76a97) return false; if (preg_match("/COMMENT\='(.*)'/is", $OSWAP_b539bbbf08e0549dcfa53885773d0457, $OSWAP_5b666056bee44cf3664ec1cb62a510a7s)) $OSWAP_421809edca990a7b59979b883ce5359c = $OSWAP_5b666056bee44cf3664ec1cb62a510a7s[1]; if ($OSWAP_b1a1d34ec60f40d8cffb61eddda76a97 == $OSWAP_421809edca990a7b59979b883ce5359c) return false; return $OSWAP_b1a1d34ec60f40d8cffb61eddda76a97; } function remakesql($OSWAP_31bb5897a4cf8155e2d7054f8ef132dd) { $OSWAP_31bb5897a4cf8155e2d7054f8ef132dd = trim(preg_replace("/\s+/", ' ', $OSWAP_31bb5897a4cf8155e2d7054f8ef132dd)); $OSWAP_31bb5897a4cf8155e2d7054f8ef132dd = str_replace(array('`',', ', ' ,', '( ' ,' )', 'mediumtext'), array('', ',', ',','(',')','text'), $OSWAP_31bb5897a4cf8155e2d7054f8ef132dd); return $OSWAP_31bb5897a4cf8155e2d7054f8ef132dd; } function getcolumn($OSWAP_2f699b3aa0aff38694d6dcd7653a7c17) { preg_match("/\((.+)\)\s*(ENGINE|TYPE)\s*\=/is", $OSWAP_2f699b3aa0aff38694d6dcd7653a7c17, $OSWAP_5b666056bee44cf3664ec1cb62a510a7s); $OSWAP_9f38f6f9c0953ced97f4411c8bcbd927 = explode("\n", $OSWAP_5b666056bee44cf3664ec1cb62a510a7s[1]); $OSWAP_4d633eb54a02fe2199fbb0bce609e7c4 = array(); foreach ($OSWAP_9f38f6f9c0953ced97f4411c8bcbd927 as $OSWAP_31bb5897a4cf8155e2d7054f8ef132dd) { $OSWAP_31bb5897a4cf8155e2d7054f8ef132dd = trim($OSWAP_31bb5897a4cf8155e2d7054f8ef132dd); if(empty($OSWAP_31bb5897a4cf8155e2d7054f8ef132dd)) continue; $OSWAP_31bb5897a4cf8155e2d7054f8ef132dd = remakesql($OSWAP_31bb5897a4cf8155e2d7054f8ef132dd); if(substr($OSWAP_31bb5897a4cf8155e2d7054f8ef132dd, -1) == ',') $OSWAP_31bb5897a4cf8155e2d7054f8ef132dd = substr($OSWAP_31bb5897a4cf8155e2d7054f8ef132dd, 0, -1); $vs = explode(' ', $OSWAP_31bb5897a4cf8155e2d7054f8ef132dd); $OSWAP_59efa52b427a08d0b0610599ad0907f2 = $vs[0]; if($OSWAP_59efa52b427a08d0b0610599ad0907f2 == 'KEY' || $OSWAP_59efa52b427a08d0b0610599ad0907f2 == 'INDEX' || $OSWAP_59efa52b427a08d0b0610599ad0907f2 == 'UNIQUE') { $OSWAP_0d07de59261cc2c9023b194184c575fb_length = strlen($OSWAP_59efa52b427a08d0b0610599ad0907f2); if($OSWAP_59efa52b427a08d0b0610599ad0907f2 == 'UNIQUE') $OSWAP_0d07de59261cc2c9023b194184c575fb_length = $OSWAP_0d07de59261cc2c9023b194184c575fb_length + 4; $OSWAP_2bf690fab0352c09fc8f01952397ed4f = trim(substr($OSWAP_31bb5897a4cf8155e2d7054f8ef132dd, $OSWAP_0d07de59261cc2c9023b194184c575fb_length)); $OSWAP_46d16f02981e51d99f6822c6819b5ff6 = explode(' ', $OSWAP_2bf690fab0352c09fc8f01952397ed4f); $OSWAP_04d908b1b015cb4fb977c7b4ce6a7213 = $OSWAP_46d16f02981e51d99f6822c6819b5ff6[0]; $OSWAP_4d633eb54a02fe2199fbb0bce609e7c4[$OSWAP_59efa52b427a08d0b0610599ad0907f2][$OSWAP_04d908b1b015cb4fb977c7b4ce6a7213] = trim(substr($OSWAP_31bb5897a4cf8155e2d7054f8ef132dd, ($OSWAP_0d07de59261cc2c9023b194184c575fb_length+2+strlen($OSWAP_04d908b1b015cb4fb977c7b4ce6a7213)))); } elseif($OSWAP_59efa52b427a08d0b0610599ad0907f2 == 'PRIMARY') { $OSWAP_4d633eb54a02fe2199fbb0bce609e7c4[$OSWAP_59efa52b427a08d0b0610599ad0907f2] = trim(substr($OSWAP_31bb5897a4cf8155e2d7054f8ef132dd, 11)); } else { $OSWAP_4d633eb54a02fe2199fbb0bce609e7c4[$OSWAP_59efa52b427a08d0b0610599ad0907f2] = trim(substr($OSWAP_31bb5897a4cf8155e2d7054f8ef132dd, strlen($OSWAP_59efa52b427a08d0b0610599ad0907f2))); } } return $OSWAP_4d633eb54a02fe2199fbb0bce609e7c4; } class execSqlInfo { public $OSWAP_93e86675a14bf45114306ac2be631499List = array(); public $OSWAP_5c295e07cbc9956b585b655480080409 = array(); function setMsg($OSWAP_e944d3dfbac154a6a70ca38a065998b0) { $this->OSWAP_93e86675a14bf45114306ac2be631499List[] = $OSWAP_e944d3dfbac154a6a70ca38a065998b0; } function setSql($OSWAP_1ee7d01ae8c3bac11df4ecf6f6786ba4) { $this->OSWAP_5c295e07cbc9956b585b655480080409[] = $OSWAP_1ee7d01ae8c3bac11df4ecf6f6786ba4; } function formatMessage() { $OSWAP_ef7aa62be05b3af802a43cb08745a62a = "\n"; $OSWAP_ef7aa62be05b3af802a43cb08745a62a .= date('Y m d H:i:s') . "\n"; if (!$this->OSWAP_5c295e07cbc9956b585b655480080409 && !$this->OSWAP_93e86675a14bf45114306ac2be631499List) { $OSWAP_ef7aa62be05b3af802a43cb08745a62a .= "nothing to do!\n"; } else { if($this->OSWAP_93e86675a14bf45114306ac2be631499List) { $OSWAP_ef7aa62be05b3af802a43cb08745a62a .= "error message:\n "; foreach ($this->OSWAP_93e86675a14bf45114306ac2be631499List as $v) { $OSWAP_ef7aa62be05b3af802a43cb08745a62a .= $v . "\n
*******************************************************\n\n"; } } $OSWAP_ef7aa62be05b3af802a43cb08745a62a .= "exec sql :\n"; foreach ($this->OSWAP_5c295e07cbc9956b585b655480080409 as $v) { $OSWAP_ef7aa62be05b3af802a43cb08745a62a .= $v . "\n
////////////////////////////////////////////////////////\n\n"; } } return $OSWAP_ef7aa62be05b3af802a43cb08745a62a; } } 