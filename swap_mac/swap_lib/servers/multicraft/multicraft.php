<?php  requirer( 'MulticraftAPI.php' ,'multicraft'); class n9a { var $OSWAP_aa9572bd29434d64e734abb49d337018 = null; var $OSWAP_6322c28b1574d514832c9265baaa1af9 = array( ); var $OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a = array( ); var $OSWAP_f163b8a6823c9cde3d3fbde9dff9fab9 = null; var $OSWAP_693bcaf7e2e5618fbebf60103ddd7f70 = null; var $OSWAP_a5fd76adde77d7971b23e7921662aae3 = null; var $OSWAP_0954080bad6187d3debef64aef286cdd = null; var $OSWAP_84d0a5abf123b3d4910998094450e970 = null; var $OSWAP_6590e3337b40e978dee5bbb44eff9d1a = array( ); var $OSWAP_5418f6f54996d66e33549cfb0c963e49 = ''; var $OSWAP_5bd4d2a20bb708e44d770cc6345843fb = ''; var $OSWAP_f15435e50d03a10664c87c55a904432b = ''; var $OSWAP_862d31ebcc8c688233a61d843acb4e1d = ''; var $OSWAP_262e71c24b1b34787cf41614d7cfc68a = null; var $OSWAP_46c7b191c106a00ecdae4db3edfa1aaa = ''; var $OSWAP_c0393c433b33fb570dd0e46d7c80764f = 10; var $OSWAP_07803246939b98c10152336f1790baa5 = ''; var $OSWAP_a72387886992b5bc2be36aa035545d5c = ''; var $OSWAP_bf360a6bfcaf93eede3ed510fdf83c9c = array( ); var $OSWAP_b2737f962e9b1aed14c0297dfa800437 = 0; var $OSWAP_0c9430c3d17f821936021ff280ef3420 = array( ); var $OSWAP_97171a4efa164c0e2a7633194a18d095 = '_default_'; function add_error($OSWAP_2f88140b9ad86674c89568287dbf36b4) { $this->OSWAP_5418f6f54996d66e33549cfb0c963e49 = true; $this->red( $OSWAP_2f88140b9ad86674c89568287dbf36b4 ); return false; } function red($OSWAP_dc8b962501cb654b18ebcb56fa436e8d) { $this->OSWAP_6590e3337b40e978dee5bbb44eff9d1a[] = htmlentities( $OSWAP_dc8b962501cb654b18ebcb56fa436e8d, ENT_QUOTES ); return false; } function log() { if (( ( $this->OSWAP_5bd4d2a20bb708e44d770cc6345843fb && ( $this->OSWAP_f15435e50d03a10664c87c55a904432b || $this->OSWAP_5418f6f54996d66e33549cfb0c963e49 ) ) && strlen( $this->OSWAP_862d31ebcc8c688233a61d843acb4e1d ) )) { $OSWAP_88465b365e3b5505f2af41b6e22406a6 = 'localhost'; $OSWAP_a3e78fa724cae776aa3b3fa8423022bc = 'From: ' . $OSWAP_88465b365e3b5505f2af41b6e22406a6 . "\r\nReply-To: " . $OSWAP_88465b365e3b5505f2af41b6e22406a6; @mail( $this->OSWAP_862d31ebcc8c688233a61d843acb4e1d, ($this->OSWAP_5418f6f54996d66e33549cfb0c963e49 ? @'FAILED' : @'SUCCESS') . @': Multicraft Module: ' . $this->OSWAP_262e71c24b1b34787cf41614d7cfc68a, @implode( $this->OSWAP_6590e3337b40e978dee5bbb44eff9d1a, @"\n" ) ); } } function nd9($OSWAP_0ac86d0f50e40839847a7d812c4772eb) { if (!isset( $OSWAP_0ac86d0f50e40839847a7d812c4772eb['errors'] )) { return 'Empty response'; } if (!is_array( $OSWAP_0ac86d0f50e40839847a7d812c4772eb['errors'] )) { if (!@strlen( $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'errors'] )) { return 'Empty error string'; } return (bool)$OSWAP_0ac86d0f50e40839847a7d812c4772eb['errors']; } $OSWAP_438b628256a6b59931903bc0e84e882d = ''; foreach ($OSWAP_0ac86d0f50e40839847a7d812c4772eb['errors'] as $OSWAP_9fcae7fcb22e0375b33daf55de46b3a0) { if (strlen( $OSWAP_438b628256a6b59931903bc0e84e882d )) { $OSWAP_438b628256a6b59931903bc0e84e882d .= ', '; } $OSWAP_438b628256a6b59931903bc0e84e882d .= print_r( $OSWAP_9fcae7fcb22e0375b33daf55de46b3a0, true ); } return $OSWAP_438b628256a6b59931903bc0e84e882d; } function init_mc($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['slots'] = (int)$OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption1']; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ram'] = (int)$OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption2']; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['jarfile'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption3']; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['jardir'] = ($OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption4'] === 'Server JAR directory' ? 'server' : ($OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption4'] === 'Server base directory' ? 'server_base' : 'daemon')); $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_jar'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption5'] === 'Yes'; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_name'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption6'] === 'Yes'; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_tasks'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption7'] === 'Yes'; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_ftp'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption8'] === 'Yes'; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_visibility'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption9'] === 'Yes'; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['default_role'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption10']; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['visibility'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption11']; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['start'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption12'] === 'Yes'; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['dedip'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption13']; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ftp'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption14'] === 'Yes'; $OSWAP_789c349994f599cd9a62bd9705725982 = array_map( 'trim', explode( ',', $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption15'] ) ); $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['maxPerDaemon'] = (int)$OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption16']; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['includeSuspended'] = ($OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption17'] === 'Include suspended' ? 1 : 0); $this->OSWAP_46c7b191c106a00ecdae4db3edfa1aaa = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption18'] === 'Yes'; $this->OSWAP_5bd4d2a20bb708e44d770cc6345843fb = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption19'] != 'No'; $this->OSWAP_f15435e50d03a10664c87c55a904432b = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption19'] == 'Yes'; $this->OSWAP_862d31ebcc8c688233a61d843acb4e1d = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoption20']; $OSWAP_f8672b50f59cc15a3a36a39ed2843cdf = $this->OSWAP_97171a4efa164c0e2a7633194a18d095; $this->OSWAP_0c9430c3d17f821936021ff280ef3420[$OSWAP_f8672b50f59cc15a3a36a39ed2843cdf] = array( ); foreach ($OSWAP_789c349994f599cd9a62bd9705725982 as $OSWAP_42ca44d386682f3055b1ee7078b0873a) { $OSWAP_12f80d46a2a3e71397d110a7a041cc7a = array( ); if (preg_match( '/([^:]+):(.*)/', $OSWAP_42ca44d386682f3055b1ee7078b0873a, $OSWAP_12f80d46a2a3e71397d110a7a041cc7a )) { $OSWAP_f8672b50f59cc15a3a36a39ed2843cdf = $OSWAP_12f80d46a2a3e71397d110a7a041cc7a[1]; $OSWAP_42ca44d386682f3055b1ee7078b0873a = $OSWAP_12f80d46a2a3e71397d110a7a041cc7a[2]; } if ((int)$OSWAP_42ca44d386682f3055b1ee7078b0873a) { $this->OSWAP_0c9430c3d17f821936021ff280ef3420[$OSWAP_f8672b50f59cc15a3a36a39ed2843cdf][] = (int)$OSWAP_42ca44d386682f3055b1ee7078b0873a; continue; } } $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ip'] = ''; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['port'] = ''; $this->red( 'Multicraft Service Module v2.5 starting' ); $this->OSWAP_aa9572bd29434d64e734abb49d337018 = new MulticraftAPI( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00["serverhostname"] . '/api.php', $OSWAP_7b9f432c7b90f22f15fa33c120f60a00["serverusername"], $OSWAP_7b9f432c7b90f22f15fa33c120f60a00["serveraccesshash"] ); return true; } function end() { $this->log( ); if (!$this->OSWAP_5418f6f54996d66e33549cfb0c963e49) { return '成功'; } return end( $this->OSWAP_6590e3337b40e978dee5bbb44eff9d1a ); } function install($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $this->OSWAP_262e71c24b1b34787cf41614d7cfc68a = 'Setup'; if (!$this->init_mc( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 )) { return $this->end( ); } if (( ( ( ( ( !$this->ckfw( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 ,true) || !$this->ckdm( ) ) || !$this->ckip( ) ) || !$this->createUser( ) ) || !$this->createServer( ) ) || !$this->rdc( ) )) { return $this->end( ); } $this->createPlayer( ); return $this->end( ); } function terminate($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $this->OSWAP_262e71c24b1b34787cf41614d7cfc68a = 'Terminate'; if (!$this->init_mc( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 )) { return $this->end( ); } if (!$this->r08( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 )) { return $this->end( ); } $this->r85( ); return $this->end( ); } function suspend($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $this->OSWAP_262e71c24b1b34787cf41614d7cfc68a = 'Suspend'; if (!$this->init_mc( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 )) { return $this->end( ); } if (!$this->r208( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 )) { return $this->end( ); } $this->red( 'Suspending server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 ); $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->suspendServer( $this->OSWAP_84d0a5abf123b3d4910998094450e970 ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { $this->add_error( 'Failed to suspend server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . ': ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } return $this->end( ); } function unsuspend($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $this->OSWAP_262e71c24b1b34787cf41614d7cfc68a = 'Unsuspend'; if (!$this->init_mc( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 )) { return $this->end( ); } if (!$this->r208( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 )) { return $this->end( ); } $this->red( 'Unsuspending server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 ); $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->resumeServer( $this->OSWAP_84d0a5abf123b3d4910998094450e970 ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { $this->add_error( 'Failed to unsuspend server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . ': ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } return $this->end( ); } function n65($OSWAP_7b9f432c7b90f22f15fa33c120f60a00, $OSWAP_262e71c24b1b34787cf41614d7cfc68a) { $this->OSWAP_262e71c24b1b34787cf41614d7cfc68a = 'Server ' . $OSWAP_262e71c24b1b34787cf41614d7cfc68a; if (!$this->init_mc( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 )) { return $this->end( ); } if (!$this->r208( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 )) { return $this->end( ); } $OSWAP_7a2ae05e81d9c8a13ce31975d8faafbe = false; switch ($OSWAP_262e71c24b1b34787cf41614d7cfc68a) { case 'start': { $OSWAP_7a2ae05e81d9c8a13ce31975d8faafbe = 'startServer'; break; } case 'stop': { $OSWAP_7a2ae05e81d9c8a13ce31975d8faafbe = 'stopServer'; break; } case 'restart': { $OSWAP_7a2ae05e81d9c8a13ce31975d8faafbe = 'restartServer'; break; } default: { $this->add_error( 'Unhandled action "' . $OSWAP_262e71c24b1b34787cf41614d7cfc68a . '"' ); if ($OSWAP_7a2ae05e81d9c8a13ce31975d8faafbe) { $this->red( 'Server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . ': ' . $OSWAP_262e71c24b1b34787cf41614d7cfc68a ); $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->$OSWAP_7a2ae05e81d9c8a13ce31975d8faafbe( $this->OSWAP_84d0a5abf123b3d4910998094450e970 ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { $this->add_error( 'Failed to run ' . $OSWAP_7a2ae05e81d9c8a13ce31975d8faafbe . ' for server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . ': ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } } return $this->end( ); } } } function n2f($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $this->OSWAP_262e71c24b1b34787cf41614d7cfc68a = 'Change Password'; if (!$this->init_mc( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 )) { return $this->end( ); } $this->r5b( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 ); return $this->end( ); } function n4a($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $this->OSWAP_262e71c24b1b34787cf41614d7cfc68a = 'Change Package'; if (!$this->init_mc( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 )) { return $this->end( ); } if (!$this->ckfw( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00, true )) { return $this->end( ); } $this->rbf7( ); return $this->end( ); } function nd8($OSWAP_f2abe0e311079f7509105e02159f1d42, $OSWAP_97171a4efa164c0e2a7633194a18d0955) { foreach ($OSWAP_f2abe0e311079f7509105e02159f1d42 as $OSWAP_a31e818079d9999adbefb4af9e604baa => $OSWAP_7d3026e29844665185f2359f20dda2ef) { if (preg_match( '/user/i', $OSWAP_a31e818079d9999adbefb4af9e604baa )) { $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] = trim( $OSWAP_7d3026e29844665185f2359f20dda2ef ); $this->red( 'Username set to "' . $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] . '" from ' . $OSWAP_97171a4efa164c0e2a7633194a18d0955 . ' "' . $OSWAP_a31e818079d9999adbefb4af9e604baa . '".' ); } if (preg_match( '/location/i', $OSWAP_a31e818079d9999adbefb4af9e604baa )) { $this->OSWAP_97171a4efa164c0e2a7633194a18d095 = trim( $OSWAP_7d3026e29844665185f2359f20dda2ef ); $this->red( 'Location set to "' . $this->OSWAP_97171a4efa164c0e2a7633194a18d095 . '" from ' . $OSWAP_97171a4efa164c0e2a7633194a18d0955 . ' "' . $OSWAP_a31e818079d9999adbefb4af9e604baa . '".' ); continue; } } } function n92() { $OSWAP_0ac86d0f50e40839847a7d812c4772eb = D()->query( 'select 分配的IP地址 from 服务器表 where `id`=' . D()->real_escape_string( intval( $this->OSWAP_b2737f962e9b1aed14c0297dfa800437 ) ) ); $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 = ''; if ($OSWAP_0ac86d0f50e40839847a7d812c4772eb) { $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f = D()->fetch_row(); D()->free(); if (( !is_array( $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f ) || !count( $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f ) )) { $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f = array( '' ); } $this->OSWAP_a72387886992b5bc2be36aa035545d5c = $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f[0]; $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f = @preg_split('/\s+/', $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f[0]); if (!is_array( $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f )) { return null; } if(empty($OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f[0])) return null; $OSWAP_0e1e4d39079bf30bdc4e1d88f1a84e1b = 0; while ($OSWAP_0e1e4d39079bf30bdc4e1d88f1a84e1b < count( $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f )) { $OSWAP_2e4f192efbefaeb625aefab45a418947 = explode( ',', $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f[$OSWAP_0e1e4d39079bf30bdc4e1d88f1a84e1b] ); if (( !$OSWAP_2e4f192efbefaeb625aefab45a418947 || count( $OSWAP_2e4f192efbefaeb625aefab45a418947 ) < 2 )) { continue; } $OSWAP_a72387886992b5bc2be36aa035545d5c5 = (int)$OSWAP_2e4f192efbefaeb625aefab45a418947[0]; if (( $OSWAP_a72387886992b5bc2be36aa035545d5c5 && strlen( $OSWAP_2e4f192efbefaeb625aefab45a418947[1] ) )) { $this->OSWAP_bf360a6bfcaf93eede3ed510fdf83c9c[$OSWAP_a72387886992b5bc2be36aa035545d5c5] = true; } ++$OSWAP_0e1e4d39079bf30bdc4e1d88f1a84e1b; } } } function ckfw($OSWAP_7b9f432c7b90f22f15fa33c120f60a00, $OSWAP_9af14a50ed3913edbf70962d3950d4b8 = false) { $this->OSWAP_f163b8a6823c9cde3d3fbde9dff9fab9 = intval( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['clientsdetails']['userid'] ); $this->OSWAP_693bcaf7e2e5618fbebf60103ddd7f70 = intval( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['serviceid'] ); $this->OSWAP_a5fd76adde77d7971b23e7921662aae3 = intval( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['packageid'] ); $this->OSWAP_b2737f962e9b1aed14c0297dfa800437 = intval( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['serverid'] ); $this->nd8( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['customfields'], 'custom field' ); $this->nd8( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['configoptions'], 'configurable option' ); if (!isset( $this->OSWAP_0c9430c3d17f821936021ff280ef3420[$this->OSWAP_97171a4efa164c0e2a7633194a18d095] )) { $this->red( 'No daemon list for location ' . $this->OSWAP_97171a4efa164c0e2a7633194a18d095 . '. Setting to default location.' ); $this->OSWAP_97171a4efa164c0e2a7633194a18d095 = '_default_'; } if (!$this->OSWAP_a5fd76adde77d7971b23e7921662aae3) { return $this->add_error( 'Invalid service plan' ); } if (!$this->OSWAP_f163b8a6823c9cde3d3fbde9dff9fab9) { return $this->add_error( 'Invalid client: ' . $this->OSWAP_f163b8a6823c9cde3d3fbde9dff9fab9 ); } $this->n92( ); $this->OSWAP_6322c28b1574d514832c9265baaa1af9['email'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['clientsdetails']['email']; if (strlen( $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] )) { $OSWAP_0ac86d0f50e40839847a7d812c4772eb = D()->query( 'select count(*) from 服务 where 帐号id!=' . D()->real_escape_string( intval( $this->OSWAP_f163b8a6823c9cde3d3fbde9dff9fab9 ) ) . ' and 用户名=\'' . D()->real_escape_string( $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] ) . '\' and 服务器id=' . '(select 服务器id from 服务 where `id`=' . D()->real_escape_string( intval( $this->OSWAP_693bcaf7e2e5618fbebf60103ddd7f70 ) ) . ')' ); if ($OSWAP_0ac86d0f50e40839847a7d812c4772eb) { $OSWAP_22b898ce63ad9b65e69c89a6ad080928 = D()->fetch_row(); D()->free(); if (0 < intval( $OSWAP_22b898ce63ad9b65e69c89a6ad080928[0] )) { return $this->add_error( 'The username "' . $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] . '" is already in use by another client.' ); } } } if (!strlen( $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] )) { $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['username']; } if (!strlen( $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] )) { $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] = $this->OSWAP_6322c28b1574d514832c9265baaa1af9['email']; } if (!strlen( $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] )) { return $this->add_error( 'No Minecraft username supplied (tried using the email address but that\'s empty as well).' ); } if (!$this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['slots']) { return $this->add_error( 'Number of slots not specified for service plan ' . $this->OSWAP_a5fd76adde77d7971b23e7921662aae3 ); } if (!$this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ram']) { return $this->add_error( 'Amount of RAM not specified for service plan ' . $this->OSWAP_a5fd76adde77d7971b23e7921662aae3 ); } $this->r208( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00, false ); if (( $this->OSWAP_84d0a5abf123b3d4910998094450e970 && !$OSWAP_9af14a50ed3913edbf70962d3950d4b8 )) { return $this->add_error( 'Server ID already set (service "Domain" field). Please make sure that' . ' the service has not yet been set up and clear the ID.' ); } $this->red( 'Verified data for client ' . $this->OSWAP_f163b8a6823c9cde3d3fbde9dff9fab9 . ', service ' . $this->OSWAP_693bcaf7e2e5618fbebf60103ddd7f70 . ', plan ' . $this->OSWAP_a5fd76adde77d7971b23e7921662aae3 . ': Username "' . $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] . '", slots ' . $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['slots'] . ', RAM ' . $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ram'] ); $OSWAP_0ac86d0f50e40839847a7d812c4772eb = D()->query( 'select 密码 from 服务 where 帐号id=' . D()->real_escape_string( intval( $this->OSWAP_f163b8a6823c9cde3d3fbde9dff9fab9 ) ) . ' and 用户名=\'' . D()->real_escape_string( $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] ) . '\' and 服务器id=' . '(select 服务器id from 服务 where `id`=' . D()->real_escape_string( intval( $this->OSWAP_693bcaf7e2e5618fbebf60103ddd7f70 ) ) . ')' ); if ($OSWAP_0ac86d0f50e40839847a7d812c4772eb) { $OSWAP_22b898ce63ad9b65e69c89a6ad080928 = D()->fetch_row(); D()->free(); $OSWAP_0702e90295c996a58c4282f11b45b28c = decrypt( strval( $OSWAP_22b898ce63ad9b65e69c89a6ad080928[0] ) ); $this->OSWAP_6322c28b1574d514832c9265baaa1af9['password'] = $OSWAP_0702e90295c996a58c4282f11b45b28c; if (strlen( $OSWAP_0702e90295c996a58c4282f11b45b28c )) { $this->red( 'Got password from database.' ); } } if (!strlen( $this->OSWAP_6322c28b1574d514832c9265baaa1af9['password'] )) { $this->OSWAP_6322c28b1574d514832c9265baaa1af9['password'] = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['password']; } if (!strlen( $this->OSWAP_6322c28b1574d514832c9265baaa1af9['password'] )) { $this->OSWAP_6322c28b1574d514832c9265baaa1af9['password'] = substr( md5( rand( ) ), 0, 8 ); $this->red( 'Generated new password: ' . $this->OSWAP_6322c28b1574d514832c9265baaa1af9['password'] ); } else { $this->red( 'Got existing password: ' . $this->OSWAP_6322c28b1574d514832c9265baaa1af9['password'] ); } return true; } function rdc() { $OSWAP_41e4536942b5623fa60b1274691667f2 = $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ip'] . ':' . $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['port']; $this->red( 'Setting IP of ' . $this->OSWAP_693bcaf7e2e5618fbebf60103ddd7f70 . ' to ' . $OSWAP_41e4536942b5623fa60b1274691667f2 ); $OSWAP_0ac86d0f50e40839847a7d812c4772eb = D()->query( 'update 服务 set 专用ip=\'' . D()->real_escape_string( $OSWAP_41e4536942b5623fa60b1274691667f2 ) . '\',' . ' 域名=\'' . D()->real_escape_string( intval( $this->OSWAP_84d0a5abf123b3d4910998094450e970 ) ) . '\'' . ' where `id`=' . D()->real_escape_string( intval( $this->OSWAP_693bcaf7e2e5618fbebf60103ddd7f70 ) ) ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb) { return $this->add_error( 'Failed to set server IP and ID'); } if ($this->OSWAP_07803246939b98c10152336f1790baa5) { $OSWAP_0ac86d0f50e40839847a7d812c4772eb = D()->query( 'update 服务器表 set 分配的IP地址=\'' . D()->real_escape_string( $this->OSWAP_a72387886992b5bc2be36aa035545d5c ) . '\'' . ' where `id`=' . D()->real_escape_string( intval( $this->OSWAP_b2737f962e9b1aed14c0297dfa800437 ) ) ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb) { $this->add_error( 'Warning: Failed to add/remove IP from "Assigned IP Addresses"!' ); } } return true; } function n1d($OSWAP_4ee841eb892b12834a295c3b2481c7f0) { $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->getConnectionMemory( $OSWAP_4ee841eb892b12834a295c3b2481c7f0, $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['includeSuspended'] ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { $this->red( 'Error getting memory information for daemon ' . $OSWAP_4ee841eb892b12834a295c3b2481c7f0 . ': ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $OSWAP_156c4a58c172ef16ba5399b37100c4e4 = 0; $OSWAP_df895db269e1e3532149484659e40a0d = $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'used']; $OSWAP_ae8b4f3ce184bab09c301c6883aa642c = $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'total']; if (!$OSWAP_ae8b4f3ce184bab09c301c6883aa642c) { $this->red( 'Daemon ' . $OSWAP_4ee841eb892b12834a295c3b2481c7f0 . ' has no available memory amount set.' ); $OSWAP_156c4a58c172ef16ba5399b37100c4e4 = $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ram']; } else { $OSWAP_156c4a58c172ef16ba5399b37100c4e4 = $OSWAP_ae8b4f3ce184bab09c301c6883aa642c - $OSWAP_df895db269e1e3532149484659e40a0d; } $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->listServersByConnection( $OSWAP_4ee841eb892b12834a295c3b2481c7f0 ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->red( 'Error getting servers for daemon ' . $OSWAP_4ee841eb892b12834a295c3b2481c7f0 . ': ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $OSWAP_05099488629a7203930f3f30c6f747c1 = $OSWAP_0ac86d0f50e40839847a7d812c4772eb['data']['Servers']; return array( 'count' => (is_array( $OSWAP_05099488629a7203930f3f30c6f747c1 ) ? count( $OSWAP_05099488629a7203930f3f30c6f747c1 ) : 0), 'freeRam' => $OSWAP_156c4a58c172ef16ba5399b37100c4e4, 'usedRam' => $OSWAP_df895db269e1e3532149484659e40a0d, 'totalRam' => $OSWAP_ae8b4f3ce184bab09c301c6883aa642c ); } function ckdm() { $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->listConnections( ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { $this->add_error( 'Error getting connections: ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $OSWAP_ec795750d3756af641a78017b42a26a1 = $OSWAP_0ac86d0f50e40839847a7d812c4772eb['data']['Daemons']; $OSWAP_789c349994f599cd9a62bd9705725982 = $this->OSWAP_0c9430c3d17f821936021ff280ef3420[$this->OSWAP_97171a4efa164c0e2a7633194a18d095]; if (count( $OSWAP_789c349994f599cd9a62bd9705725982 )) { $this->red( 'Allowed daemons' . ($this->OSWAP_97171a4efa164c0e2a7633194a18d095 != '_default_' ? ' for location ' . $this->OSWAP_97171a4efa164c0e2a7633194a18d095 : '') . ': ' . implode( ', ', $OSWAP_789c349994f599cd9a62bd9705725982 ) ); } $OSWAP_4ee841eb892b12834a295c3b2481c7f0 = 0; $OSWAP_4618f0d7c1a226c44791e365e4c142e0 = $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['maxPerDaemon']; foreach ($OSWAP_ec795750d3756af641a78017b42a26a1 as $OSWAP_49467bf223aaab9b6fec8073edfe8b91 => $OSWAP_146422caacf2f9e190b0aecbbc3647b7) { if (( count( $OSWAP_789c349994f599cd9a62bd9705725982 ) && !in_array( $OSWAP_49467bf223aaab9b6fec8073edfe8b91, $OSWAP_789c349994f599cd9a62bd9705725982 ) )) { $this->red( 'Skipping daemon ' . $OSWAP_49467bf223aaab9b6fec8073edfe8b91 . '. Not in allowed daemon list.' ); continue; } if (( $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['dedip'] == 'Yes' && !$this->OSWAP_bf360a6bfcaf93eede3ed510fdf83c9c[$OSWAP_49467bf223aaab9b6fec8073edfe8b91] )) { $this->red( 'Skipping daemon ' . $OSWAP_49467bf223aaab9b6fec8073edfe8b91 . '. Dedicated IP requested but none available for this daemon.' ); continue; } $OSWAP_6590e3337b40e978dee5bbb44eff9d1a7 = $this->n1d( $OSWAP_49467bf223aaab9b6fec8073edfe8b91 ); if ($OSWAP_6590e3337b40e978dee5bbb44eff9d1a7['freeRam'] < $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ram']) { $this->red( 'Skipping daemon ' . $OSWAP_49467bf223aaab9b6fec8073edfe8b91 . '. Memory used: ' . $OSWAP_6590e3337b40e978dee5bbb44eff9d1a7['usedRam'] . '/' . $OSWAP_6590e3337b40e978dee5bbb44eff9d1a7['totalRam'] . ', free: ' . $OSWAP_6590e3337b40e978dee5bbb44eff9d1a7['freeRam'] . ', requested: ' . $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ram'] ); continue; } $OSWAP_ac46c2954cef405454b10bb975b7b63f = $OSWAP_6590e3337b40e978dee5bbb44eff9d1a7['count']; if (( $OSWAP_4618f0d7c1a226c44791e365e4c142e0 && $OSWAP_4618f0d7c1a226c44791e365e4c142e0 <= $OSWAP_ac46c2954cef405454b10bb975b7b63f )) { $this->red( 'Skipping daemon ' . $OSWAP_49467bf223aaab9b6fec8073edfe8b91 . '. Servers: ' . $OSWAP_ac46c2954cef405454b10bb975b7b63f . '/' . $OSWAP_4618f0d7c1a226c44791e365e4c142e0 ); continue; } $OSWAP_4ee841eb892b12834a295c3b2481c7f0 = $OSWAP_49467bf223aaab9b6fec8073edfe8b91; break; } if (!$OSWAP_4ee841eb892b12834a295c3b2481c7f0) { return $this->add_error( 'No suitable daemon found!' . (count( $this->OSWAP_6590e3337b40e978dee5bbb44eff9d1a ) ? ' (' . @end( $this->OSWAP_6590e3337b40e978dee5bbb44eff9d1a ) . ')' : '') ); } $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['daemonId'] = $OSWAP_4ee841eb892b12834a295c3b2481c7f0; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['port'] = ''; $this->red( 'Creating server on daemon ' . $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['daemonId'] ); return true; } function ckip() { $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f = @preg_split('/\s+/', $this->OSWAP_a72387886992b5bc2be36aa035545d5c); if (!is_array( $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f )) { $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f = array( ); } $OSWAP_0944643fb253176719eb29e4d74f5947 = array( ); $OSWAP_0e1e4d39079bf30bdc4e1d88f1a84e1b = 0; while ($OSWAP_0e1e4d39079bf30bdc4e1d88f1a84e1b < count( $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f )) { ++$OSWAP_0e1e4d39079bf30bdc4e1d88f1a84e1b; $OSWAP_2e4f192efbefaeb625aefab45a418947 = explode( ',', $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f[$OSWAP_0e1e4d39079bf30bdc4e1d88f1a84e1b] ); $OSWAP_a72387886992b5bc2be36aa035545d5c5 = false; if (( !$OSWAP_2e4f192efbefaeb625aefab45a418947 || count( $OSWAP_2e4f192efbefaeb625aefab45a418947 ) < 2 )) { $OSWAP_2e4f192efbefaeb625aefab45a418947 = $OSWAP_2e4f192efbefaeb625aefab45a418947[0]; } else { $OSWAP_a72387886992b5bc2be36aa035545d5c5 = (int)$OSWAP_2e4f192efbefaeb625aefab45a418947[0]; $OSWAP_2e4f192efbefaeb625aefab45a418947 = $OSWAP_2e4f192efbefaeb625aefab45a418947[1]; } if (!strlen( $OSWAP_2e4f192efbefaeb625aefab45a418947 )) { continue; } if (( $OSWAP_a72387886992b5bc2be36aa035545d5c5 === false || $OSWAP_a72387886992b5bc2be36aa035545d5c5 == $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['daemonId'] )) { $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 = $OSWAP_2e4f192efbefaeb625aefab45a418947; $OSWAP_0944643fb253176719eb29e4d74f5947[] = $OSWAP_0e1e4d39079bf30bdc4e1d88f1a84e1b; break; } } if ($this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['dedip'] == 'No') { $this->red( 'Not assigning dedicated IP.' ); return true; } if ($this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['dedip'] == 'Yes') { $this->red( 'Requiring dedicated IP.' ); } else { $this->red( 'Getting server IP' ); } foreach (array_reverse( $OSWAP_0944643fb253176719eb29e4d74f5947 ) as $OSWAP_ed20399567eadb5e9325f5163df9d330) { unset( $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f[$OSWAP_ed20399567eadb5e9325f5163df9d330] ); } if (strlen( $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 )) { $this->OSWAP_07803246939b98c10152336f1790baa5 = true; $this->OSWAP_a72387886992b5bc2be36aa035545d5c = implode( "\n", $OSWAP_2d187c5847e9cdb3668ac1e9a89ba74f ); $this->red( 'Using IP from "Assigned IP Addresses" list: ' . $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 ); $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 = explode( ':', $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 ); if (( $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 && count( $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 ) == 2 )) { $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['port'] = $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4[1]; } $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ip'] = $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4[0]; } else { if ($this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['dedip'] == 'Yes') { return $this->add_error( 'No dedicated IP available on daemon ' . $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['daemonId'] . '!' ); } } return true; } function nb4() { $OSWAP_0ac86d0f50e40839847a7d812c4772eb = D()->query( 'update 服务 set 用户名=\'' . D()->real_escape_string( $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] ) . '\',' . ' 密码=\'' . D()->real_escape_string( encrypt( $this->OSWAP_6322c28b1574d514832c9265baaa1af9['password'] ) ) . '\'' . ' where `id`=' . D()->real_escape_string( intval( $this->OSWAP_693bcaf7e2e5618fbebf60103ddd7f70 ) ) ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb) { return $this->add_error( 'Failed to set service user/pass'); } return true; } function createUser() { if (!strlen( $this->OSWAP_6322c28b1574d514832c9265baaa1af9['email'] )) { return $this->add_error( 'No email address found, aborting.' ); } $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->findUsers( 'email', '=' . $this->OSWAP_6322c28b1574d514832c9265baaa1af9['email'] ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Error finding user by mail "' . $this->OSWAP_6322c28b1574d514832c9265baaa1af9['email'] . '": ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $OSWAP_cfd1ca443d4d9c8d5eb5577bd2aefd8b = $OSWAP_0ac86d0f50e40839847a7d812c4772eb['data']['Users']; $this->OSWAP_0954080bad6187d3debef64aef286cdd = 0; foreach ($OSWAP_cfd1ca443d4d9c8d5eb5577bd2aefd8b as $OSWAP_e487f31e36b6832b65e48606cf27d792 => $OSWAP_e347f52740705944f0b5f2eb9eb8c2de) { $this->OSWAP_0954080bad6187d3debef64aef286cdd = $OSWAP_e487f31e36b6832b65e48606cf27d792; $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] = $OSWAP_e347f52740705944f0b5f2eb9eb8c2de; $this->red( 'Found user "' . $OSWAP_e347f52740705944f0b5f2eb9eb8c2de . '" (' . $OSWAP_e487f31e36b6832b65e48606cf27d792 . ') with same email (' . $this->OSWAP_6322c28b1574d514832c9265baaa1af9['email'] . '). Reusing.' ); return $this->nb4( ); } $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->createUser( $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'], $this->OSWAP_6322c28b1574d514832c9265baaa1af9['email'], $this->OSWAP_6322c28b1574d514832c9265baaa1af9['password'] ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Error creating user "' . $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] . '": ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $this->OSWAP_0954080bad6187d3debef64aef286cdd = $OSWAP_0ac86d0f50e40839847a7d812c4772eb['data']['id']; $this->red( 'Created user ' . $this->OSWAP_0954080bad6187d3debef64aef286cdd ); return $this->nb4( ); } function createServer() { $OSWAP_7d9caaccc6dfe344c0f5e8feec1e44f9 = preg_replace( '/[^-_\w\d .!()]/', '_', $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] ); $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->createServer( $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] . '\'s Minecraft Server', 25564, $OSWAP_7d9caaccc6dfe344c0f5e8feec1e44f9 . '_' . $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['port'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['slots'] ); $OSWAP_e487f31e36b6832b65e48606cf27d792 = 0; if (( !$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success'] || !$OSWAP_e487f31e36b6832b65e48606cf27d792 = $OSWAP_0ac86d0f50e40839847a7d812c4772eb['data']['id'] )) { return $this->add_error( 'Error creating server: ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $this->red( 'Created server ' . $OSWAP_e487f31e36b6832b65e48606cf27d792 ); $OSWAP_4301ba4f16cf4961a16fa2c63fb9a68b = array( 'No Access' => 0, 'Guest' => 10, 'User' => 20, 'Moderator' => 30 ); $OSWAP_a27d7f265e743fa36f8da4ca94a04df7 = $OSWAP_4301ba4f16cf4961a16fa2c63fb9a68b[$this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a[@'default_role']]; if (!$OSWAP_a27d7f265e743fa36f8da4ca94a04df7) { $OSWAP_a27d7f265e743fa36f8da4ca94a04df7 = 0; } $OSWAP_4e75450c01210090b8f249b230788163 = array( 'Owner only' => 0, 'By Default Role' => 1, 'Users with Roles only' => 2 ); $OSWAP_2b46198a83f7e8d98aeb9a52018a3bc4 = $OSWAP_4e75450c01210090b8f249b230788163[$this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a[@'visibility']]; if (!$OSWAP_2b46198a83f7e8d98aeb9a52018a3bc4) { $OSWAP_2b46198a83f7e8d98aeb9a52018a3bc4 = 0; } $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->findServers( 'dir', '=server' . $OSWAP_e487f31e36b6832b65e48606cf27d792 ); if (( is_array( $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'Servers'] ) && count( $OSWAP_0ac86d0f50e40839847a7d812c4772eb['data']['Servers'] ) )) { $OSWAP_7d9caaccc6dfe344c0f5e8feec1e44f9 = $OSWAP_7d9caaccc6dfe344c0f5e8feec1e44f9 . '_' . $OSWAP_e487f31e36b6832b65e48606cf27d792; } else { $OSWAP_7d9caaccc6dfe344c0f5e8feec1e44f9 = 'server' . $OSWAP_e487f31e36b6832b65e48606cf27d792; } $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->updateServer( $OSWAP_e487f31e36b6832b65e48606cf27d792, array( 'daemon_id', 'memory', 'jarfile', 'jardir', 'default_level', 'ip', 'port', 'dir' ), array( $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['daemonId'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ram'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['jarfile'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['jardir'], $OSWAP_a27d7f265e743fa36f8da4ca94a04df7, $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ip'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['port'], $OSWAP_7d9caaccc6dfe344c0f5e8feec1e44f9 ) ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Failed to update server: ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->updateServerConfig( $OSWAP_e487f31e36b6832b65e48606cf27d792, array( 'user_jar', 'user_name', 'user_schedule', 'user_ftp', 'user_visibility', 'visible' ), array( $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_jar'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_name'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_tasks'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_ftp'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_visibility'], $OSWAP_2b46198a83f7e8d98aeb9a52018a3bc4 ) ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Failed to update server config: ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $this->OSWAP_aa9572bd29434d64e734abb49d337018->setServerOwner( $OSWAP_e487f31e36b6832b65e48606cf27d792, $this->OSWAP_0954080bad6187d3debef64aef286cdd ); $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->getServer( $OSWAP_e487f31e36b6832b65e48606cf27d792 ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Error getting new server information for server' . $OSWAP_e487f31e36b6832b65e48606cf27d792 . ': ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['port'] = $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'Server'][@'port']; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ip'] = $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'Server'][@'ip']; if ($this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ftp']) { $this->OSWAP_aa9572bd29434d64e734abb49d337018->setUserFtpAccess( $this->OSWAP_0954080bad6187d3debef64aef286cdd, $OSWAP_e487f31e36b6832b65e48606cf27d792, 'rw' ); } if ($this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['start']) { $this->OSWAP_aa9572bd29434d64e734abb49d337018->startServer( $OSWAP_e487f31e36b6832b65e48606cf27d792 ); } $this->OSWAP_84d0a5abf123b3d4910998094450e970 = $OSWAP_e487f31e36b6832b65e48606cf27d792; $this->red( 'Server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . ' configured' . ($this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['start'] ? ' and started' : '') ); return true; } function createPlayer() { $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->createPlayer( $this->OSWAP_84d0a5abf123b3d4910998094450e970, $this->OSWAP_6322c28b1574d514832c9265baaa1af9['username'] ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->red( 'Error creating player for server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . ': ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $OSWAP_12e3d4a5d09aac4bfcb0a03fc5339ccd = $OSWAP_0ac86d0f50e40839847a7d812c4772eb['data']['id']; $this->OSWAP_aa9572bd29434d64e734abb49d337018->assignPlayerToUser( $OSWAP_12e3d4a5d09aac4bfcb0a03fc5339ccd, $this->OSWAP_0954080bad6187d3debef64aef286cdd ); $this->red( 'Created player ' . $OSWAP_12e3d4a5d09aac4bfcb0a03fc5339ccd ); return true; } function r208($OSWAP_7b9f432c7b90f22f15fa33c120f60a00, $OSWAP_d91a39dedc04c24e2650ab5167879af1 = true) { $this->OSWAP_f163b8a6823c9cde3d3fbde9dff9fab9 = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['clientsdetails']['userid']; $this->OSWAP_693bcaf7e2e5618fbebf60103ddd7f70 = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['serviceid']; $OSWAP_0ac86d0f50e40839847a7d812c4772eb = D()->query( 'select 域名 from 服务 where `id`=' . D()->real_escape_string( intval( $this->OSWAP_693bcaf7e2e5618fbebf60103ddd7f70 ) ) ); if ($OSWAP_0ac86d0f50e40839847a7d812c4772eb) { $OSWAP_22b898ce63ad9b65e69c89a6ad080928 = D()->fetch_row( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ); D()->free(); if (( is_array( $OSWAP_22b898ce63ad9b65e69c89a6ad080928 ) && count( $OSWAP_22b898ce63ad9b65e69c89a6ad080928 ) )) { $this->OSWAP_84d0a5abf123b3d4910998094450e970 = (int)$OSWAP_22b898ce63ad9b65e69c89a6ad080928[0]; } else { $this->OSWAP_84d0a5abf123b3d4910998094450e970 = 0; } } if (( !$this->OSWAP_84d0a5abf123b3d4910998094450e970 && $OSWAP_d91a39dedc04c24e2650ab5167879af1 )) { return $this->add_error( 'No server for service ' . $this->OSWAP_693bcaf7e2e5618fbebf60103ddd7f70 . '!' ); } return true; } function r08($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $this->OSWAP_b2737f962e9b1aed14c0297dfa800437 = $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['serverid']; $this->r208( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 ); return true; } function r85() { $this->red( 'Terminating server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . '. ' . ($this->OSWAP_46c7b191c106a00ecdae4db3edfa1aaa ? 'Deleting' : 'Not deleting') . ' Worlds.' ); $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->getServer( $this->OSWAP_84d0a5abf123b3d4910998094450e970 ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Error getting current server information for server' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . ': ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $OSWAP_be6f4503abb57a361a4ffac34e0ebf89 = $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'Server'][@'daemon_id']; $OSWAP_6212482c05838e40e9c55c15d5ab78b8 = $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'Server'][@'port']; $OSWAP_372bbc56856f82345b0fe1b5cb0c5e4e = $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'Server'][@'ip']; if ($this->OSWAP_46c7b191c106a00ecdae4db3edfa1aaa) { $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->stopServer( $this->OSWAP_84d0a5abf123b3d4910998094450e970 ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { $this->red( 'Warning: Failed to stop server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . ' (worlds will not get deleted): ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } } $OSWAP_32ea3b17bf3d416794a6a907a0bd8053 = $this->OSWAP_c0393c433b33fb570dd0e46d7c80764f; $OSWAP_0e1e4d39079bf30bdc4e1d88f1a84e1b = 0; while ($OSWAP_0e1e4d39079bf30bdc4e1d88f1a84e1b < $OSWAP_32ea3b17bf3d416794a6a907a0bd8053) { $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->deleteServer( $this->OSWAP_84d0a5abf123b3d4910998094450e970, ($this->OSWAP_46c7b191c106a00ecdae4db3edfa1aaa ? 'yes' : 'no') ); if ($OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { break; } $OSWAP_112d909d3f858bf043887f3aa2a8b98b = (isset( $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'errors'][0][@'deleteDir'][0] ) ? $OSWAP_0ac86d0f50e40839847a7d812c4772eb['errors'][0]['deleteDir'][0] : ''); if (( $OSWAP_0e1e4d39079bf30bdc4e1d88f1a84e1b < $OSWAP_32ea3b17bf3d416794a6a907a0bd8053 - 1 && @preg_match( @'/Server still running/', $OSWAP_112d909d3f858bf043887f3aa2a8b98b ) )) { $this->red( 'Server still running, waiting for one second' ); sleep( 1 ); } else { return $this->add_error( 'Failed to terminate server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . ': ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } ++$OSWAP_0e1e4d39079bf30bdc4e1d88f1a84e1b; } if (( $OSWAP_372bbc56856f82345b0fe1b5cb0c5e4e && $OSWAP_372bbc56856f82345b0fe1b5cb0c5e4e != '0.0.0.0' )) { $this->n92( ); if (( $this->r026( $OSWAP_be6f4503abb57a361a4ffac34e0ebf89, $OSWAP_372bbc56856f82345b0fe1b5cb0c5e4e, $OSWAP_6212482c05838e40e9c55c15d5ab78b8 ) && $this->r3c( $OSWAP_be6f4503abb57a361a4ffac34e0ebf89, $OSWAP_372bbc56856f82345b0fe1b5cb0c5e4e, $OSWAP_6212482c05838e40e9c55c15d5ab78b8 ) )) { $OSWAP_0ac86d0f50e40839847a7d812c4772eb = D()->query( 'update 服务器表 set 分配的IP地址=\'' . D()->real_escape_string( $this->OSWAP_a72387886992b5bc2be36aa035545d5c ) . '\'' . ' where `id`=' . D()->real_escape_string( intval( $this->OSWAP_b2737f962e9b1aed14c0297dfa800437 ) ) ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb) { $this->add_error( 'Warning: Failed to add IP ' . $OSWAP_372bbc56856f82345b0fe1b5cb0c5e4e . ':' . $OSWAP_6212482c05838e40e9c55c15d5ab78b8 . ' back to "Assigned IP Addresses"!' ); } } } else { $this->red( 'IP ' . $OSWAP_372bbc56856f82345b0fe1b5cb0c5e4e . ' won\'t be written back' ); } return true; } function r5b($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { if (!strlen( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['username'] )) { return $this->add_error( 'No username specified' ); } $OSWAP_0ac86d0f50e40839847a7d812c4772eb = D()->query( 'update 服务 set 密码=\'' . D()->real_escape_string( encrypt( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['password'] ) ) . '\'' . ' where 帐号id=' . D()->real_escape_string( intval( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['clientsdetails']['userid'] ) ) . ' and 服务器id=' . D()->real_escape_string( intval( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['serverid'] ) ) . ' and 用户名=\'' . D()->real_escape_string( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['username'] ) . '\'' ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb) { $this->red( 'Failed to update other services using the same Multicraft user'); } $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->findUsers( 'name', '=' . $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['username'] ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Error finding user "' . $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['username'] . '": ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $OSWAP_cfd1ca443d4d9c8d5eb5577bd2aefd8b = $OSWAP_0ac86d0f50e40839847a7d812c4772eb['data']['Users']; if (( !is_array( $OSWAP_cfd1ca443d4d9c8d5eb5577bd2aefd8b ) || count( $OSWAP_cfd1ca443d4d9c8d5eb5577bd2aefd8b ) !== 1 )) { return $this->add_error( 'No exact match for user search "' . $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['username'] . '"' ); } $this->OSWAP_0954080bad6187d3debef64aef286cdd = 0; foreach ($OSWAP_cfd1ca443d4d9c8d5eb5577bd2aefd8b as $OSWAP_e487f31e36b6832b65e48606cf27d792 => $OSWAP_e347f52740705944f0b5f2eb9eb8c2de) { $this->OSWAP_0954080bad6187d3debef64aef286cdd = $OSWAP_e487f31e36b6832b65e48606cf27d792; $this->red( 'Found user "' . $OSWAP_e347f52740705944f0b5f2eb9eb8c2de . '": ' . $OSWAP_e487f31e36b6832b65e48606cf27d792 ); break; } if (!$this->OSWAP_0954080bad6187d3debef64aef286cdd) { return $this->add_error( 'Unable to find Multicraft user "' . $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['username'] . '" for updating' ); } $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->updateUser( $this->OSWAP_0954080bad6187d3debef64aef286cdd, 'password', $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['password'] ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Error updating user password: ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } return true; } function rbf7() { $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->getServer( $this->OSWAP_84d0a5abf123b3d4910998094450e970 ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Error getting current server information for server' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . ': ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $OSWAP_4f48c545a54442e97d78f301576827db = $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'Server'][@'memory']; $OSWAP_be6f4503abb57a361a4ffac34e0ebf89 = $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'Server'][@'daemon_id']; $OSWAP_6212482c05838e40e9c55c15d5ab78b8 = $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'Server'][@'port']; $OSWAP_372bbc56856f82345b0fe1b5cb0c5e4e = $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'Server'][@'ip']; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['daemonId'] = $OSWAP_be6f4503abb57a361a4ffac34e0ebf89; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['port'] = $OSWAP_6212482c05838e40e9c55c15d5ab78b8; $this->updateServer( ); $OSWAP_64188cd7a65fd3652295fa31dbab82c7 = $this->r026( $OSWAP_be6f4503abb57a361a4ffac34e0ebf89, $OSWAP_372bbc56856f82345b0fe1b5cb0c5e4e, $OSWAP_6212482c05838e40e9c55c15d5ab78b8 ); if (( ( $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['daemonId'] != $OSWAP_be6f4503abb57a361a4ffac34e0ebf89 || ( $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['dedip'] == 'Yes' && !$OSWAP_64188cd7a65fd3652295fa31dbab82c7 ) ) || ( $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['dedip'] == 'No' && $OSWAP_64188cd7a65fd3652295fa31dbab82c7 ) )) { $this->n92( ); if (!$this->ckip( )) { return false; } if ($OSWAP_64188cd7a65fd3652295fa31dbab82c7) { $this->r3c( $OSWAP_be6f4503abb57a361a4ffac34e0ebf89, $OSWAP_372bbc56856f82345b0fe1b5cb0c5e4e, $OSWAP_6212482c05838e40e9c55c15d5ab78b8 ); } $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->updateServer( $this->OSWAP_84d0a5abf123b3d4910998094450e970, array( 'ip', 'port' ), array( $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ip'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['port'] ) ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Failed to set new server IP: ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->getServer( $this->OSWAP_84d0a5abf123b3d4910998094450e970 ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Error getting new server information for server' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . ': ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['port'] = $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'Server'][@'port']; $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ip'] = $OSWAP_0ac86d0f50e40839847a7d812c4772eb[@'data'][@'Server'][@'ip']; if (!$this->rdc( )) { return false; } } if ($this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['daemonId'] != $OSWAP_be6f4503abb57a361a4ffac34e0ebf89) { $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->sendServerControl( $this->OSWAP_84d0a5abf123b3d4910998094450e970, 'migrate ' . $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['daemonId'] ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { $this->add_error( 'Server migrate command failed for server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . ': ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $this->red( 'Server migrate command sent to daemon ' . $OSWAP_be6f4503abb57a361a4ffac34e0ebf89 . ', moving to daemon ' . $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['daemonId'] ); } return true; } function r026($OSWAP_a72387886992b5bc2be36aa035545d5c5, $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4, $OSWAP_67b74d6df048b40fcbc8a012dc98bccb) { $this->red( 'Checking for dedicated IP: ' . $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 ); $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->getConnection( $OSWAP_a72387886992b5bc2be36aa035545d5c5 ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Error getting daemon ' . $OSWAP_a72387886992b5bc2be36aa035545d5c5 . ': ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $OSWAP_cdbabf9c0ba6159f82c3156e80951d67 = $OSWAP_0ac86d0f50e40839847a7d812c4772eb['data']['Daemon']['ip']; if (( ( strlen( $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 ) && $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 != '0.0.0.0' ) && $OSWAP_cdbabf9c0ba6159f82c3156e80951d67 != $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 )) { $this->red( 'Dedicated IP.' ); return true; } $this->red( 'No dedicated IP.' ); return false; } function r3c($OSWAP_a72387886992b5bc2be36aa035545d5c5, $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4, $OSWAP_67b74d6df048b40fcbc8a012dc98bccb) { $this->red( 'Recycling IP ' . $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 ); $this->OSWAP_a72387886992b5bc2be36aa035545d5c .= '
' . $OSWAP_a72387886992b5bc2be36aa035545d5c5 . ',' . $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4; $this->OSWAP_07803246939b98c10152336f1790baa5 = true; $this->red( 'IP ' . $OSWAP_2650a5fe098de78eca2a1d7f49df3ba4 . ' will be written back to assigned IPs list' ); return true; } function updateServer() { $this->red( 'Updating server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 ); $OSWAP_e487f31e36b6832b65e48606cf27d792 = $this->OSWAP_84d0a5abf123b3d4910998094450e970; $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->updateServer( $OSWAP_e487f31e36b6832b65e48606cf27d792, array( 'memory', 'players' ), array( $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ram'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['slots'] ) ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Failed to update server: ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } $OSWAP_0ac86d0f50e40839847a7d812c4772eb = $this->OSWAP_aa9572bd29434d64e734abb49d337018->updateServerConfig( $OSWAP_e487f31e36b6832b65e48606cf27d792, array( 'user_jar', 'user_name', 'user_schedule', 'user_ftp' ), array( $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_jar'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_name'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_tasks'], $this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['user_ftp'] ) ); if (!$OSWAP_0ac86d0f50e40839847a7d812c4772eb['success']) { return $this->add_error( 'Failed to update server config: ' . $this->nd9( $OSWAP_0ac86d0f50e40839847a7d812c4772eb ) ); } if ($this->OSWAP_ed2c6a812cd63c8b85d486ba4e5e045a['ftp']) { $this->OSWAP_aa9572bd29434d64e734abb49d337018->setUserFtpAccess( $this->OSWAP_0954080bad6187d3debef64aef286cdd, $OSWAP_e487f31e36b6832b65e48606cf27d792, 'rw' ); } else { $this->OSWAP_aa9572bd29434d64e734abb49d337018->setUserFtpAccess( $this->OSWAP_0954080bad6187d3debef64aef286cdd, $OSWAP_e487f31e36b6832b65e48606cf27d792, '' ); } $this->red( 'Server ' . $this->OSWAP_84d0a5abf123b3d4910998094450e970 . ' re-configured' ); return true; } } function multicraft_ConfigOptions() { return array( '玩家数量限制' => array( 'Type' => 'text', 'Size' => '20', 'Description' => '' ), 'MC服务器RAM内存' => array( 'Type' => 'text', 'Size' => '20', 'Description' => '' ), 'JAR文件' => array( 'Type' => 'text', 'Options' => '', 'Description' => '为空为默认' ), 'JAR文件在什么地方' => array( 'Type' => 'dropdown', 'Options' => 'Daemon JAR directory,Server JAR directory,Server base directory', 'Description' => '' ), '客户可以选择JAR' => array( 'Type' => 'dropdown', 'Options' => 'No,Yes', 'Description' => '' ), '客户可以更换服务器名称' => array( 'Type' => 'dropdown', 'Options' => 'Yes,No', 'Description' => '' ), '客户计划任务' => array( 'Type' => 'dropdown', 'Options' => 'Yes,No', 'Description' => '' ), '客户可以管理FTP' => array( 'Type' => 'dropdown', 'Options' => 'No,Yes', 'Description' => '' ), '客户可更改可见度' => array( 'Type' => 'dropdown', 'Options' => 'Yes,No', 'Description' => '' ), '默认角色' => array( 'Type' => 'dropdown', 'Options' => 'Guest,No Access,User,Moderator', 'Description' => '"No Access" = whitelist' ), '服务器可见' => array( 'Type' => 'dropdown', 'Options' => 'By Default Role,Owner only,Users with Roles only', 'Description' => '' ), '启动服务器' => array( 'Type' => 'dropdown', 'Options' => 'Yes,No', 'Description' => '' ), '独立IP' => array( 'Type' => 'dropdown', 'Options' => 'No,If available,Yes', 'Description' => '' ), '创建FTP账户' => array( 'Type' => 'dropdown', 'Options' => 'Yes,No', 'Description' => '' ), '开启守护进程' => array( 'Type' => 'text', 'Size' => '20', 'Description' => '为空为全部,否则请列出守护进程ID,逗号分割' ), '服务器最大守护进程数量' => array( 'Type' => 'text', 'Size' => '20', 'Description' => '为空无限' ), '计算使用RAM内存' => array( 'Type' => 'dropdown', 'Options' => 'Include suspended,Exclude suspended', 'Description' => '' ), '停止时候删除世界' => array( 'Type' => 'dropdown', 'Options' => 'No,Yes', 'Description' => '' ), '开启日志邮件' => array( 'Type' => 'dropdown', 'Options' => 'Only on Errors,Yes,No', 'Description' => '' ), '日志邮件的收件人' => array( 'Type' => 'text', 'Size' => '20', 'Description' => '' ) ); } function multicraft_CreateAccount($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $OSWAP_ba4b035ebc299108eaf49738ab8d99b9 = new n9a ( ); return $OSWAP_ba4b035ebc299108eaf49738ab8d99b9->install( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 ); } function multicraft_TerminateAccount($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $OSWAP_ba4b035ebc299108eaf49738ab8d99b9 = new n9a ( ); return $OSWAP_ba4b035ebc299108eaf49738ab8d99b9->terminate( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 ); } function multicraft_SuspendAccount($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $OSWAP_ba4b035ebc299108eaf49738ab8d99b9 = new n9a ( ); return $OSWAP_ba4b035ebc299108eaf49738ab8d99b9->suspend( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 ); } function multicraft_UnsuspendAccount($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $OSWAP_ba4b035ebc299108eaf49738ab8d99b9 = new n9a ( ); return $OSWAP_ba4b035ebc299108eaf49738ab8d99b9->unsuspend( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 ); } function multicraft_ChangePassword($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $OSWAP_ba4b035ebc299108eaf49738ab8d99b9 = new n9a ( ); return $OSWAP_ba4b035ebc299108eaf49738ab8d99b9->n2f( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 ); } function multicraft_ChangePackage($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $OSWAP_ba4b035ebc299108eaf49738ab8d99b9 = new n9a ( ); return $OSWAP_ba4b035ebc299108eaf49738ab8d99b9->n4a( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00 ); } function multicraft_ClientArea($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { return array('<a href="' . $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['serverhostname'] . '/index.php" target="_blank">登入到Multicraft</a>'); } function multicraft_AdminLink($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { return '<a href="' . $OSWAP_7b9f432c7b90f22f15fa33c120f60a00['serverhostname'] . '/index.php" target="_blank">登入到Multicraft</a>'; } function multicraft_AdminCustomButtonArray() { return array( 'Start Server' => 'start', 'Stop Server' => 'stop', 'Restart Server' => 'restart' ); } function multicraft_start($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $OSWAP_ba4b035ebc299108eaf49738ab8d99b9 = new n9a ( ); return $OSWAP_ba4b035ebc299108eaf49738ab8d99b9->n65( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00, 'start' ); } function multicraft_stop($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $OSWAP_ba4b035ebc299108eaf49738ab8d99b9 = new n9a ( ); return $OSWAP_ba4b035ebc299108eaf49738ab8d99b9->n65( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00, 'stop' ); } function multicraft_restart($OSWAP_7b9f432c7b90f22f15fa33c120f60a00) { $OSWAP_ba4b035ebc299108eaf49738ab8d99b9 = new n9a ( ); return $OSWAP_ba4b035ebc299108eaf49738ab8d99b9->n65( $OSWAP_7b9f432c7b90f22f15fa33c120f60a00, 'restart' ); } function multicraft_ClientAreaLIB($OSWAP_3ff4e0c5873ae2c24e6875602bc70c76,&$OSWAP_921dd8ea5abebe340cf22150377e65d2) { $OSWAP_921dd8ea5abebe340cf22150377e65d2['主机名']=''; } add_swap_plug('产品控制面板详情','multicraft_ClientAreaLIB'); 