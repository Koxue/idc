<?php  function postop($OSWAP_8c8c4a0c3f6d2b3c3ddca882874a135c,$OSWAP_f3595e248902383c8776b2aee6e98fad,$OSWAP_b48ba3a6bc7bdc0160e39cdf5d7aa3c9){ $OSWAP_76555842c29001de717608522222c30f = array ( "FreeHostAPI: swapidc.com", "FreeHostAPIIP: ".$_SERVER["SERVER_ADDR"], "FreeHostAPISITE: ".$_SERVER["HTTP_HOST"] ); $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, "http://".$OSWAP_8c8c4a0c3f6d2b3c3ddca882874a135c.$OSWAP_f3595e248902383c8776b2aee6e98fad); curl_setopt($ch, CURLOPT_POST, true); curl_setopt($ch, CURLOPT_HEADER,1); curl_setopt($ch, CURLOPT_RETURNTRANSFER,1); curl_setopt($ch, CURLOPT_HTTPHEADER, $OSWAP_76555842c29001de717608522222c30f); curl_setopt($ch, CURLOPT_COOKIE,session("cookie")); curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($OSWAP_b48ba3a6bc7bdc0160e39cdf5d7aa3c9)); $content=curl_exec($ch); @preg_match('/Set-Cookie:(.*);/iU',$content,$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247); session("cookie",session("cookie").'&'.$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1]); curl_close($ch); return iconv('GB2312', 'UTF-8', $content); } function getop($OSWAP_8c8c4a0c3f6d2b3c3ddca882874a135c,$OSWAP_f3595e248902383c8776b2aee6e98fad,$OSWAP_b48ba3a6bc7bdc0160e39cdf5d7aa3c9){ $OSWAP_76555842c29001de717608522222c30f = array ( "FreeHostAPI: swapidc.com", "FreeHostAPIIP: ".$_SERVER["SERVER_ADDR"], "FreeHostAPISITE: ".$_SERVER["HTTP_HOST"] ); $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, "http://".$OSWAP_8c8c4a0c3f6d2b3c3ddca882874a135c.$OSWAP_f3595e248902383c8776b2aee6e98fad."?".$OSWAP_b48ba3a6bc7bdc0160e39cdf5d7aa3c9); curl_setopt($ch, CURLOPT_HEADER,1); curl_setopt($ch, CURLOPT_RETURNTRANSFER,1); curl_setopt($ch, CURLOPT_HTTPHEADER, $OSWAP_76555842c29001de717608522222c30f); curl_setopt($ch, CURLOPT_COOKIE,session("cookie")); $content=curl_exec($ch); @preg_match('/Set-Cookie:(.*);/iU',$content,$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247); session("cookie",session("cookie").'&'.$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1]); curl_close($ch); return iconv('GB2312', 'UTF-8', $content); } function xingwai_ConfigOptions() { $configarray = array( "产品ID" => array("Type" => "text","Description" => "星外产品的id"), "产品类型" => array( "Type" => "dropdown", "Options" => "vps") ); return $configarray; } function xingwai_CreateAccount($OSWAP_b746aa222f03232b630816e377db2ed2) { if(empty($OSWAP_b746aa222f03232b630816e377db2ed2["buyoptions"]['服务器用户名'])) $OSWAP_b5609e72dab4347e92fcab21ce3b5c8b=$OSWAP_b746aa222f03232b630816e377db2ed2["username"]; else $OSWAP_b5609e72dab4347e92fcab21ce3b5c8b=$OSWAP_b746aa222f03232b630816e377db2ed2["buyoptions"]['服务器用户名']; $OSWAP_6d6606566903f52a20ddac99bb6c7301=explode('.',$OSWAP_b746aa222f03232b630816e377db2ed2["buyoptions"]['选择机房']); $temp=POSTOP($OSWAP_b746aa222f03232b630816e377db2ed2["serverhostname"],"/user/userlogin.asp",array("username"=>$OSWAP_b746aa222f03232b630816e377db2ed2["serverusername"],"password"=>$OSWAP_b746aa222f03232b630816e377db2ed2["serverpassword"])); if(empty($temp)) return '连接服务器失败'; if(!strstr($temp,'Location: logininfo.asp')){ @preg_match('/e=(.*)\n/iU',$temp,$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247); return '服务器登入错误:'.$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1]; } $OSWAP_e378ed9b010a63c400420de5f22d2206=xingwai_days($OSWAP_b746aa222f03232b630816e377db2ed2); $content=POSTOP($OSWAP_b746aa222f03232b630816e377db2ed2["serverhostname"],"/user/selfvps2.asp",array("vpsname"=>$OSWAP_b5609e72dab4347e92fcab21ce3b5c8b,"VPSpassword"=>$OSWAP_b746aa222f03232b630816e377db2ed2["password"],"year"=>$OSWAP_e378ed9b010a63c400420de5f22d2206[0],"id"=>$OSWAP_b746aa222f03232b630816e377db2ed2["configoption1"],"ServerlistID"=>$OSWAP_6d6606566903f52a20ddac99bb6c7301[0])); if(!empty($OSWAP_b746aa222f03232b630816e377db2ed2["buyoptions"]['服务器用户名'])){ update_query("服务",array("用户名"=>$OSWAP_b746aa222f03232b630816e377db2ed2["buyoptions"]['服务器用户名']),array("id"=> $OSWAP_b746aa222f03232b630816e377db2ed2["serviceid"])); delete_query("主机自定义配置选项",array('服务id'=>$OSWAP_b746aa222f03232b630816e377db2ed2["serviceid"],'名字'=>'服务器用户名')); } if(strstr($content,'云服务器开通成功')){ @preg_match('/id=(.*)&/iU',$content,$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247); update_query("服务",array("域名"=>$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1]),array("id"=> $OSWAP_b746aa222f03232b630816e377db2ed2["serviceid"])); $OSWAP_b746aa222f03232b630816e377db2ed2["domain"]=$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1]; if(isset($OSWAP_e378ed9b010a63c400420de5f22d2206[1])){ unset($OSWAP_e378ed9b010a63c400420de5f22d2206[0]); foreach($OSWAP_e378ed9b010a63c400420de5f22d2206 as $OSWAP_375a355fd37d13c4de925c12d24765fd){ if(xingwai_xufei($OSWAP_b746aa222f03232b630816e377db2ed2,$OSWAP_375a355fd37d13c4de925c12d24765fd)!='成功'){ xingwai_xufei($OSWAP_b746aa222f03232b630816e377db2ed2,$OSWAP_375a355fd37d13c4de925c12d24765fd); } } } return '成功'; } @preg_match('/e=(.*)\n/iU',$content,$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247); if(strstr($OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1],'IP资源已用光')){ return '公开信息:该产品IP资源已经用光,请联系管理员补充!!'; } return $OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1]; } function xingwai_xufei($OSWAP_b746aa222f03232b630816e377db2ed2,$OSWAP_a4877c86d8e1b5cad57ccdb5f5d25ea7){ $temp=POSTOP($OSWAP_b746aa222f03232b630816e377db2ed2["serverhostname"],"/user/userlogin.asp",array("username"=>$OSWAP_b746aa222f03232b630816e377db2ed2["serverusername"],"password"=>$OSWAP_b746aa222f03232b630816e377db2ed2["serverpassword"])); if(empty($temp)) return '连接服务器失败'; if(!strstr($temp,'Location: logininfo.asp')){ @preg_match('/e=(.*)\n/iU',$temp,$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247); return '服务器登入错误:'.$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1]; } GETOP($OSWAP_b746aa222f03232b630816e377db2ed2["serverhostname"],"/user/vpsadm2.asp","id=".$OSWAP_b746aa222f03232b630816e377db2ed2["domain"]."&go=c"); $content=POSTOP($OSWAP_b746aa222f03232b630816e377db2ed2["serverhostname"],"/vpsadm/selfvpsmodifyendtime.asp",array("year"=>$OSWAP_a4877c86d8e1b5cad57ccdb5f5d25ea7,"id"=>$OSWAP_b746aa222f03232b630816e377db2ed2["domain"])); if(strstr($content,'服务器延期成功')) return '成功'; else{ @preg_match('/e=(.*)\n/iU',$content,$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247); return $OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1]; } } function xingwai_day(&$OSWAP_e378ed9b010a63c400420de5f22d2206,&$OSWAP_375a355fd37d13c4de925c12d24765fd,$lx){ if($lx==1){ if($OSWAP_375a355fd37d13c4de925c12d24765fd>=5){ $OSWAP_e378ed9b010a63c400420de5f22d2206[]=5; $OSWAP_375a355fd37d13c4de925c12d24765fd=$OSWAP_375a355fd37d13c4de925c12d24765fd-5; return ($OSWAP_375a355fd37d13c4de925c12d24765fd!=0); } if($OSWAP_375a355fd37d13c4de925c12d24765fd>=4){ $OSWAP_e378ed9b010a63c400420de5f22d2206[]=4; $OSWAP_375a355fd37d13c4de925c12d24765fd=$OSWAP_375a355fd37d13c4de925c12d24765fd-4; return ($OSWAP_375a355fd37d13c4de925c12d24765fd!=0); } if($OSWAP_375a355fd37d13c4de925c12d24765fd>=3){ $OSWAP_e378ed9b010a63c400420de5f22d2206[]=3; $OSWAP_375a355fd37d13c4de925c12d24765fd=$OSWAP_375a355fd37d13c4de925c12d24765fd-3; return ($OSWAP_375a355fd37d13c4de925c12d24765fd!=0); } if($OSWAP_375a355fd37d13c4de925c12d24765fd>=2){ $OSWAP_e378ed9b010a63c400420de5f22d2206[]=2; $OSWAP_375a355fd37d13c4de925c12d24765fd=$OSWAP_375a355fd37d13c4de925c12d24765fd-2; return ($OSWAP_375a355fd37d13c4de925c12d24765fd!=0); } if($OSWAP_375a355fd37d13c4de925c12d24765fd>=1){ $OSWAP_e378ed9b010a63c400420de5f22d2206[]=1; $OSWAP_375a355fd37d13c4de925c12d24765fd=$OSWAP_375a355fd37d13c4de925c12d24765fd-1; return ($OSWAP_375a355fd37d13c4de925c12d24765fd!=0); } }else if($lx==2){ if($OSWAP_375a355fd37d13c4de925c12d24765fd>=6){ $OSWAP_e378ed9b010a63c400420de5f22d2206[]='0.6'; $OSWAP_375a355fd37d13c4de925c12d24765fd=$OSWAP_375a355fd37d13c4de925c12d24765fd-6; return ($OSWAP_375a355fd37d13c4de925c12d24765fd!=0); } if($OSWAP_375a355fd37d13c4de925c12d24765fd>=3){ $OSWAP_e378ed9b010a63c400420de5f22d2206[]='0.3'; $OSWAP_375a355fd37d13c4de925c12d24765fd=$OSWAP_375a355fd37d13c4de925c12d24765fd-3; return ($OSWAP_375a355fd37d13c4de925c12d24765fd!=0); } if($OSWAP_375a355fd37d13c4de925c12d24765fd>=1){ $OSWAP_e378ed9b010a63c400420de5f22d2206[]='0.1'; $OSWAP_375a355fd37d13c4de925c12d24765fd=$OSWAP_375a355fd37d13c4de925c12d24765fd-1; return ($OSWAP_375a355fd37d13c4de925c12d24765fd!=0); } } return ($OSWAP_375a355fd37d13c4de925c12d24765fd!=0); } function xingwai_days($OSWAP_b746aa222f03232b630816e377db2ed2){ $OSWAP_e47b57c7bf75720af0ad5318b0d107de = select_query( "服务", "", array( "id" => $OSWAP_b746aa222f03232b630816e377db2ed2["serviceid"] ) ); $OSWAP_6e26f6f7765c8193682bfc08ae9b7089 = mysql_fetch_array( $OSWAP_e47b57c7bf75720af0ad5318b0d107de ); $OSWAP_375a355fd37d13c4de925c12d24765fd=$OSWAP_6e26f6f7765c8193682bfc08ae9b7089['购买数量']; $OSWAP_e378ed9b010a63c400420de5f22d2206=array(); if($OSWAP_6e26f6f7765c8193682bfc08ae9b7089['周期']=='年付') $lx=1; else if($OSWAP_6e26f6f7765c8193682bfc08ae9b7089['周期']=='月付') $lx=2; while(xingwai_day($OSWAP_e378ed9b010a63c400420de5f22d2206,$OSWAP_375a355fd37d13c4de925c12d24765fd,$lx)){} return $OSWAP_e378ed9b010a63c400420de5f22d2206; } function xingwai_TerminateAccount($OSWAP_b746aa222f03232b630816e377db2ed2) { return '成功'; } function xingwai_SuspendAccount($OSWAP_b746aa222f03232b630816e377db2ed2) { return '成功'; } function xingwai_UnsuspendAccount($OSWAP_b746aa222f03232b630816e377db2ed2) { $OSWAP_e378ed9b010a63c400420de5f22d2206=xingwai_days($OSWAP_b746aa222f03232b630816e377db2ed2); foreach($OSWAP_e378ed9b010a63c400420de5f22d2206 as $OSWAP_375a355fd37d13c4de925c12d24765fd){ if(xingwai_xufei($OSWAP_b746aa222f03232b630816e377db2ed2,$OSWAP_375a355fd37d13c4de925c12d24765fd)!='成功'){ xingwai_xufei($OSWAP_b746aa222f03232b630816e377db2ed2,$OSWAP_375a355fd37d13c4de925c12d24765fd); } } return '成功'; } function xingwai_ChangePassword($OSWAP_b746aa222f03232b630816e377db2ed2) { $temp=POSTOP($OSWAP_b746aa222f03232b630816e377db2ed2["serverhostname"],"/user/userlogin.asp",array("username"=>$OSWAP_b746aa222f03232b630816e377db2ed2["serverusername"],"password"=>$OSWAP_b746aa222f03232b630816e377db2ed2["serverpassword"])); if(empty($temp)) return '连接服务器失败'; if(!strstr($temp,'Location: logininfo.asp')){ @preg_match('/e=(.*)\n/iU',$temp,$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247); return '服务器登入错误:'.$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1]; } GETOP($OSWAP_b746aa222f03232b630816e377db2ed2["serverhostname"],"/user/vpsadm2.asp","id=".$OSWAP_b746aa222f03232b630816e377db2ed2["domain"]."&go=a"); $content=POSTOP($OSWAP_b746aa222f03232b630816e377db2ed2["serverhostname"],"/vpsadm/modifypass2.asp",array("newpassword"=>$OSWAP_b746aa222f03232b630816e377db2ed2["password"],"renewpassword"=>$OSWAP_b746aa222f03232b630816e377db2ed2["password"],"id"=>$OSWAP_b746aa222f03232b630816e377db2ed2["domain"])); if(strstr($content,'保存成功')) return '成功'; else{ @preg_match('/e=(.*)\n/iU',$content,$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247); return $OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1]; } } function xingwai_ChangePackage($OSWAP_b746aa222f03232b630816e377db2ed2) { $temp=POSTOP($OSWAP_b746aa222f03232b630816e377db2ed2["serverhostname"],"/user/userlogin.asp",array("username"=>$OSWAP_b746aa222f03232b630816e377db2ed2["serverusername"],"password"=>$OSWAP_b746aa222f03232b630816e377db2ed2["serverpassword"])); if(empty($temp)) return '连接服务器失败'; if(!strstr($temp,'Location: logininfo.asp')){ @preg_match('/e=(.*)\n/iU',$temp,$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247); return '服务器登入错误:'.$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1]; } GETOP($OSWAP_b746aa222f03232b630816e377db2ed2["serverhostname"],"/user/vpsadm2.asp","id=".$OSWAP_b746aa222f03232b630816e377db2ed2["domain"]."&go=d"); $content=POSTOP($OSWAP_b746aa222f03232b630816e377db2ed2["serverhostname"],"/vpsadm/selfvpsupdate1.asp",array("Sqllistid"=>$OSWAP_b746aa222f03232b630816e377db2ed2["configoption1"],"id"=>$OSWAP_b746aa222f03232b630816e377db2ed2["domain"],"Submit"=>"%D6%BB%BC%C6%CB%E3%C9%FD%BC%B6%B7%D1%D3%C3")); if(strstr($content,'服务器升级成功')) return '成功'; else{ @preg_match('/e=(.*)\n/iU',$content,$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247); if(strstr($OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1],'不能向低别升级!')) return '公开信息:'.$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1]; return $OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1]; } } function xingwai_ClientArea($OSWAP_b746aa222f03232b630816e377db2ed2) { $OSWAP_5fbd4faf3630168a85b97b131d2fb6ea = array('<form name="frm" action="http://'.$OSWAP_b746aa222f03232b630816e377db2ed2["serveraccesshash"].'/vpsadm/login.asp" method="post" target="_blank"><input type="hidden" value="login" name="module"><input name="vpsname" type="hidden" value="'.$OSWAP_b746aa222f03232b630816e377db2ed2["username"].'"><input name="vpspassword" type="hidden" value="'.$OSWAP_b746aa222f03232b630816e377db2ed2["password"].'"></form><a href="javascript:document.frm.submit();">登入控制面板</a>'); return $OSWAP_5fbd4faf3630168a85b97b131d2fb6ea; } function xingwai_LoginLink($OSWAP_b746aa222f03232b630816e377db2ed2) { } function xingwai_UsageUpdate($OSWAP_b746aa222f03232b630816e377db2ed2) { return '成功'; } function xingwai_BuyCustom(){ $OSWAP_6b3b3cf8b51a523f4498f8599d832d34=mac_url_get(1); $OSWAP_e47b57c7bf75720af0ad5318b0d107de = select_query( "产品", "", array( "id" => $OSWAP_6b3b3cf8b51a523f4498f8599d832d34 ) ); $OSWAP_07639b6505566457c3ebd38bb106ec17 = mysql_fetch_array( $OSWAP_e47b57c7bf75720af0ad5318b0d107de ); $OSWAP_e47b57c7bf75720af0ad5318b0d107de = select_query( "服务器表", "", array( "id" => $OSWAP_07639b6505566457c3ebd38bb106ec17['服务器组'] ) ); $OSWAP_6e26f6f7765c8193682bfc08ae9b7089 = mysql_fetch_array( $OSWAP_e47b57c7bf75720af0ad5318b0d107de ); POSTOP($OSWAP_6e26f6f7765c8193682bfc08ae9b7089['主机名'],"/user/userlogin.asp",array("username"=>$OSWAP_6e26f6f7765c8193682bfc08ae9b7089['用户名'],"password"=>decrypt($OSWAP_6e26f6f7765c8193682bfc08ae9b7089['密码']))); $OSWAP_4d3350f6b3f87a15c271eeb7d34f0b33=GETOP($OSWAP_6e26f6f7765c8193682bfc08ae9b7089['主机名'],"/user/selfvps.asp","id=".$OSWAP_07639b6505566457c3ebd38bb106ec17['配置选项1']); $temp2=explode('<select name="ServerlistID" id="ServerlistID">',$OSWAP_4d3350f6b3f87a15c271eeb7d34f0b33); $nr=explode('</select>',$temp2[1]); $nr=$nr[0]; @preg_match_all('/value="(.*)" >(.*)</iU',$nr,$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247); $sl=count($OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[0]); $OSWAP_6d6606566903f52a20ddac99bb6c7301=array(); for($i=0;$i<$sl;$i++){ $OSWAP_6d6606566903f52a20ddac99bb6c7301[]=$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[1][$i].'.'.$OSWAP_0d4493c3b3fab4169dad6e7f5ff24247[2][$i]; } return array( array('Name'=>'服务器用户名', 'Type' => 'text', 'Size' => '20' ), array('Name'=>'选择机房', 'Type' => 'dropdown', 'Options' => $OSWAP_6d6606566903f52a20ddac99bb6c7301) ); } function xingwai_ClientAreaLIB($OSWAP_e26bc6b0c05df09e244aa38b2d0a6a0b,&$OSWAP_f635153990176ceef10a4d104d874f29) { $OSWAP_f635153990176ceef10a4d104d874f29['主机名']=''; } add_swap_plug('产品控制面板详情','xingwai_ClientAreaLIB'); 