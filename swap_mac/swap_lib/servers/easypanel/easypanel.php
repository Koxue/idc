<?php  requirer('whm.lib.php','easypanel'); function easypanel_ConfigOptions() { $configarray = array( "CDN" => array("Type" => "yesno", "Description" => "CDN网站"), "空间类型" => array("Type" => "text", "Size" => "5","Description" => "语言模板,如php"), "web配额" => array( "Type" => "text", "Size" => "5", "Description" => "MB" ), "数据库类型" => array( "Type" => "dropdown", "Options" => "mysql,sqlsrv"), "数据库配额" => array( "Type" => "text", "Size" => "5", "Description" => "MB" ), "FTP" => array( "Type" => "yesno", "Description" => "是否允许ftp" ), "独立日志" => array( "Type" => "yesno", "Description" => "是否开启独立日志" ), "绑定域名数" => array( "Type" => "text", "Size" => "5"), "连接数" => array( "Type" => "text", "Size" => "5"), "带宽限制" => array( "Type" => "text", "Size" => "5","Description" => "K/S"), "默认绑定到子目录" => array( "Type" => "text","Size"=>"20"), "允许绑定子目录" => array( "Type" => "yesno", "Description" => "是否允许绑定域名到子目录"), "最多绑定子目录数" => array( "Type" => "text","Size"=>"5"), "流量限制" => array( "Type" => "text","Size"=>"5","Description" => "GB/月"), "管理变量" => array( "Type" => "text","Size"=>"12"), "工作数" => array( "Type" => "text","Size"=>"5"), "附加参数" => array("Type" => "text",'Size'=>'12'), "EP端口" => array("Type" => "text",'Size'=>'7',"Description" => "输入为自定义端口,不输入为默认3312端口"), "语言引擎" => array("Type" => "text","Description" => "如php52,php53,如果语言模板没有语言引擎,可为空"), "模块" => array("Type" => "dropdown", "Options" => ",php,iis","Description" => "如果使用空间类型和语言引擎的话请不要选!!选中将无法使用,并且选择没安装的话就无法使用了"), ); return $configarray; } function easypanel_make_whm($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0) { if ($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverhostname"]) { $OSWAP_0df34e3f75d96bc4cc9108d278718670 = $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverhostname"]; } else { $OSWAP_0df34e3f75d96bc4cc9108d278718670 = $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverip"]; } if(empty($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption18"])) $OSWAP_6cee0b17c14b3b0c6ff8793351474d52='3312'; else $OSWAP_6cee0b17c14b3b0c6ff8793351474d52=$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption18"]; $OSWAP_5d7a15dcf6f09192809f77d15fc6859a = new WhmClient(); $OSWAP_5d7a15dcf6f09192809f77d15fc6859a->setUrl('http://'.$OSWAP_0df34e3f75d96bc4cc9108d278718670.':'.$OSWAP_6cee0b17c14b3b0c6ff8793351474d52.'/'); $OSWAP_5d7a15dcf6f09192809f77d15fc6859a->setSecurityKey($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serveraccesshash"]); return $OSWAP_5d7a15dcf6f09192809f77d15fc6859a; } function easypanel_call($OSWAP_0a28ee3c0bc54ef8b772a561b4223f29,$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0) { if(empty($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serveraccesshash"])) return '没有填写安全码,请将安全码填写到服务器哈希值里'; $OSWAP_5d7a15dcf6f09192809f77d15fc6859a = easypanel_make_whm($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0); $OSWAP_3cc8fbc4c66685e8f1bc76aa1397f081 = $OSWAP_5d7a15dcf6f09192809f77d15fc6859a->call($OSWAP_0a28ee3c0bc54ef8b772a561b4223f29,300); if ($OSWAP_3cc8fbc4c66685e8f1bc76aa1397f081===false) { return "不能连接到主机"; } if(!method_exists($OSWAP_3cc8fbc4c66685e8f1bc76aa1397f081,'getCode')) return $OSWAP_3cc8fbc4c66685e8f1bc76aa1397f081; if ($OSWAP_3cc8fbc4c66685e8f1bc76aa1397f081->getCode()==200) { return "成功"; } return (string)$OSWAP_3cc8fbc4c66685e8f1bc76aa1397f081->OSWAP_50a29aafcd340f5e1d57f38a688cc602; } function easypanel_update_account($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0,$OSWAP_f4dc197edc40a6fe758f62ef18c913e8) { $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29 = new WhmCall('add_vh'); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('name', $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["username"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('passwd',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["password"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('cdn',($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption1"]== 'on'?1:0)); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('templete',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption2"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('web_quota',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption3"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('db_type',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption4"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('db_quota',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption5"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('ftp',($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption6"]== 'on'?1:0)); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('log_file',($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption7"]== 'on'?1:0)); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('domain',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption8"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('max_connect',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption9"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('speed_limit',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption10"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('subdir',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption11"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('subdir_flag',($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption12"]== 'on'?1:0)); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('max_subdir',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption13"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('flow_limit',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption14"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('envs',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption15"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('max_worker',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption16"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('subtemplete',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption19"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('module',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption20"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('vhost_domains',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["domain"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('htaccess',1); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('access',1); if (trim($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption17"]) != "") { $OSWAP_bff64c46f95fb0c5c4fa6bd8fd55fb0c = explode('&', $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption17"]); if (is_array($OSWAP_bff64c46f95fb0c5c4fa6bd8fd55fb0c)) { foreach($OSWAP_bff64c46f95fb0c5c4fa6bd8fd55fb0c as $e) { $k = explode('=', $e); if ($k[0]=='c' || $k[0]=='a' || $k[0] == 's' || $k[0] == 'r') { continue; } $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam($k[0],$k[1]); } }else { $k = explode('=',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption17"]); if (is_array($k)) { if ($k[0]=='c' || $k[0]=='a' || $k[0] == 's' || $k[0] == 'r') { }else $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam($k[0],$k[1]); } } } if ($OSWAP_f4dc197edc40a6fe758f62ef18c913e8) { $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('edit',1); } $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('init',1); return easypanel_call($OSWAP_0a28ee3c0bc54ef8b772a561b4223f29,$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0); } function easypanel_CreateAccount($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0) { if ($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0['username']=="") { return "username cann't be empty"; } return easypanel_update_account($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0,false); } function easypanel_TerminateAccount($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0) { $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29 = new WhmCall('del_vh'); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('name', $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["username"]); return easypanel_call($OSWAP_0a28ee3c0bc54ef8b772a561b4223f29,$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0); } function easypanel_SuspendAccount($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0) { $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29 = new WhmCall('update_vh'); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('name', $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["username"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('status',1); return easypanel_call($OSWAP_0a28ee3c0bc54ef8b772a561b4223f29,$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0); } function easypanel_UnsuspendAccount($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0) { $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29 = new WhmCall('update_vh'); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('name', $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["username"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('status',0); return easypanel_call($OSWAP_0a28ee3c0bc54ef8b772a561b4223f29,$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0); } function easypanel_ChangePassword($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0) { $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29 = new WhmCall('change_password'); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('name', $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["username"]); $OSWAP_0a28ee3c0bc54ef8b772a561b4223f29->addParam('passwd',$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["password"]); return easypanel_call($OSWAP_0a28ee3c0bc54ef8b772a561b4223f29,$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0); } function easypanel_ChangePackage($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0) { return easypanel_update_account($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0,true); } function easypanel_ClientArea($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0) { $lang=plug_lang_get('easypanel','','2'); if ($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverhostname"]) { $OSWAP_0df34e3f75d96bc4cc9108d278718670 = $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverhostname"]; } else { $OSWAP_0df34e3f75d96bc4cc9108d278718670 = $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverip"]; } if(empty($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption18"])) $OSWAP_6cee0b17c14b3b0c6ff8793351474d52='3312'; else $OSWAP_6cee0b17c14b3b0c6ff8793351474d52=$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption18"]; $OSWAP_d3b76c284f2cac5211b171607482f7aa = array( '<a href="javascript:document.easypanellogin.submit();" target="_blank">'.$lang['直接登录(自定义密码无效)'].'</a>', '<form name="easypanellogin" action="http://'.$OSWAP_0df34e3f75d96bc4cc9108d278718670.':'.$OSWAP_6cee0b17c14b3b0c6ff8793351474d52.'/vhost/?c=session&a=login" method="post" target="_blank"><input type="hidden" name="username" value="'.$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["username"].'" /><input type="hidden" name="passwd" value="'.$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["password"].'" /></form>', '<a href="http://'.$OSWAP_0df34e3f75d96bc4cc9108d278718670.':'.$OSWAP_6cee0b17c14b3b0c6ff8793351474d52.'/vhost/" target="_blank">'.$lang['管理地址(http)'].'</a>' ); return $OSWAP_d3b76c284f2cac5211b171607482f7aa; } function easypanel_AdminLink($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0) { if ($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverhostname"]) { $OSWAP_0df34e3f75d96bc4cc9108d278718670 = $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverhostname"]; } else { $OSWAP_0df34e3f75d96bc4cc9108d278718670 = $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverip"]; } if(empty($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption18"])) $OSWAP_6cee0b17c14b3b0c6ff8793351474d52='3312'; else $OSWAP_6cee0b17c14b3b0c6ff8793351474d52=$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption18"]; $OSWAP_d3b76c284f2cac5211b171607482f7aa = '<form action="http://'.$OSWAP_0df34e3f75d96bc4cc9108d278718670.':'.$OSWAP_6cee0b17c14b3b0c6ff8793351474d52.'/admin/?c=session&a=login" method="post" target="_blank"><input type="hidden" name="username" value="'.$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverusername"].'" /><input type="hidden" name="passwd" value="'.$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverpassword"].'" /><input type="submit" value="登录管理" /></form>'; return $OSWAP_d3b76c284f2cac5211b171607482f7aa; } function easypanel_LoginLink($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0) { if ($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverhostname"]) { $OSWAP_0df34e3f75d96bc4cc9108d278718670 = $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverhostname"]; } else { $OSWAP_0df34e3f75d96bc4cc9108d278718670 = $OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["serverip"]; } if(empty($OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption18"])) $OSWAP_6cee0b17c14b3b0c6ff8793351474d52='3312'; else $OSWAP_6cee0b17c14b3b0c6ff8793351474d52=$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["configoption18"]; echo "<a href=\"http://".$OSWAP_0df34e3f75d96bc4cc9108d278718670.":".$OSWAP_6cee0b17c14b3b0c6ff8793351474d52."/vhost/?username=".$OSWAP_9df9f1de33e2780e73c4732db8f4d9b0["username"]."\" target=\"_blank\" style=\"color:#cc0000\">登录easypanel</a>"; } function easypanel_ClientAreaLIB($OSWAP_6902d3830628b2f5a43c9db4f7a8666b,$OSWAP_f0241c41f30826092e4cb60531d56735) { $OSWAP_abcea450e19c81bca7757caa0c702ad4['disk']=$OSWAP_6902d3830628b2f5a43c9db4f7a8666b['配置选项3']; $OSWAP_abcea450e19c81bca7757caa0c702ad4['sql']=$OSWAP_6902d3830628b2f5a43c9db4f7a8666b['配置选项5']; $OSWAP_abcea450e19c81bca7757caa0c702ad4['domain']=$OSWAP_6902d3830628b2f5a43c9db4f7a8666b['配置选项8']; if($OSWAP_abcea450e19c81bca7757caa0c702ad4['disk']=='') $OSWAP_abcea450e19c81bca7757caa0c702ad4['disk']='NONE'; if($OSWAP_abcea450e19c81bca7757caa0c702ad4['disk']=='0') $OSWAP_abcea450e19c81bca7757caa0c702ad4['disk']='NONE'; if($OSWAP_abcea450e19c81bca7757caa0c702ad4['sql']=='') $OSWAP_abcea450e19c81bca7757caa0c702ad4['sql']='NONE'; if($OSWAP_abcea450e19c81bca7757caa0c702ad4['sql']=='0') $OSWAP_abcea450e19c81bca7757caa0c702ad4['sql']='NONE'; if($OSWAP_abcea450e19c81bca7757caa0c702ad4['domain']=='') $OSWAP_abcea450e19c81bca7757caa0c702ad4['domain']='UNLIMITED'; if($OSWAP_abcea450e19c81bca7757caa0c702ad4['domain']=='-1') $OSWAP_abcea450e19c81bca7757caa0c702ad4['domain']='UNLIMITED'; TEMPLATE::assign('easypanel',$OSWAP_abcea450e19c81bca7757caa0c702ad4); } add_swap_plug('产品控制面板详情','easypanel_ClientAreaLIB'); 