<?php  defined('SWAP_ROOT') or die('非法操作'); class regkz extends controller{ function config(){ return array( 'swap_no_login' => array('startyzm'=>'1','index'=>'1','admin'=>'1','ksusercenter'=>'1','yz'=>'1',), 'startyzm'=>'0', 'index'=>'0', 'mailjh2'=>'0', 'mailjh'=>'1', ); } function index(){ $OSWAP_ccb7a739df73d45846e9b051b5980016=_GET('sig'); $OSWAP_fccd0b1902df6b69b12317975e7dd296=_GET('id'); if(empty($OSWAP_ccb7a739df73d45846e9b051b5980016)){exit(redirect('/index.php/?error='.regkz_lang("验证邮箱失败")));} $OSWAP_6e53509b76529a018d82eb9b6c744433=plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证代码"); if($OSWAP_ccb7a739df73d45846e9b051b5980016==$OSWAP_6e53509b76529a018d82eb9b6c744433){ plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证邮箱",'1'); plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证代码",NULL); if (function_exists('aff_yzyx')) aff_yzyx(); exit(redirect('/index.php/?success='.regkz_lang("验证邮箱成功"))); }else{ exit(redirect('/index.php/?error='.regkz_lang("验证邮箱失败"))); } } function startyzm(){ $OSWAP_a4799f41805763df0d0fa96eed4ad6f4 = new GeetestLib2(); $OSWAP_ef7d8dfba906cbb65c236bf33ed2847a = $OSWAP_a4799f41805763df0d0fa96eed4ad6f4->pre_process(); session('gtserver',$OSWAP_ef7d8dfba906cbb65c236bf33ed2847a); echo $OSWAP_a4799f41805763df0d0fa96eed4ad6f4->get_response_str(); } function ksusercenter(){ need_admin(); $OSWAP_62a108c1a5b5bd2ffa2966445666d441=mac_url_get(1); $this->conn->select('用户', '*', "uid='{$OSWAP_62a108c1a5b5bd2ffa2966445666d441}' OR 用户名='{$OSWAP_62a108c1a5b5bd2ffa2966445666d441}'"); if($OSWAP_efd64e0597a8c4b6e643fd272e197ec7 = $this->conn->fetch_array()){ session('uid',$OSWAP_efd64e0597a8c4b6e643fd272e197ec7['uid']); header("location:/index.php/user/index/"); exit; }else{ die('用户不存在'); } } function yz(){ $OSWAP_9f904bb131194d34a3f7f6872970a606=explode('|',base64_decode(_GET('g'))); $OSWAP_fccd0b1902df6b69b12317975e7dd296=(int)$OSWAP_9f904bb131194d34a3f7f6872970a606[0]; $g['登陆时间']=(int)$OSWAP_9f904bb131194d34a3f7f6872970a606[1]; $g['签名']=$OSWAP_9f904bb131194d34a3f7f6872970a606[2]; $g['签名长度']=strlen($g['签名']); $g['当前时间']=time(); $g['结束时间']=$g['登陆时间']+600; $g['时间差']=$g['结束时间']-$g['当前时间']; if($g['时间差'] < 0) regkz_indexdie("链接已失效"); if($OSWAP_fccd0b1902df6b69b12317975e7dd296<1 || $g['签名长度'] != 32) regkz_indexdie("链接校验失败"); SMACSQL()->select('用户', '*', "uid='{$OSWAP_fccd0b1902df6b69b12317975e7dd296}'"); if ($OSWAP_21aaa886309ad2236f279bad769775b9 = SMACSQL()->fetch_array()) { $OSWAP_b91addec8a8382ee099da4dff0e7dd80=md5($g['登陆时间'].$OSWAP_21aaa886309ad2236f279bad769775b9['密码'].$OSWAP_21aaa886309ad2236f279bad769775b9['电子邮件']); $OSWAP_56b0dff83000d0d211317fddda363a4c=plug_eva('regkz__用户登陆码',"{$OSWAP_fccd0b1902df6b69b12317975e7dd296}"); if($OSWAP_b91addec8a8382ee099da4dff0e7dd80!=$g['签名'] || $OSWAP_56b0dff83000d0d211317fddda363a4c!=$g['签名'] ) regkz_indexdie("链接校验失败"); SMACSQL()->update('用户',"`禁止`='1'","uid='{$OSWAP_fccd0b1902df6b69b12317975e7dd296}'"); regkz_indexdie("账户已经被锁定,恢复账户请联系客服进行操作",'success'); }else{ regkz_indexdie("链接校验失败5"); } } function mailjh(){ $OSWAP_fccd0b1902df6b69b12317975e7dd296=session("uid"); $L['变量']['邮箱验证状态']=plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证邮箱"); $L['变量']['手机验证状态']=plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证手机"); $L['变量']['语音验证码_APP_ID']=plug_eva('regkz',"语音验证码_APP_ID"); TEMPLATE::assign('TEMPLATE_ROOT',SWAP_ROOT.SWAP_TEMPLATES_ROOT.SWAP_DIR_END); TEMPLATE::assign('L',$L); TEMPLATE::display('index.tpl'); } function mailjh2(){ $OSWAP_fccd0b1902df6b69b12317975e7dd296=session("uid"); $m=_GET("m"); $OSWAP_ccb7a739df73d45846e9b051b5980016=_POST("code"); $OSWAP_abee558b46936af49a83e1a00f8262b4=_POST("mail"); $OSWAP_74ccde41a4f1298fa44c2f45bd3babcd=_POST("phone"); if($m=='send'){ $c=TEMPLATE::assign('c'); $s=TEMPLATE::assign('s'); $OSWAP_ccb7a739df73d45846e9b051b5980016=rand(10000000,99999999); $ml=plug_lang_get('regkz','changemailhtml'); $ml['内容']=str_replace('{{code}}',$OSWAP_ccb7a739df73d45846e9b051b5980016,$ml['内容']); $ml['内容']=str_replace('{{用户id}}',$OSWAP_fccd0b1902df6b69b12317975e7dd296,$ml['内容']); $ml['内容']=str_replace('{{用户名}}',$s['登陆用户名'],$ml['内容']); $ml['标题']=str_replace('{{用户名}}',$s['登陆用户名'],$ml['标题']); $ml['内容']=str_replace('{{网站名称}}',$c['网站名称'],$ml['内容']); $ml['标题']=str_replace('{{网站名称}}',$c['网站名称'],$ml['标题']); if(!$this->IsMail($OSWAP_abee558b46936af49a83e1a00f8262b4)){die(regkz_lang("邮箱格式错误"));} D()->select('用户','*',"电子邮件='{$OSWAP_abee558b46936af49a83e1a00f8262b4}' and uid!='{$OSWAP_fccd0b1902df6b69b12317975e7dd296}'"); if(D()->db_num_rows()!=0) die(regkz_lang("邮箱已经存在")); $OSWAP_63be92b483cdc4c3ee9aa53861e24d1a=time()+600; plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证代码","{$OSWAP_abee558b46936af49a83e1a00f8262b4}|||{$OSWAP_63be92b483cdc4c3ee9aa53861e24d1a}|||{$OSWAP_ccb7a739df73d45846e9b051b5980016}"); $OSWAP_cd38d3fc45ab7f51509f5d4a51bb2572=plug_eva('系统配置',"邮箱姓名"); import("swap.Mail"); SendMail($OSWAP_abee558b46936af49a83e1a00f8262b4,$ml['标题'],$ml['内容'],$OSWAP_cd38d3fc45ab7f51509f5d4a51bb2572); die(regkz_lang("发送验证码提交成功")); } if($m=='yz'){ $te=plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证代码"); $te=explode("|||",$te); if($OSWAP_ccb7a739df73d45846e9b051b5980016!=$te[2]){die(regkz_lang("验证码错误"));} if(time()>$te[1]){die(regkz_lang("验证码已经过期"));} plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证代码",null); D()->update('用户',"电子邮件='{$te[0]}'","uid='{$OSWAP_fccd0b1902df6b69b12317975e7dd296}'"); plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证邮箱",1); if (function_exists('aff_yzyx')) aff_yzyx(); die(regkz_lang("邮箱:").$te[0].regkz_lang(" 验证成功")); } if($m=='sendphone'){ $OSWAP_ccb7a739df73d45846e9b051b5980016=rand(10000,99999); $L=plug_lang_get('regkz','main'); if(!regkz_isMobile($OSWAP_74ccde41a4f1298fa44c2f45bd3babcd)){die(regkz_lang("手机格式错误"));} D()->select('用户','*',"电话号码='{$OSWAP_74ccde41a4f1298fa44c2f45bd3babcd}' and uid!='{$OSWAP_fccd0b1902df6b69b12317975e7dd296}'"); if(D()->db_num_rows()!=0) die(regkz_lang("手机已经存在")); $OSWAP_63be92b483cdc4c3ee9aa53861e24d1a=time()+600; $kf=plug_eva('regkz',"发送语音验证码扣费金额"); $kf=(float)$kf; if($kf>0){ if(!apia_money(array("uid",session("uid")),'-',$kf,"发送语音验证码")){die(regkz_lang("发送验证码金额扣除失败,请检查您的余额是否足够"));} } plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]phone验证代码","{$OSWAP_74ccde41a4f1298fa44c2f45bd3babcd}|||{$OSWAP_63be92b483cdc4c3ee9aa53861e24d1a}|||{$OSWAP_ccb7a739df73d45846e9b051b5980016}"); $in=voiceVerify(array("to"=>$OSWAP_74ccde41a4f1298fa44c2f45bd3babcd,"verifyCode"=>$OSWAP_ccb7a739df73d45846e9b051b5980016)); if($in['statusCode']!=0) die(regkz_lang("({$in['statusCode']}){$in['statusMsg']}")); die(regkz_lang("发送验证码提交成功,稍后您将会接到验证码的电话")); } if($m=='yzphone'){ $te=plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]phone验证代码"); $te=explode("|||",$te); if($OSWAP_ccb7a739df73d45846e9b051b5980016!=$te[2]){die(regkz_lang("验证码错误"));} if(time()>$te[1]){die(regkz_lang("验证码已经过期"));} plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]phone验证代码",null); D()->update('用户',"电话号码='{$te[0]}'","uid='{$OSWAP_fccd0b1902df6b69b12317975e7dd296}'"); plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证手机",1); die(regkz_lang("电话号码:").$te[0].regkz_lang(" 验证成功")); } die(regkz_lang("...")); } function admin() { need_admin(); $OSWAP_5d5046d9791c80dbeba0924d373d533d="regkz"; $OSWAP_6a442038e8eaf2877fce75c1d7ae73ed="用户系统增强插件"; $OSWAP_62a108c1a5b5bd2ffa2966445666d441=mac_url_get(1); if($OSWAP_62a108c1a5b5bd2ffa2966445666d441==""){$OSWAP_62a108c1a5b5bd2ffa2966445666d441="list";} $id="";$id=mac_url_get(2); $ok="";$ok=mac_url_get(3); $OSWAP_51f1eff515138febb6177bf5c1fbad2f =array( array('邮件模板目录说明:',' ','\swap_mac\swap_plugins\regkz\lang\Chinese\ 目录中<br>登陆通知:lang_mailhtmllogin.php<br>验证邮件:  lang_mailhtml.php'), array('说明:',' ','默认登陆通知里面ip后面是没有地区的,如果需要显示地区 请下载qqwry.dat 到网站根目录'), array('强制邮箱验证','yesno','开启后用户必须验证邮箱后才可以登录'), array('注册送预存款','text','用户注册后送的预存款金额,留空为注册不赠送预存款,请写正整数'), array('禁止注册邮箱后缀','text','不允许注册的邮箱 以英文半角逗号分隔 例如:mail.ru,domain.com,*.tk'), array('语音验证码_ACCOUNT_SID','text','在http://www.yuntongxun.com/申请'), array('语音验证码_AUTH_TOKEN','text','资费嘛 写插件的时候是0.06元/条'), array('语音验证码_APP_ID','text',''), array('发送语音验证码扣费金额','text','每发一条语音验证码收费多少钱'), array('语音验证码_沙盒模式','yesno','沙盒模式是用来测试的,沙盒模式给自己手机发语音验证码 免费'), array('语音验证码_开启输出','yesno','输出日志文件 方便查看一些信息'), array('登录通知','yesno','用户登陆的时候发送邮件通知用户'), array('购买产品必须验证手机','yesno','如果不验证手机将无法购买'), array('购买产品必须验证邮箱','yesno','如果不验证邮箱将无法购买'), array('进入订单管理必须验证手机','yesno','如果不验证手机将无法查看自己已经购买的服务'), array('进入订单管理必须验证邮箱','yesno','如果不验证邮箱将无法查看自己已经购买的服务'), array('没验证手机邮箱自定义跳转地址','text','就是 如果提示未验证之后 跳转过去的地址 不填 则为 <code>/index.php/index/index/</code>'), array('说明:',' ','进入订单管理必须验证xx 是针对以前的用户 如果木有验证手机或邮箱 可以继续进订单管理续费的问题 这些功能要求程序版本 至少是  0.3.7.7'), array('sendcloud_idkey','text','格式:apisuser|key,不填则不使用sendcloud发信'), array('极验idkey','text','格式:id|key'), array('注册验证码','yesno','点击注册弹出验证码'), array('启用邮件发送日志','yesno','记录发送的邮件到数据库'), array('开启sendcloud发信','yesno','发送邮件使用代发'), array('代发发信邮箱','text','发送邮件所使用的邮箱地址'), array('代发发信名称','text','显示给邮件接受者的发件人名称'), ); if($OSWAP_62a108c1a5b5bd2ffa2966445666d441=="editok"){ foreach( $OSWAP_51f1eff515138febb6177bf5c1fbad2f as $OSWAP_391e871c15aae7569ae4857dce2ffd74 => $OSWAP_9bf6e190bcdd9d3c0acd44b06572aa6a){plug_eva($OSWAP_5d5046d9791c80dbeba0924d373d533d,$OSWAP_9bf6e190bcdd9d3c0acd44b06572aa6a[0],_POST($OSWAP_9bf6e190bcdd9d3c0acd44b06572aa6a[0]));} die("修改完成ok"); } AdminT::header($OSWAP_6a442038e8eaf2877fce75c1d7ae73ed, ''); AdminT::search(); echo '<main class="page-content content-wrap">'; AdminT::navbar(); AdminT::sidebar(); echo '<div class="page-inner">'; AdminT::title($OSWAP_6a442038e8eaf2877fce75c1d7ae73ed, '<li>网站设置</li>'); ?>	
<div id="main-wrapper" class="container"><div class="row"><div class="col-md-12"><div class="panel panel-primary"><div class="panel-body"><form role="form" id="settingfrom" class="form-horizontal form-groups-bordered">

<?php
 foreach( $OSWAP_51f1eff515138febb6177bf5c1fbad2f as $OSWAP_391e871c15aae7569ae4857dce2ffd74 => $OSWAP_21aaa886309ad2236f279bad769775b9){ $OSWAP_21aaa886309ad2236f279bad769775b9[3]=plug_eva($OSWAP_5d5046d9791c80dbeba0924d373d533d,$OSWAP_21aaa886309ad2236f279bad769775b9[0]); if($OSWAP_21aaa886309ad2236f279bad769775b9[1]=='text'){ $OSWAP_c25d6fb8e73b6b79459481f72842278b="<input type=\"{$OSWAP_21aaa886309ad2236f279bad769775b9[1]}\" value=\"{$OSWAP_21aaa886309ad2236f279bad769775b9[3]}\" name=\"{$OSWAP_21aaa886309ad2236f279bad769775b9[0]}\" class=\"form-control\">"; }elseif($OSWAP_21aaa886309ad2236f279bad769775b9[1]=='yesno' ){ if($OSWAP_21aaa886309ad2236f279bad769775b9[3]=='on'){$OSWAP_21aaa886309ad2236f279bad769775b9['yes_yesno']='checked="checked"';} else{$OSWAP_21aaa886309ad2236f279bad769775b9['no_yesno']='checked="checked"';} $OSWAP_c25d6fb8e73b6b79459481f72842278b="<label><input type=\"radio\" name=\"{$OSWAP_21aaa886309ad2236f279bad769775b9[0]}\" value=\"on\"{$OSWAP_21aaa886309ad2236f279bad769775b9['yes_yesno']}/ >是 </label><label><input type=\"radio\" name=\"{$OSWAP_21aaa886309ad2236f279bad769775b9[0]}\" value=\"off\" {$OSWAP_21aaa886309ad2236f279bad769775b9['no_yesno']} />否</label> "; }else{$OSWAP_c25d6fb8e73b6b79459481f72842278b="{$OSWAP_21aaa886309ad2236f279bad769775b9[1]} {$OSWAP_21aaa886309ad2236f279bad769775b9[3]}";} echo("<div class=\"form-group\"><label class=\"col-sm-3 control-label\">{$OSWAP_21aaa886309ad2236f279bad769775b9[0]}</label><div class=\"col-sm-5\">{$OSWAP_c25d6fb8e73b6b79459481f72842278b}{$OSWAP_21aaa886309ad2236f279bad769775b9[2]}</div></div>"); } ?> <div class="form-group"><div class="col-sm-offset-3 col-sm-5"><a href="javascript:void(0)" onclick="$.post('/index.php/plugin/<?php echo $OSWAP_5d5046d9791c80dbeba0924d373d533d ;?>/admin/editok/',$('#settingfrom').serialize(),function(data){if(data.match('ok')=='ok') swap_alert('success','保存成功',data); else swap_alert('error','保存失败',data);});" class="btn btn-success">保存更改</a></div></div></form></div></div></div></div></div></div><?php
 AdminT::page_footer(); echo '</div></main>'; AdminT::cd_nav(); AdminT::pjs(); echo '<script src="/admin_assets/plugins/waypoints/jquery.waypoints.min.js"></script><script src="/admin_assets/plugins/jquery-counterup/jquery.counterup.min.js"></script><script src="/admin_assets/plugins/toastr/toastr.min.js"></script><script src="/admin_assets/plugins/flot/jquery.flot.min.js"></script><script src="/admin_assets/plugins/flot/jquery.flot.time.min.js"></script><script src="/admin_assets/plugins/flot/jquery.flot.symbol.min.js"></script><script src="/admin_assets/plugins/flot/jquery.flot.resize.min.js"></script><script src="/admin_assets/plugins/flot/jquery.flot.tooltip.min.js"></script><script src="/admin_assets/plugins/curvedlines/curvedLines.js"></script><script src="/admin_assets/plugins/metrojs/MetroJs.min.js"></script><script src="/admin_assets/plugins/morris/raphael.min.js"></script><script src="/admin_assets/plugins/morris/morris.min.js"></script><script src="/admin_assets/js/modern.min.js"></script><script src="/admin_assets/plugins/datatables/js/jquery.dataTables.min.js"></script><script>var extable;$(document).ready(function() {extable=$(\'#example\').DataTable({"language":{"url":"https://cdn.datatables.net/plug-ins/e9421181788/i18n/Chinese.json"}});});</script></body></html>'; } }