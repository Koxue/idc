<?php  defined('SWAP_ROOT') or die('非法操作'); function regkz_config(){ $config['swap_plug']='用户系统增强插件'; $config['swap_plug_version']='1.0'; $config['swap_plug_explain']="强制邮箱验证,注册送预存款,登陆邮件通知用户可通过邮件中链接暂时打开禁用账户,禁止指定邮箱域名注册,可以直接在后台以用户身份进入已验证用户的用户中心 "; $config['swap_plug_author']='施健'; $config['swap_plug_website']='http://www.dayyun.com/'; return $config; } function regkz_lang($OSWAP_d5a482484856f955e98d541dca2bfcb6=''){ $lang=plug_lang_get('regkz','main',$OSWAP_d5a482484856f955e98d541dca2bfcb6); if($lang==''){$lang=$OSWAP_d5a482484856f955e98d541dca2bfcb6;} if($OSWAP_d5a482484856f955e98d541dca2bfcb6=='')$lang=plug_lang_get('regkz','main'); return $lang; } function regkz_eva($OSWAP_d5a482484856f955e98d541dca2bfcb6){ $nr=plug_eva('regkz',$OSWAP_d5a482484856f955e98d541dca2bfcb6); return $nr; } function regkz_adminlb(&$OSWAP_aa62203001419794a586d78569b2b02c){ $OSWAP_aa62203001419794a586d78569b2b02c[]=array('name'=>'用户系统增强','link'=>'/index.php/plugin/regkz/admin/'); } add_swap_plug('管理员菜单列表','regkz_adminlb'); function regkz_zcpd( $OSWAP_61b44afab8426296877be1f428b32d6d, $OSWAP_7600038f66bf55d1e6205076c1636a66, $OSWAP_d5a482484856f955e98d541dca2bfcb6, $OSWAP_9e91f21e0c4e9fbc039984d77c593bbc, $OSWAP_3355775e5a42e9ba5b6443cc6d0d5300, $OSWAP_ac1481ca944b3bfefec826767a41c449, $OSWAP_74ccde41a4f1298fa44c2f45bd3babcd, $OSWAP_abee558b46936af49a83e1a00f8262b4, $OSWAP_45d86b833af9ac42dbbbe90df32b73f9, $OSWAP_d40cc683a8c628690f961c7e664fb300){ if(regkz_checkstr('http',$OSWAP_3355775e5a42e9ba5b6443cc6d0d5300)){ die(redirect('/index.php/index/register/?warning=' . regkz_lang("填写的地址非法"))); } $OSWAP_16ef7af542a9fd3ab378187304aeec3c=regkz_eva("禁止注册邮箱后缀"); if(regkz_eva("注册验证码")=='on'){ $OSWAP_a4799f41805763df0d0fa96eed4ad6f4 = new GeetestLib2(); $OSWAP_464bcaa39168428064fd8d28addfacd3 = $_SESSION['user_id']; if (session('gtserver') == 1) { $OSWAP_9ffd76d6833538fa0eb71a2863c16381 = $OSWAP_a4799f41805763df0d0fa96eed4ad6f4->success_validate(_POST('geetest_challenge'), _POST('geetest_validate'), _POST('geetest_seccode')); if (!$OSWAP_9ffd76d6833538fa0eb71a2863c16381) die(redirect('/index.php/index/register/?warning=' . regkz_lang("验证码错误"))); }else{ if (!$OSWAP_a4799f41805763df0d0fa96eed4ad6f4->fail_validate(_POST('geetest_challenge'),_POST('geetest_validate'),_POST('geetest_seccode'))) die(redirect('/index.php/index/register/?warning=' . regkz_lang("验证码错误"))); } } if($OSWAP_16ef7af542a9fd3ab378187304aeec3c!=''){ $OSWAP_abee558b46936af49a83e1a00f8262b4hzz= explode('@',$OSWAP_abee558b46936af49a83e1a00f8262b4); $OSWAP_abee558b46936af49a83e1a00f8262b4hz= $OSWAP_abee558b46936af49a83e1a00f8262b4hzz[1]; $OSWAP_8603fb9b740cff42ec850c3931f3fc8e = explode(',',$OSWAP_16ef7af542a9fd3ab378187304aeec3c); foreach($OSWAP_8603fb9b740cff42ec850c3931f3fc8e AS $ta){ if (regkz_jiancem($OSWAP_abee558b46936af49a83e1a00f8262b4hz,$ta) && $ta!='') { die(redirect('/index.php/index/register/?warning=' . regkz_lang("该邮箱被禁止注册").$OSWAP_abee558b46936af49a83e1a00f8262b4hz)); } } } } add_swap_plug('注册判断','regkz_zcpd'); function regkz_zccg($OSWAP_aeba0716874c3c3803d9ddd467599cd9,$OSWAP_779ca3ec5052ce344b2c36164e9dc58b, $OSWAP_bc29a18c4046f591dc5c874d70112b20, $OSWAP_55b6fea6bb6264d200079c3e87366d93, $OSWAP_d009d6a5ce26e90c426c16307b656684, $OSWAP_fb5ae7559b902f4208f0853770683be6, $OSWAP_6f8c54649db0de127ac87bc7f9361fc0, $OSWAP_e12bebed1dcdf48d0676c4aecc29e800, $OSWAP_f8930c14593aa79cb080450c24905572, &$OSWAP_a6d07608ced193c85d15d0cf4d654ee0){ $OSWAP_e1619da517038dfa771848a325ff8874=regkz_eva("注册送预存款"); $OSWAP_e1619da517038dfa771848a325ff8874=(int)$OSWAP_e1619da517038dfa771848a325ff8874; $OSWAP_83b3aa009408a4ddf3222a58ea3285a7=regkz_eva("强制邮箱验证"); if($OSWAP_e1619da517038dfa771848a325ff8874>0){ SMACSQL()->update('用户',"预存款 = 预存款 + {$OSWAP_e1619da517038dfa771848a325ff8874}","用户名='{$OSWAP_aeba0716874c3c3803d9ddd467599cd9}'"); } if($OSWAP_83b3aa009408a4ddf3222a58ea3285a7!="on")return ''; SMACSQL()->select('用户', '*', "用户名='{$OSWAP_aeba0716874c3c3803d9ddd467599cd9}'"); if ($OSWAP_21aaa886309ad2236f279bad769775b9 = SMACSQL()->fetch_array()) { import("swap.Mail"); $OSWAP_2242be7335da2ac4eec4c32b98a23f00=regkz_zfcsig(); $c=TEMPLATE::assign('c'); plug_eva('yzmail',"[{$OSWAP_21aaa886309ad2236f279bad769775b9['uid']}]验证邮箱",NULL); plug_eva('yzmail',"[{$OSWAP_21aaa886309ad2236f279bad769775b9['uid']}]验证代码",$OSWAP_2242be7335da2ac4eec4c32b98a23f00); $ml=plug_lang_get('regkz','mailhtml'); $ml['内容']=str_replace('{{code}}',$OSWAP_2242be7335da2ac4eec4c32b98a23f00,$ml['内容']); $ml['内容']=str_replace('{{用户id}}',$OSWAP_21aaa886309ad2236f279bad769775b9['uid'],$ml['内容']); $ml['内容']=str_replace('{{用户名}}',$OSWAP_21aaa886309ad2236f279bad769775b9['用户名'],$ml['内容']); $ml['标题']=str_replace('{{用户名}}',$OSWAP_21aaa886309ad2236f279bad769775b9['用户名'],$ml['标题']); $ml['内容']=str_replace('{{网站名称}}',$c['网站名称'],$ml['内容']); $ml['标题']=str_replace('{{网站名称}}',$c['网站名称'],$ml['标题']); SendMail($OSWAP_21aaa886309ad2236f279bad769775b9['电子邮件'],$ml['标题'],$ml['内容'],$ml['发信人']); session('uid',null); $OSWAP_a6d07608ced193c85d15d0cf4d654ee0=array( 'url'=>'/index/login/', 'color'=>'success', 'text'=>regkz_lang("注册成功,并已经向您的邮箱发送了一封邮件,验证后方可登录") ); } } add_swap_plug('注册成功','regkz_zccg'); function regkz_usercenter($OSWAP_fccd0b1902df6b69b12317975e7dd296){ need_admin();$OSWAP_4de7d920ab50ab9d2533ae17697baa5e=true; if(plug_eva('regkz',"强制邮箱验证")=='on'){if(plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296['uid']}]验证邮箱")!='1'){$OSWAP_4de7d920ab50ab9d2533ae17697baa5e=false;}}if($OSWAP_4de7d920ab50ab9d2533ae17697baa5e==true){ ?><a href="/index.php/plugin/regkz/ksusercenter/<?php echo $OSWAP_fccd0b1902df6b69b12317975e7dd296['uid']; ?>/" class="btn btn-success btn-xs"  target="_blank">用户中心</a><?php }else{ echo '<a href="#" class="btn btn-success btn-xs">邮箱未验证</a>'; } } add_swap_plug('用户管理列表按钮','regkz_usercenter'); function regkz_qjymnr($d){ import("swap.Mail"); $OSWAP_fccd0b1902df6b69b12317975e7dd296=$d['uid']; if($OSWAP_fccd0b1902df6b69b12317975e7dd296=='')return ''; $OSWAP_83b3aa009408a4ddf3222a58ea3285a7=regkz_eva("强制邮箱验证"); $s=TEMPLATE::assign('s'); $c=TEMPLATE::assign('c'); $OSWAP_abee558b46936af49a83e1a00f8262b4y=plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证邮箱"); if($OSWAP_83b3aa009408a4ddf3222a58ea3285a7=="on" && $OSWAP_abee558b46936af49a83e1a00f8262b4y!='1'){ $OSWAP_2242be7335da2ac4eec4c32b98a23f00=plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证代码"); if(strlen($OSWAP_2242be7335da2ac4eec4c32b98a23f00)<30){$OSWAP_2242be7335da2ac4eec4c32b98a23f00=regkz_zfcsig();} plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证邮箱",NULL); plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证代码",$OSWAP_2242be7335da2ac4eec4c32b98a23f00); $ml=plug_lang_get('regkz','mailhtml'); $ml['内容']=str_replace('{{code}}',$OSWAP_2242be7335da2ac4eec4c32b98a23f00,$ml['内容']); $ml['内容']=str_replace('{{用户id}}',$OSWAP_fccd0b1902df6b69b12317975e7dd296,$ml['内容']); $ml['内容']=str_replace('{{用户名}}',$d['用户名'],$ml['内容']); $ml['内容']=str_replace('{{网站名称}}',$c['网站名称'],$ml['内容']); $ml['标题']=str_replace('{{用户名}}',$d['用户名'],$ml['标题']); $ml['标题']=str_replace('{{网站名称}}',$c['网站名称'],$ml['标题']); SendMail($d['电子邮件'],$ml['标题'],$ml['内容'],$ml['发信人']); session('uid',null); die(redirect('/index.php/index/login/?warning=' . regkz_lang("该账户还未验证邮箱,已经向您的邮箱发送了一封邮件,验证后才可以登录"))); } if(regkz_eva("登录通知")=="on"){ $OSWAP_21aaa886309ad2236f279bad769775b9 = $d; $c=TEMPLATE::assign('c'); $OSWAP_65f42b1c9e72b14f5b2a8e32a35339b7=time(); $OSWAP_b91addec8a8382ee099da4dff0e7dd80=md5($OSWAP_65f42b1c9e72b14f5b2a8e32a35339b7.$OSWAP_21aaa886309ad2236f279bad769775b9['密码'].$OSWAP_21aaa886309ad2236f279bad769775b9['电子邮件']); $OSWAP_76f0fc905e16eddc86db43f987f13a02=$OSWAP_65f42b1c9e72b14f5b2a8e32a35339b7."|".$OSWAP_b91addec8a8382ee099da4dff0e7dd80; $OSWAP_68d9dc957ecb6f48e30196b6a314c5c5=base64_encode("{$OSWAP_fccd0b1902df6b69b12317975e7dd296}|{$OSWAP_65f42b1c9e72b14f5b2a8e32a35339b7}|{$OSWAP_b91addec8a8382ee099da4dff0e7dd80}"); plug_eva('regkz__用户登陆码',"{$OSWAP_fccd0b1902df6b69b12317975e7dd296}",$OSWAP_b91addec8a8382ee099da4dff0e7dd80); $ml=plug_lang_get('regkz','mailhtmllogin'); $ml['内容']=str_replace('{{code}}',$OSWAP_68d9dc957ecb6f48e30196b6a314c5c5,$ml['内容']); $ml['内容']=str_replace('{{用户id}}',$OSWAP_21aaa886309ad2236f279bad769775b9['uid'],$ml['内容']); $ml['内容']=str_replace('{{ip}}',regkz_hqip(),$ml['内容']); $ml['内容']=str_replace('{{时间}}',date("Y-m-d H:i:s", $OSWAP_65f42b1c9e72b14f5b2a8e32a35339b7),$ml['内容']); $ml['内容']=str_replace('{{用户名}}',$OSWAP_21aaa886309ad2236f279bad769775b9['用户名'],$ml['内容']); $ml['标题']=str_replace('{{用户名}}',$OSWAP_21aaa886309ad2236f279bad769775b9['用户名'],$ml['标题']); $ml['内容']=str_replace('{{网站名称}}',$c['网站名称'],$ml['内容']); $ml['标题']=str_replace('{{网站名称}}',$c['网站名称'],$ml['标题']); SendMail($OSWAP_21aaa886309ad2236f279bad769775b9['电子邮件'],$ml['标题'],$ml['内容'],$ml['发信人']); } } add_swap_plug('登陆成功','regkz_qjymnr'); function regkz_checkstr($OSWAP_ebc1cea46ab9ed693efbf5af0301fbd3,$OSWAP_db61ac7f2b5bb497169105f43bf90859){ $OSWAP_8603fb9b740cff42ec850c3931f3fc8e = explode($OSWAP_ebc1cea46ab9ed693efbf5af0301fbd3,$OSWAP_db61ac7f2b5bb497169105f43bf90859); if(count($OSWAP_8603fb9b740cff42ec850c3931f3fc8e)>1){ return true; } else{ return false; } } function regkz_jiancem($OSWAP_eaa75d841caf714dee3173855a8f0e91,$OSWAP_04ef5fb4c99b5d72d460c6c5fb177140){ $OSWAP_04ef5fb4c99b5d72d460c6c5fb177140=str_replace('*','[\s\S]*?' ,$OSWAP_04ef5fb4c99b5d72d460c6c5fb177140); $OSWAP_04ef5fb4c99b5d72d460c6c5fb177140=str_replace('.','\.' ,$OSWAP_04ef5fb4c99b5d72d460c6c5fb177140); $temp=preg_match("/".$OSWAP_04ef5fb4c99b5d72d460c6c5fb177140."/",$OSWAP_eaa75d841caf714dee3173855a8f0e91,$OSWAP_d1685bf2305d21d7ccc9a8d5e3ff4892); return $temp; } function regkz_zfcsig() { $OSWAP_fd77b3fa8649aadcf815c9bd42f9da07 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'; $OSWAP_751b78f3d925aba0024a2e639f5bc86a = ''; for ( $i = 0; $i < 8; $i++ ) {$OSWAP_751b78f3d925aba0024a2e639f5bc86a .= $OSWAP_fd77b3fa8649aadcf815c9bd42f9da07[ mt_rand(0, strlen($OSWAP_fd77b3fa8649aadcf815c9bd42f9da07) - 1) ];} return md5(date('YmdHis').$OSWAP_751b78f3d925aba0024a2e639f5bc86a); } function regkz_hqip(){ if (getenv("HTTP_CLIENT_IP") && strcasecmp(getenv("HTTP_CLIENT_IP"), "unknown")) $OSWAP_b66c72dffd28e4536d052413ce04e270 = getenv("HTTP_CLIENT_IP"); else if (getenv("HTTP_X_FORWARDED_FOR") && strcasecmp(getenv("HTTP_X_FORWARDED_FOR"), "unknown")) $OSWAP_b66c72dffd28e4536d052413ce04e270 = getenv("HTTP_X_FORWARDED_FOR"); else if (getenv("REMOTE_ADDR") && strcasecmp(getenv("REMOTE_ADDR"), "unknown")) $OSWAP_b66c72dffd28e4536d052413ce04e270 = getenv("REMOTE_ADDR"); else if (isset($_SERVER['REMOTE_ADDR']) && $_SERVER['REMOTE_ADDR'] && strcasecmp($_SERVER['REMOTE_ADDR'], "unknown")) $OSWAP_b66c72dffd28e4536d052413ce04e270 = $_SERVER['REMOTE_ADDR']; else $OSWAP_b66c72dffd28e4536d052413ce04e270 = "unknown"; if($OSWAP_b66c72dffd28e4536d052413ce04e270 != "unknown"){ $OSWAP_6e096ef9c03e856847ad1c08e9987ed2=regkz_ipclj($OSWAP_b66c72dffd28e4536d052413ce04e270); if($OSWAP_6e096ef9c03e856847ad1c08e9987ed2!='&nbsp;&nbsp;'){ $OSWAP_5d42918066295831c88fe4fa789452ed ="{$OSWAP_b66c72dffd28e4536d052413ce04e270}  [{$OSWAP_6e096ef9c03e856847ad1c08e9987ed2}]"; }else{ $OSWAP_5d42918066295831c88fe4fa789452ed =$OSWAP_b66c72dffd28e4536d052413ce04e270;} }else{ $OSWAP_5d42918066295831c88fe4fa789452ed =$OSWAP_b66c72dffd28e4536d052413ce04e270; } return $OSWAP_5d42918066295831c88fe4fa789452ed; } function regkz_indexdie($OSWAP_4b9e33692522502a4b437c16a6539d63,$OSWAP_ab131a777348606c1a30d0d687cfbeae='error'){ die(redirect("/index.php/?{$OSWAP_ab131a777348606c1a30d0d687cfbeae}=".regkz_lang($OSWAP_4b9e33692522502a4b437c16a6539d63))); } function regkz_tzl($OSWAP_4b9e33692522502a4b437c16a6539d63,$OSWAP_ab131a777348606c1a30d0d687cfbeae='error'){ $OSWAP_caa3651eeefa5519891613d0c2730fce=plug_eva('regkz',"没验证手机邮箱自定义跳转地址"); if($OSWAP_caa3651eeefa5519891613d0c2730fce=='') $OSWAP_caa3651eeefa5519891613d0c2730fce="/index.php/index/index/"; die(redirect("{$OSWAP_caa3651eeefa5519891613d0c2730fce}?{$OSWAP_ab131a777348606c1a30d0d687cfbeae}=".regkz_lang($OSWAP_4b9e33692522502a4b437c16a6539d63))); } function regkz_ipclj($ip) { $OSWAP_f2c4f49a8eb650e558293517176d4278 = SWAP_ROOT.'qqwry.dat';if(!file_exists($OSWAP_f2c4f49a8eb650e558293517176d4278)) return '&nbsp;&nbsp;'; if(!preg_match('/^((?:(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))\.){3}(?:25[0-5]|2[0-4]\d|((1\d{2})|([1 -9]?\d))))$/', $ip)) {return 'unknown';} if(!$fd = @fopen($OSWAP_f2c4f49a8eb650e558293517176d4278, 'rb')){return 'unknown';} $ip = explode('.', $ip); $OSWAP_88ba2c766e042b57dc818271aa64b8d7 = $ip[0] * 16777216 + $ip[1] * 65536 + $ip[2] * 256 + $ip[3]; $OSWAP_c90d0da2bfdb750fbef4db9d05dc631e = fread($fd, 4); $OSWAP_7e87ee1824419668509bdc89b84a5db9 = fread($fd, 4); $OSWAP_3e6a4e8dd0f957eb71e48173d5414536 = implode('', unpack('L', $OSWAP_c90d0da2bfdb750fbef4db9d05dc631e)); if($OSWAP_3e6a4e8dd0f957eb71e48173d5414536 < 0) $OSWAP_3e6a4e8dd0f957eb71e48173d5414536 += pow(2, 32); $OSWAP_96eae82672442a32719f51f069300b1c = implode('', unpack('L', $OSWAP_7e87ee1824419668509bdc89b84a5db9)); if($OSWAP_96eae82672442a32719f51f069300b1c < 0) $OSWAP_96eae82672442a32719f51f069300b1c += pow(2, 32); $OSWAP_9f2eb9570d0c777fcd58c30e2dfb236f = ($OSWAP_96eae82672442a32719f51f069300b1c - $OSWAP_3e6a4e8dd0f957eb71e48173d5414536) / 7 + 1; $OSWAP_feb319c4572b0abb1e09632a041d6ccf = 0; $OSWAP_fcb9625a0e73d6f11b3f04543c7a77a5 = $OSWAP_9f2eb9570d0c777fcd58c30e2dfb236f; while($OSWAP_ff77f40f3c1d45bd109cc239a1e038f1>$OSWAP_88ba2c766e042b57dc818271aa64b8d7 || $OSWAP_f7a1ef0cc32721542d7e5156759d3fe9<$OSWAP_88ba2c766e042b57dc818271aa64b8d7) { $OSWAP_31517ca3ed4fd330522d30e56ec3db33= intval(($OSWAP_fcb9625a0e73d6f11b3f04543c7a77a5 + $OSWAP_feb319c4572b0abb1e09632a041d6ccf) / 2); fseek($fd, $OSWAP_3e6a4e8dd0f957eb71e48173d5414536 + 7 * $OSWAP_31517ca3ed4fd330522d30e56ec3db33); $OSWAP_4e99d5ac032c0cea213453541a93401f = fread($fd, 4); if(strlen($OSWAP_4e99d5ac032c0cea213453541a93401f) < 4) {fclose($fd);return 'unknown';} $OSWAP_ff77f40f3c1d45bd109cc239a1e038f1 = implode('', unpack('L', $OSWAP_4e99d5ac032c0cea213453541a93401f)); if($OSWAP_ff77f40f3c1d45bd109cc239a1e038f1 < 0) $OSWAP_ff77f40f3c1d45bd109cc239a1e038f1 += pow(2, 32); if($OSWAP_ff77f40f3c1d45bd109cc239a1e038f1 > $OSWAP_88ba2c766e042b57dc818271aa64b8d7) {$OSWAP_fcb9625a0e73d6f11b3f04543c7a77a5 = $OSWAP_31517ca3ed4fd330522d30e56ec3db33;continue;} $OSWAP_69098b4c191a542c1465af50f50523b8 = fread($fd, 3); if(strlen($OSWAP_69098b4c191a542c1465af50f50523b8) < 3) {fclose($fd);return 'unknown';} $OSWAP_69098b4c191a542c1465af50f50523b8 = implode('', unpack('L', $OSWAP_69098b4c191a542c1465af50f50523b8.chr(0))); fseek($fd, $OSWAP_69098b4c191a542c1465af50f50523b8); $OSWAP_8c57e304c8cc64eee6c69996cc87fb29 = fread($fd, 4); if(strlen($OSWAP_8c57e304c8cc64eee6c69996cc87fb29) < 4) {fclose($fd);return 'unknown';} $OSWAP_f7a1ef0cc32721542d7e5156759d3fe9 = implode('', unpack('L', $OSWAP_8c57e304c8cc64eee6c69996cc87fb29)); if($OSWAP_f7a1ef0cc32721542d7e5156759d3fe9 < 0) $OSWAP_f7a1ef0cc32721542d7e5156759d3fe9 += pow(2, 32); if($OSWAP_f7a1ef0cc32721542d7e5156759d3fe9 < $OSWAP_88ba2c766e042b57dc818271aa64b8d7) {if($OSWAP_31517ca3ed4fd330522d30e56ec3db33 == $OSWAP_feb319c4572b0abb1e09632a041d6ccf) {fclose($fd);return 'Unknown';}$OSWAP_feb319c4572b0abb1e09632a041d6ccf = $OSWAP_31517ca3ed4fd330522d30e56ec3db33;} } $OSWAP_16614f64478ce730d56e579934b602a8 = fread($fd, 1); if($OSWAP_16614f64478ce730d56e579934b602a8 == chr(1)) { $OSWAP_ffb113e02cbca0834f4ba568e5bd98bf = fread($fd, 3); if(strlen($OSWAP_ffb113e02cbca0834f4ba568e5bd98bf) < 3) {fclose($fd);return 'unknown';} $OSWAP_ffb113e02cbca0834f4ba568e5bd98bf = implode('', unpack('L', $OSWAP_ffb113e02cbca0834f4ba568e5bd98bf.chr(0))); fseek($fd, $OSWAP_ffb113e02cbca0834f4ba568e5bd98bf); $OSWAP_16614f64478ce730d56e579934b602a8 = fread($fd, 1); } if($OSWAP_16614f64478ce730d56e579934b602a8 == chr(2)) { $OSWAP_13d6fde95b6c9e7a65db10ddc3db46ef = fread($fd, 3); if(strlen($OSWAP_13d6fde95b6c9e7a65db10ddc3db46ef) < 3) {fclose($fd);return 'unknown';} $OSWAP_16614f64478ce730d56e579934b602a8 = fread($fd, 1); if($OSWAP_16614f64478ce730d56e579934b602a8 == chr(2)) {$OSWAP_c6efbe195f2aaf2253a9463c99bfa0dd = fread($fd, 3);if(strlen($OSWAP_c6efbe195f2aaf2253a9463c99bfa0dd) < 3) {fclose($fd);return 'unknown';}$OSWAP_c6efbe195f2aaf2253a9463c99bfa0dd = implode('', unpack('L', $OSWAP_c6efbe195f2aaf2253a9463c99bfa0dd.chr(0)));fseek($fd, $OSWAP_c6efbe195f2aaf2253a9463c99bfa0dd);}else{fseek($fd, -1, SEEK_CUR);} while(($OSWAP_558df879cba220a561478bfb40e13576 = fread($fd, 1)) != chr(0)) $OSWAP_b03f53bffecaad2c207266066b2a0ca6 .= $OSWAP_558df879cba220a561478bfb40e13576; $OSWAP_13d6fde95b6c9e7a65db10ddc3db46ef = implode('', unpack('L', $OSWAP_13d6fde95b6c9e7a65db10ddc3db46ef.chr(0))); fseek($fd, $OSWAP_13d6fde95b6c9e7a65db10ddc3db46ef); while(($OSWAP_558df879cba220a561478bfb40e13576 = fread($fd, 1)) != chr(0)) $OSWAP_0a311df2f3a05040aaa28f7895a9d42f .= $OSWAP_558df879cba220a561478bfb40e13576; } else { fseek($fd, -1, SEEK_CUR); while(($OSWAP_558df879cba220a561478bfb40e13576 = fread($fd, 1)) != chr(0)) $OSWAP_0a311df2f3a05040aaa28f7895a9d42f .= $OSWAP_558df879cba220a561478bfb40e13576; $OSWAP_16614f64478ce730d56e579934b602a8 = fread($fd, 1); if($OSWAP_16614f64478ce730d56e579934b602a8 == chr(2)) {$OSWAP_c6efbe195f2aaf2253a9463c99bfa0dd = fread($fd, 3);if(strlen($OSWAP_c6efbe195f2aaf2253a9463c99bfa0dd) < 3) {fclose($fd);return 'unknown';}$OSWAP_c6efbe195f2aaf2253a9463c99bfa0dd = implode('', unpack('L', $OSWAP_c6efbe195f2aaf2253a9463c99bfa0dd.chr(0)));fseek($fd, $OSWAP_c6efbe195f2aaf2253a9463c99bfa0dd);}else{fseek($fd, -1, SEEK_CUR);} while(($OSWAP_558df879cba220a561478bfb40e13576 = fread($fd, 1)) != chr(0)){$OSWAP_b03f53bffecaad2c207266066b2a0ca6 .= $OSWAP_558df879cba220a561478bfb40e13576;} } fclose($fd); if(preg_match('/http/i', $OSWAP_b03f53bffecaad2c207266066b2a0ca6)) {$OSWAP_b03f53bffecaad2c207266066b2a0ca6 = '';} $OSWAP_60b0b0ac808ab6c914a96b36744b429d = "$OSWAP_0a311df2f3a05040aaa28f7895a9d42f $OSWAP_b03f53bffecaad2c207266066b2a0ca6"; $OSWAP_60b0b0ac808ab6c914a96b36744b429d = preg_replace('/CZ88.Net/is', '', $OSWAP_60b0b0ac808ab6c914a96b36744b429d); $OSWAP_60b0b0ac808ab6c914a96b36744b429d = preg_replace('/^s*/is', '', $OSWAP_60b0b0ac808ab6c914a96b36744b429d); $OSWAP_60b0b0ac808ab6c914a96b36744b429d = preg_replace('/s*$/is', '', $OSWAP_60b0b0ac808ab6c914a96b36744b429d); if(preg_match('/http/i', $OSWAP_60b0b0ac808ab6c914a96b36744b429d) || $OSWAP_60b0b0ac808ab6c914a96b36744b429d == '') {$OSWAP_60b0b0ac808ab6c914a96b36744b429d = 'Unknown';} $OSWAP_60b0b0ac808ab6c914a96b36744b429d=iconv('GB2312', 'UTF-8', $OSWAP_60b0b0ac808ab6c914a96b36744b429d); return $OSWAP_60b0b0ac808ab6c914a96b36744b429d; } function voiceVerify($o){ $debugg=plug_eva('regkz',"语音验证码_沙盒模式"); $o['ServerIP']="app";if($debugg=='on') $o['ServerIP']="sandboxapp"; $o['ServerPort']="8883";$o['SoftVersion']="2013-12-26";$o['AccountSid']=plug_eva('regkz',"语音验证码_ACCOUNT_SID");$o['AccountToken']=plug_eva('regkz',"语音验证码_AUTH_TOKEN");$o['AppId']=plug_eva('regkz',"语音验证码_APP_ID");$o['playTimes']="3"; $t=date("YmdHis"); if($o['ServerIP']=="") return array("statusCode"=>"172004","statusMsg"=>"IP为空"); if($o['ServerPort']<=0) return array("statusCode"=>"172005","statusMsg"=>"端口错误（小于等于0）"); if($o['SoftVersion']=="") return array("statusCode"=>"172013","statusMsg"=>"版本号为空"); if($o['AccountSid']=="") return array("statusCode"=>"172006","statusMsg"=>"主帐号为空"); if($o['AccountToken']=="") return array("statusCode"=>"172007","statusMsg"=>"主帐号令牌为空"); if($o['AppId']=="") return array("statusCode"=>"172012","statusMsg"=>"应用ID为空"); $OSWAP_a0d2a7a636ade48892fc716fbc2724e6= json_encode(array("appId"=>$o['AppId'],"verifyCode"=>$o['verifyCode'],"playTimes"=>$o['playTimes'],"to"=>$o['to'],"respUrl"=>$o['respUrl'],"displayNum"=>$o['displayNum'],"lang"=>"zh","userData"=>$o['userData'],"welcomePrompt"=>$o['welcomePrompt'],"playVerifyCode"=>$o['playVerifyCode'])); if($debugg=='on') file_put_contents(dirname(__FILE__)."\log.txt", "request body = ".$OSWAP_a0d2a7a636ade48892fc716fbc2724e6."\r\n\r\n",FILE_APPEND); $OSWAP_2242be7335da2ac4eec4c32b98a23f00 = strtoupper(md5($o['AccountSid'].$o['AccountToken'].$t)); $OSWAP_caa3651eeefa5519891613d0c2730fce="https://{$o['ServerIP']}.cloopen.com:{$o['ServerPort']}/{$o['SoftVersion']}/Accounts/{$o['AccountSid']}/Calls/VoiceVerify?sig={$OSWAP_2242be7335da2ac4eec4c32b98a23f00}"; if(plug_eva('regkz',"语音验证码_沙盒模式")=='on') file_put_contents(dirname(__FILE__)."\log.txt", "request url = ".$OSWAP_caa3651eeefa5519891613d0c2730fce."\r\n\r\n",FILE_APPEND); $OSWAP_8c9ba0aa97cdddda09d3b6a15a3a264d = base64_encode($o['AccountSid'].":".$t); $ch = curl_init(); $OSWAP_9b79d9ec0a3c571d2037b4537f734bf2= curl_setopt ($ch, CURLOPT_URL,$OSWAP_caa3651eeefa5519891613d0c2730fce); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); curl_setopt ($ch, CURLOPT_HEADER, 0); curl_setopt($ch, CURLOPT_POST, 1); curl_setopt($ch, CURLOPT_POSTFIELDS, $OSWAP_a0d2a7a636ade48892fc716fbc2724e6); curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch,CURLOPT_HTTPHEADER, array("Accept:application/json","Content-Type:application/json;charset=utf-8","Authorization:{$OSWAP_8c9ba0aa97cdddda09d3b6a15a3a264d}")); $OSWAP_9ffd76d6833538fa0eb71a2863c16381 = curl_exec ($ch); if($OSWAP_9ffd76d6833538fa0eb71a2863c16381 == FALSE){ $OSWAP_9ffd76d6833538fa0eb71a2863c16381 = json_encode(array("statusCode"=>"172001","statusMsg"=>"网络错误"));} curl_close($ch); if($debugg=='on') file_put_contents(dirname(__FILE__)."\log.txt", "response body = ".$OSWAP_9ffd76d6833538fa0eb71a2863c16381."\r\n\r\n",FILE_APPEND); return json_decode($OSWAP_9ffd76d6833538fa0eb71a2863c16381,1); } function regkz_isMobile($OSWAP_c8c86244f20e8d61c783550cfd11f029) { if (!is_numeric($OSWAP_c8c86244f20e8d61c783550cfd11f029)) { return false; } return preg_match('#^13[\d]{9}$|^14[5,7]{1}\d{8}$|^15[^4]{1}\d{8}$|^17[0,6,7,8]{1}\d{8}$|^18[\d]{9}$#', $OSWAP_c8c86244f20e8d61c783550cfd11f029) ? true : false; } function apia_money($OSWAP_4304981b33bcabade6b2f99e248f7d8e,$lx='-',$OSWAP_45d86b833af9ac42dbbbe90df32b73f9,$OSWAP_2cd1ffa5780cd314943296144b8bb3c9) { D()->select('用户',"*","`{$OSWAP_4304981b33bcabade6b2f99e248f7d8e[0]}`='{$OSWAP_4304981b33bcabade6b2f99e248f7d8e[1]}'"); $u =D()->fetch_array(); $u['预存款'] =(float)$u['预存款']; $OSWAP_45d86b833af9ac42dbbbe90df32b73f9 =(float)$OSWAP_45d86b833af9ac42dbbbe90df32b73f9; if($lx!='-' && $lx!='+' ) return false; if($lx=='-'){ $ze=$u['预存款']-$OSWAP_45d86b833af9ac42dbbbe90df32b73f9; if($ze<0) return false; }else{ $ze=$u['预存款']+$OSWAP_45d86b833af9ac42dbbbe90df32b73f9; } D()->update('用户',"预存款='{$ze}'","uid='{$u['uid']}'"); apia_addjyjl($u['uid'],$lx,$OSWAP_45d86b833af9ac42dbbbe90df32b73f9,$OSWAP_2cd1ffa5780cd314943296144b8bb3c9); return true; } function apia_addjyjl($OSWAP_fccd0b1902df6b69b12317975e7dd296,$lx,$je,$sm){ $OSWAP_65f42b1c9e72b14f5b2a8e32a35339b7=date("Y-m-d H:i:s"); if(session('apia_addjyjl')!='1'){ SMACSQL()->query("CREATE TABLE IF NOT EXISTS `扩展_交易记录` (  `id` int(11) NOT NULL AUTO_INCREMENT,  `uid` text,  `时间` text,  `类型` text,  `金额` text,  `说明` text,  KEY `id` (`id`)) COLLATE='utf8_general_ci' ENGINE=InnoDB;"); session('apia_addjyjl','1'); } SMACSQL()->insert('扩展_交易记录', "uid,时间,类型,金额,说明","'{$OSWAP_fccd0b1902df6b69b12317975e7dd296}','{$OSWAP_65f42b1c9e72b14f5b2a8e32a35339b7}','{$lx}','{$je}','{$sm}'"); } function regkz_head(){ $OSWAP_fccd0b1902df6b69b12317975e7dd296=session("uid"); $t['手机验证']=plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证手机"); $t['邮箱验证']=plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证邮箱"); TEMPLATE::assign("cjblapi_regkz",$t); $OSWAP_caa3651eeefa5519891613d0c2730fce=mac_url_get(0); if(regkz_eva("注册验证码")=='on' && $OSWAP_caa3651eeefa5519891613d0c2730fce=='register'){ echo '
		<script src="http://static.geetest.com/static/tools/gt.js"></script>
		<script src="/swap_mac/swap_plugins/regkz/jy.js"></script>
		'; } } function regkz_openbuy(){ $OSWAP_fccd0b1902df6b69b12317975e7dd296=session("uid"); if(plug_eva('regkz',"购买产品必须验证手机")=='on'){ if(plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证手机")!='1') regkz_tzl("需要验证手机才可以购买"); } if(plug_eva('regkz',"购买产品必须验证邮箱")=='on'){ if(plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证邮箱")!='1') regkz_tzl("需要验证邮箱才可以购买"); } } function regkz_openddlist(){ $OSWAP_fccd0b1902df6b69b12317975e7dd296=session("uid"); if(plug_eva('regkz',"进入订单管理必须验证手机")=='on'){ if(plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证手机")!='1') regkz_tzl("需要验证手机才可以购买"); } if(plug_eva('regkz',"进入订单管理必须验证邮箱")=='on'){ if(plug_eva('yzmail',"[{$OSWAP_fccd0b1902df6b69b12317975e7dd296}]验证邮箱")!='1') regkz_tzl("需要验证邮箱才可以购买"); } } add_swap_plug("HEAD区域","regkz_head"); add_swap_plug("购买页面初始化","regkz_openbuy"); add_swap_plug("产品控制面板详情","regkz_openddlist"); function regkz_lb(){ $temp=SWAP_XT.SWAP_TEMPLATES_ROOT.SWAP_DIR_END.'plugin'.SWAP_DIR_END.'regkz'.SWAP_DIR_END.'userlist.tpl'; $OSWAP_0d6a95ca6110a130829b3b89409dc878=SWAP_XT. 'swap_plugins'.SWAP_DIR_END.'regkz'.SWAP_DIR_END.'templates'.SWAP_DIR_END.'userlist.tpl'; if(file_exists($temp)){ $OSWAP_eaec98c65853976a8e7d3b43debdc445=$temp; }else{ $OSWAP_eaec98c65853976a8e7d3b43debdc445=$OSWAP_0d6a95ca6110a130829b3b89409dc878; } echo file_get_contents($OSWAP_eaec98c65853976a8e7d3b43debdc445); } add_swap_plug('用户页面列表','regkz_lb'); add_swap_plug('邮件接口','regkz_sendmaile'); function regkz_sendmaile($OSWAP_5097b63628fcee48844852e240864bf7,$OSWAP_c47a26c5776f9863389e5a1085d0a14c,$OSWAP_7eca7b10ad9da05c89652e6425a561b1, $OSWAP_da10c523016facd43f307472a79d4d3b, $OSWAP_1a89e0e863f91d51e1d136d20106f5e3,&$OSWAP_dad9974590539be030578d65ec6e350e){ $OSWAP_dad9974590539be030578d65ec6e350e=sendcloud_mail($OSWAP_7eca7b10ad9da05c89652e6425a561b1, $OSWAP_da10c523016facd43f307472a79d4d3b, $OSWAP_1a89e0e863f91d51e1d136d20106f5e3); } add_swap_plug('邮件日志','regkz_mail_log'); function regkz_mail_log($OSWAP_5097b63628fcee48844852e240864bf7,$OSWAP_c47a26c5776f9863389e5a1085d0a14c,$OSWAP_7eca7b10ad9da05c89652e6425a561b1, $OSWAP_da10c523016facd43f307472a79d4d3b, $OSWAP_1a89e0e863f91d51e1d136d20106f5e3){ if(regkz_eva("启用邮件发送日志")=='on'){ D()->query("CREATE TABLE IF NOT EXISTS  `邮件日志表` (`id` INT(11) NOT NULL AUTO_INCREMENT,`标题` TEXT NOT NULL,`收信人` TEXT NOT NULL,`内容` TEXT NOT NULL,`时间` DATETIME NOT NULL,PRIMARY KEY (`id`))  COLLATE='utf8_general_ci' ENGINE=InnoDB;"); insert_query("邮件日志表",array("标题"=>$OSWAP_da10c523016facd43f307472a79d4d3b,"收信人"=>$OSWAP_7eca7b10ad9da05c89652e6425a561b1,"内容"=>$OSWAP_1a89e0e863f91d51e1d136d20106f5e3,"时间"=>'now()')); } } function regkz_mail_error_log($OSWAP_5157322c8ec5e7c242c8753334c653c9,$OSWAP_7eca7b10ad9da05c89652e6425a561b1, $OSWAP_da10c523016facd43f307472a79d4d3b, $OSWAP_1a89e0e863f91d51e1d136d20106f5e3){ D()->query("CREATE TABLE IF NOT EXISTS  `代发邮件错误日志表` (`id` INT(11) NOT NULL AUTO_INCREMENT,`标题` TEXT NOT NULL,`收信人` TEXT NOT NULL,`内容` TEXT NOT NULL,`错误内容` TEXT NOT NULL,`时间` DATETIME NOT NULL,PRIMARY KEY (`id`))  COLLATE='utf8_general_ci' ENGINE=InnoDB;"); insert_query("代发邮件错误日志表",array("标题"=>$OSWAP_da10c523016facd43f307472a79d4d3b,"收信人"=>$OSWAP_7eca7b10ad9da05c89652e6425a561b1,"内容"=>$OSWAP_1a89e0e863f91d51e1d136d20106f5e3,"时间"=>'now()',"错误内容"=>$OSWAP_5157322c8ec5e7c242c8753334c653c9)); } function sendcloud_mail($OSWAP_7eca7b10ad9da05c89652e6425a561b1, $OSWAP_da10c523016facd43f307472a79d4d3b, $OSWAP_1a89e0e863f91d51e1d136d20106f5e3) { static $OSWAP_4a618683bf2880657489d63d06f56d91; static $OSWAP_e23162d7ca3c8da6a75eefa837f86b80; $t['代发发信邮箱']=regkz_eva("代发发信邮箱"); $t['代发发信名称']=regkz_eva("代发发信名称"); if(empty($t['代发发信邮箱'])) $t['代发发信邮箱']=$OSWAP_4a618683bf2880657489d63d06f56d91; if(empty($t['代发发信名称'])) $t['代发发信名称']=plug_eva('系统配置','邮箱姓名'); if(empty($OSWAP_e23162d7ca3c8da6a75eefa837f86b80)) $OSWAP_e23162d7ca3c8da6a75eefa837f86b80=regkz_eva("开启sendcloud发信"); if($OSWAP_e23162d7ca3c8da6a75eefa837f86b80=='on'){ if(empty($OSWAP_4a618683bf2880657489d63d06f56d91)) $OSWAP_4a618683bf2880657489d63d06f56d91=get_query_val("系统配置","邮箱地址",''); $OSWAP_7c3807a06a591ba1874837f8d2641d92=explode('|',regkz_eva("sendcloud_idkey")); $OSWAP_bf4100ced3f2515e9785f56931bced42=file_get_contents('http://api.sendcloud.net/apiv2/mail/send', FILE_TEXT, stream_context_create(array('http' => array('method' => 'POST','header' => 'Content-Type: application/x-www-form-urlencoded','content' => http_build_query(array('apiUser' => $OSWAP_7c3807a06a591ba1874837f8d2641d92[0],'apiKey' => $OSWAP_7c3807a06a591ba1874837f8d2641d92[1],'from' => $t['代发发信邮箱'],'fromName' => $t['代发发信名称'],'to' => $OSWAP_7eca7b10ad9da05c89652e6425a561b1,'subject' => $OSWAP_da10c523016facd43f307472a79d4d3b,'html' => $OSWAP_1a89e0e863f91d51e1d136d20106f5e3)))))); $OSWAP_aa62203001419794a586d78569b2b02c=json_decode($OSWAP_bf4100ced3f2515e9785f56931bced42,1); $OSWAP_ef7d8dfba906cbb65c236bf33ed2847aCode=$OSWAP_aa62203001419794a586d78569b2b02c['statusCode']; if($OSWAP_ef7d8dfba906cbb65c236bf33ed2847aCode!=200){ regkz_mail_error_log(print_r($OSWAP_aa62203001419794a586d78569b2b02c,1),$OSWAP_7eca7b10ad9da05c89652e6425a561b1, $OSWAP_da10c523016facd43f307472a79d4d3b, $OSWAP_1a89e0e863f91d51e1d136d20106f5e3); return false; } return true; } return false; } ?><?php
 class GeetestLib2 { const GT_SDK_VERSION = 'php_3.2.0'; public static $connectTimeout = 1; public static $OSWAP_e36706f1ccffb18e4005434668bd02f0 = 1; private $OSWAP_e9fc9523aa71fad238744e6567bb7d2f; public function __construct() { $OSWAP_00ac45dbdf862b2399e1f844a4d9b6c8=explode('|',regkz_eva("极验idkey")); $this->OSWAP_6f9bac61ad21476b4b9490b0bb5f0518 = $OSWAP_00ac45dbdf862b2399e1f844a4d9b6c8[0]; $this->OSWAP_8f4f20328d5f24cbe201c8b11dc901b0 = $OSWAP_00ac45dbdf862b2399e1f844a4d9b6c8[1]; } public function pre_process($OSWAP_464bcaa39168428064fd8d28addfacd3 = null) { $OSWAP_caa3651eeefa5519891613d0c2730fce = "http://api.geetest.com/register.php?gt=" . $this->OSWAP_6f9bac61ad21476b4b9490b0bb5f0518; if (($OSWAP_464bcaa39168428064fd8d28addfacd3 != null) and (is_string($OSWAP_464bcaa39168428064fd8d28addfacd3))) { $OSWAP_caa3651eeefa5519891613d0c2730fce = $OSWAP_caa3651eeefa5519891613d0c2730fce . "&user_id=" . $OSWAP_464bcaa39168428064fd8d28addfacd3; } $OSWAP_ed0ffbefe6920bde295465566cdc83a8 = $this->send_request($OSWAP_caa3651eeefa5519891613d0c2730fce); if (strlen($OSWAP_ed0ffbefe6920bde295465566cdc83a8) != 32) { $this->failback_process(); return 0; } $this->success_process($OSWAP_ed0ffbefe6920bde295465566cdc83a8); return 1; } private function success_process($OSWAP_ed0ffbefe6920bde295465566cdc83a8) { $OSWAP_ed0ffbefe6920bde295465566cdc83a8 = md5($OSWAP_ed0ffbefe6920bde295465566cdc83a8 . $this->OSWAP_8f4f20328d5f24cbe201c8b11dc901b0); $OSWAP_9ffd76d6833538fa0eb71a2863c16381 = array( 'success' => 1, 'gt' => $this->OSWAP_6f9bac61ad21476b4b9490b0bb5f0518, 'challenge' => $OSWAP_ed0ffbefe6920bde295465566cdc83a8 ); $this->OSWAP_e9fc9523aa71fad238744e6567bb7d2f = $OSWAP_9ffd76d6833538fa0eb71a2863c16381; } private function failback_process() { $OSWAP_b6aecc3dd8ef8f4b64eb518b2152faf9 = md5(rand(0, 100)); $OSWAP_a104a49705d4ef7f65703e9064321e6d = md5(rand(0, 100)); $OSWAP_ed0ffbefe6920bde295465566cdc83a8 = $OSWAP_b6aecc3dd8ef8f4b64eb518b2152faf9 . substr($OSWAP_a104a49705d4ef7f65703e9064321e6d, 0, 2); $OSWAP_9ffd76d6833538fa0eb71a2863c16381 = array( 'success' => 0, 'gt' => $this->OSWAP_6f9bac61ad21476b4b9490b0bb5f0518, 'challenge' => $OSWAP_ed0ffbefe6920bde295465566cdc83a8 ); $this->OSWAP_e9fc9523aa71fad238744e6567bb7d2f = $OSWAP_9ffd76d6833538fa0eb71a2863c16381; } public function get_response_str() { return json_encode($this->OSWAP_e9fc9523aa71fad238744e6567bb7d2f); } public function get_response() { return $this->OSWAP_e9fc9523aa71fad238744e6567bb7d2f; } public function success_validate($OSWAP_ed0ffbefe6920bde295465566cdc83a8, $OSWAP_f8c2ed46bccff2499ed15e76dff8e4fe, $OSWAP_1bf06e471d527d97d064f4e30787fbfa, $OSWAP_464bcaa39168428064fd8d28addfacd3 = null) { if (!$this->check_validate($OSWAP_ed0ffbefe6920bde295465566cdc83a8, $OSWAP_f8c2ed46bccff2499ed15e76dff8e4fe)) { return 0; } $OSWAP_f9a6a5954ae64a0997de6b2b72d59ee5 = array( "seccode" => $OSWAP_1bf06e471d527d97d064f4e30787fbfa, "sdk" => self::GT_SDK_VERSION, ); if (($OSWAP_464bcaa39168428064fd8d28addfacd3 != null) and (is_string($OSWAP_464bcaa39168428064fd8d28addfacd3))) { $OSWAP_f9a6a5954ae64a0997de6b2b72d59ee5["user_id"] = $OSWAP_464bcaa39168428064fd8d28addfacd3; } $OSWAP_caa3651eeefa5519891613d0c2730fce = "http://api.geetest.com/validate.php"; $OSWAP_ccb7a739df73d45846e9b051b5980016validate = $this->post_request($OSWAP_caa3651eeefa5519891613d0c2730fce, $OSWAP_f9a6a5954ae64a0997de6b2b72d59ee5); if ($OSWAP_ccb7a739df73d45846e9b051b5980016validate == md5($OSWAP_1bf06e471d527d97d064f4e30787fbfa)) { return 1; } else { if ($OSWAP_ccb7a739df73d45846e9b051b5980016validate == "false") { return 0; } else { return 0; } } } public function fail_validate($OSWAP_ed0ffbefe6920bde295465566cdc83a8, $OSWAP_f8c2ed46bccff2499ed15e76dff8e4fe, $OSWAP_1bf06e471d527d97d064f4e30787fbfa) { if ($OSWAP_f8c2ed46bccff2499ed15e76dff8e4fe) { $OSWAP_b180bef2a788cffd27d9cd2961a6c813 = explode("_", $OSWAP_f8c2ed46bccff2499ed15e76dff8e4fe); $OSWAP_a4958e836b1e9d41cdc94f7d053a5090 = $this->decode_response($OSWAP_ed0ffbefe6920bde295465566cdc83a8, $OSWAP_b180bef2a788cffd27d9cd2961a6c813['0']); $OSWAP_6333524d210967ca46150e8e68c9b022 = $this->decode_response($OSWAP_ed0ffbefe6920bde295465566cdc83a8, $OSWAP_b180bef2a788cffd27d9cd2961a6c813['1']); $OSWAP_599dd7612bbbd3ade7a578ac8ced1304 = $this->decode_response($OSWAP_ed0ffbefe6920bde295465566cdc83a8, $OSWAP_b180bef2a788cffd27d9cd2961a6c813['2']); $OSWAP_6b7fdcc1267591d757096b752a1af2b5 = $this->get_failback_pic_ans($OSWAP_6333524d210967ca46150e8e68c9b022, $OSWAP_599dd7612bbbd3ade7a578ac8ced1304); $OSWAP_159f4d008768b70af694fa6cf2670258 = abs($OSWAP_a4958e836b1e9d41cdc94f7d053a5090 - $OSWAP_6b7fdcc1267591d757096b752a1af2b5); if ($OSWAP_159f4d008768b70af694fa6cf2670258 < 4) { return 1; } else { return 0; } } else { return 0; } } private function check_validate($OSWAP_ed0ffbefe6920bde295465566cdc83a8, $OSWAP_f8c2ed46bccff2499ed15e76dff8e4fe) { if (strlen($OSWAP_f8c2ed46bccff2499ed15e76dff8e4fe) != 32) { return false; } if (md5($this->OSWAP_8f4f20328d5f24cbe201c8b11dc901b0 . 'geetest' . $OSWAP_ed0ffbefe6920bde295465566cdc83a8) != $OSWAP_f8c2ed46bccff2499ed15e76dff8e4fe) { return false; } return true; } private function send_request($OSWAP_caa3651eeefa5519891613d0c2730fce) { if (function_exists('curl_exec')) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $OSWAP_caa3651eeefa5519891613d0c2730fce); curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, self::$connectTimeout); curl_setopt($ch, CURLOPT_TIMEOUT, self::$OSWAP_e36706f1ccffb18e4005434668bd02f0); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); $OSWAP_f9a6a5954ae64a0997de6b2b72d59ee5 = curl_exec($ch); if (curl_errno($ch)) { $OSWAP_15f0cf6a192f81e9ea6e5336bb6169fa = sprintf("curl[%s] error[%s]", $OSWAP_caa3651eeefa5519891613d0c2730fce, curl_errno($ch) . ':' . curl_error($ch)); $this->triggerError($OSWAP_15f0cf6a192f81e9ea6e5336bb6169fa); } curl_close($ch); } else { $OSWAP_761bc401ac93cb764335b3637110e8ed = array( 'http' => array( 'method' => "GET", 'timeout' => self::$connectTimeout + self::$OSWAP_e36706f1ccffb18e4005434668bd02f0, ) ); $context = stream_context_create($OSWAP_761bc401ac93cb764335b3637110e8ed); $OSWAP_f9a6a5954ae64a0997de6b2b72d59ee5 = file_get_contents($OSWAP_caa3651eeefa5519891613d0c2730fce, false, $context); } return $OSWAP_f9a6a5954ae64a0997de6b2b72d59ee5; } private function post_request($OSWAP_caa3651eeefa5519891613d0c2730fce, $OSWAP_6c56f0188200b461a3d04a32fb870b4e = '') { if (!$OSWAP_6c56f0188200b461a3d04a32fb870b4e) { return false; } $OSWAP_f9a6a5954ae64a0997de6b2b72d59ee5 = http_build_query($OSWAP_6c56f0188200b461a3d04a32fb870b4e); if (function_exists('curl_exec')) { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $OSWAP_caa3651eeefa5519891613d0c2730fce); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, self::$connectTimeout); curl_setopt($ch, CURLOPT_TIMEOUT, self::$OSWAP_e36706f1ccffb18e4005434668bd02f0); if (!$OSWAP_6c56f0188200b461a3d04a32fb870b4e) { curl_setopt($ch, CURLOPT_USERAGENT, $_SERVER['HTTP_USER_AGENT']); } else { curl_setopt($ch, CURLOPT_POST, 1); curl_setopt($ch, CURLOPT_POSTFIELDS, $OSWAP_f9a6a5954ae64a0997de6b2b72d59ee5); } $OSWAP_f9a6a5954ae64a0997de6b2b72d59ee5 = curl_exec($ch); curl_close($ch); } else { if ($OSWAP_6c56f0188200b461a3d04a32fb870b4e) { $OSWAP_761bc401ac93cb764335b3637110e8ed = array( 'http' => array( 'method' => 'POST', 'header' => "Content-type: application/x-www-form-urlencoded\r\n" . "Content-Length: " . strlen($OSWAP_f9a6a5954ae64a0997de6b2b72d59ee5) . "\r\n", 'content' => $OSWAP_f9a6a5954ae64a0997de6b2b72d59ee5, 'timeout' => self::$connectTimeout + self::$OSWAP_e36706f1ccffb18e4005434668bd02f0 ) ); $context = stream_context_create($OSWAP_761bc401ac93cb764335b3637110e8ed); $OSWAP_f9a6a5954ae64a0997de6b2b72d59ee5 = file_get_contents($OSWAP_caa3651eeefa5519891613d0c2730fce, false, $context); } } return $OSWAP_f9a6a5954ae64a0997de6b2b72d59ee5; } private function decode_response($OSWAP_ed0ffbefe6920bde295465566cdc83a8, $OSWAP_7b40724a6a4bcd0caf127784f566bcf1) { if (strlen($OSWAP_7b40724a6a4bcd0caf127784f566bcf1) > 100) { return 0; } $OSWAP_fa4eb201bc782fbe0e5fd232f42405df = array(); $OSWAP_8f502f8ca79440610bff652cb2d9b25f = array(); $OSWAP_572b2f3447dff253abfe728e6c1e5bf9 = array("0" => 1, "1" => 2, "2" => 5, "3" => 10, "4" => 50); $OSWAP_0cc9208d8884339f2defbc9c3d0e6241 = 0; $OSWAP_9b79d9ec0a3c571d2037b4537f734bf2 = 0; $OSWAP_6b809bff3e11f944940efaecdcbc3253 = str_split($OSWAP_ed0ffbefe6920bde295465566cdc83a8); $OSWAP_fbb5f0badcb98691e13cb56276605b51 = str_split($OSWAP_7b40724a6a4bcd0caf127784f566bcf1); for ($i = 0; $i < strlen($OSWAP_ed0ffbefe6920bde295465566cdc83a8); $i++) { $OSWAP_297b0b099f34538e7dba1ce5823cb0a0 = $OSWAP_6b809bff3e11f944940efaecdcbc3253[$i]; if (in_array($OSWAP_297b0b099f34538e7dba1ce5823cb0a0, $OSWAP_8f502f8ca79440610bff652cb2d9b25f)) { continue; } else { $OSWAP_b180bef2a788cffd27d9cd2961a6c813 = $OSWAP_572b2f3447dff253abfe728e6c1e5bf9[$OSWAP_0cc9208d8884339f2defbc9c3d0e6241 % 5]; array_push($OSWAP_8f502f8ca79440610bff652cb2d9b25f, $OSWAP_297b0b099f34538e7dba1ce5823cb0a0); $OSWAP_0cc9208d8884339f2defbc9c3d0e6241++; $OSWAP_fa4eb201bc782fbe0e5fd232f42405df[$OSWAP_297b0b099f34538e7dba1ce5823cb0a0] = $OSWAP_b180bef2a788cffd27d9cd2961a6c813; } } for ($j = 0; $j < strlen($OSWAP_7b40724a6a4bcd0caf127784f566bcf1); $j++) { $OSWAP_9b79d9ec0a3c571d2037b4537f734bf2 += $OSWAP_fa4eb201bc782fbe0e5fd232f42405df[$OSWAP_fbb5f0badcb98691e13cb56276605b51[$j]]; } $OSWAP_9b79d9ec0a3c571d2037b4537f734bf2 = $OSWAP_9b79d9ec0a3c571d2037b4537f734bf2 - $this->decodeRandBase($OSWAP_ed0ffbefe6920bde295465566cdc83a8); return $OSWAP_9b79d9ec0a3c571d2037b4537f734bf2; } private function get_x_pos_from_str($OSWAP_a7c0dc92a87384467fa87c5fbde9e055) { if (strlen($OSWAP_a7c0dc92a87384467fa87c5fbde9e055) != 5) { return 0; } $OSWAP_113340b6e4d92f1a70977d7f4dfa5a14 = 0; $OSWAP_6a4843989781bfc8fdd19efa0daad7e8 = 200; $OSWAP_113340b6e4d92f1a70977d7f4dfa5a14 = base_convert($OSWAP_a7c0dc92a87384467fa87c5fbde9e055, 16, 10); $OSWAP_9ffd76d6833538fa0eb71a2863c16381 = $OSWAP_113340b6e4d92f1a70977d7f4dfa5a14 % $OSWAP_6a4843989781bfc8fdd19efa0daad7e8; $OSWAP_9ffd76d6833538fa0eb71a2863c16381 = ($OSWAP_9ffd76d6833538fa0eb71a2863c16381 < 40) ? 40 : $OSWAP_9ffd76d6833538fa0eb71a2863c16381; return $OSWAP_9ffd76d6833538fa0eb71a2863c16381; } private function get_failback_pic_ans($OSWAP_5c0e0c39650bd84b0dcffe765361eada, $OSWAP_4da2e26dfe1bca715da4853e96e6ac2b) { $OSWAP_e503029aa822abb46a93d0a26732acc8 = substr(md5($OSWAP_5c0e0c39650bd84b0dcffe765361eada), 0, 9); $OSWAP_af1fa6bbe95435568ffa1b617cf16128 = substr(md5($OSWAP_4da2e26dfe1bca715da4853e96e6ac2b), 10, 9); $OSWAP_444b8ceac45f4ebcb1f2ba838d7ba5ff = ""; for ($i = 0; $i < 9; $i++) { if ($i % 2 == 0) { $OSWAP_444b8ceac45f4ebcb1f2ba838d7ba5ff = $OSWAP_444b8ceac45f4ebcb1f2ba838d7ba5ff . $OSWAP_e503029aa822abb46a93d0a26732acc8[$i]; } elseif ($i % 2 == 1) { $OSWAP_444b8ceac45f4ebcb1f2ba838d7ba5ff = $OSWAP_444b8ceac45f4ebcb1f2ba838d7ba5ff . $OSWAP_af1fa6bbe95435568ffa1b617cf16128[$i]; } } $OSWAP_b27e5073962ad04ed3b0fa9ae059653f = substr($OSWAP_444b8ceac45f4ebcb1f2ba838d7ba5ff, 4, 5); $OSWAP_6b7fdcc1267591d757096b752a1af2b5 = $this->get_x_pos_from_str($OSWAP_b27e5073962ad04ed3b0fa9ae059653f); return $OSWAP_6b7fdcc1267591d757096b752a1af2b5; } private function decodeRandBase($OSWAP_ed0ffbefe6920bde295465566cdc83a8) { $OSWAP_b4ee4aff4d1167f74055390fb5c693a5 = substr($OSWAP_ed0ffbefe6920bde295465566cdc83a8, 32, 2); $tempArray = array(); for ($i = 0; $i < strlen($OSWAP_b4ee4aff4d1167f74055390fb5c693a5); $i++) { $tempAscii = ord($OSWAP_b4ee4aff4d1167f74055390fb5c693a5[$i]); $OSWAP_9ffd76d6833538fa0eb71a2863c16381 = ($tempAscii > 57) ? ($tempAscii - 87) : ($tempAscii - 48); array_push($tempArray, $OSWAP_9ffd76d6833538fa0eb71a2863c16381); } $OSWAP_b141252c10527971faf56b2ce84d89c5 = $tempArray['0'] * 36 + $tempArray['1']; return $OSWAP_b141252c10527971faf56b2ce84d89c5; } private function triggerError($OSWAP_15f0cf6a192f81e9ea6e5336bb6169fa) { trigger_error($OSWAP_15f0cf6a192f81e9ea6e5336bb6169fa); } } 