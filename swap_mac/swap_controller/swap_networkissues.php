<?php  defined('SWAP_ROOT') or die('非法操作'); class swap_networkissues extends controller { function index(){ $lx=mac_url_get(1); $lx=urldecode($lx); if($lx==''){ $OSWAP_15c6b99c98babaf660acd58495510426='开放'; }else if($lx=='1'){ $OSWAP_15c6b99c98babaf660acd58495510426='开放'; }else if($lx=='2'){ $OSWAP_15c6b99c98babaf660acd58495510426='计划中'; }else if($lx=='3'){ $OSWAP_15c6b99c98babaf660acd58495510426='已解决'; } $this->conn->query("select count(*) from 网络故障 where 状态='开放'"); $e['开放的数量']=$this->conn->fetch_array(); $e['开放的数量']=$e['开放的数量']['count(*)']; $this->conn->query("select count(*) from 网络故障 where 状态='计划中'"); $e['计划中的数量']=$this->conn->fetch_array(); $e['计划中的数量']=$e['计划中的数量']['count(*)']; $this->conn->query("select count(*) from 网络故障 where 状态='已解决'"); $e['已解决的数量']=$this->conn->fetch_array(); $e['已解决的数量']=$e['已解决的数量']['count(*)']; TEMPLATE::assign('e',$e); $OSWAP_fd3294d3be61b407cae98b089032c0e4size=10; $this->conn->select('网络故障','count(*)',"状态='$OSWAP_15c6b99c98babaf660acd58495510426'"); $OSWAP_f8c16f19236fd4a7fafdc9fe97e2ea1a = $this->conn->fetch_array(); $OSWAP_b5966f537cc8e7710cdb306ca68f8f18rows=$OSWAP_f8c16f19236fd4a7fafdc9fe97e2ea1a[0]; $OSWAP_fd3294d3be61b407cae98b089032c0e4s=intval($OSWAP_b5966f537cc8e7710cdb306ca68f8f18rows/$OSWAP_fd3294d3be61b407cae98b089032c0e4size); if((mac_url_get(2)!='')and(!strstr(mac_url_get(2),'?'))){ $OSWAP_fd3294d3be61b407cae98b089032c0e4=mac_url_get(2); }else{ $OSWAP_fd3294d3be61b407cae98b089032c0e4=1; } $t=array(); $t['总页数']=$OSWAP_fd3294d3be61b407cae98b089032c0e4s+1; $t['当前页数']=$OSWAP_fd3294d3be61b407cae98b089032c0e4; if($OSWAP_fd3294d3be61b407cae98b089032c0e4==1){ $t['上一页连接']='javascript:return false;'; }else{ $t['上一页连接']=$this->cakurl().'/networkissues/index/'.$lx.'/'.($OSWAP_fd3294d3be61b407cae98b089032c0e4-1).'/'; } if(($OSWAP_fd3294d3be61b407cae98b089032c0e4==($OSWAP_fd3294d3be61b407cae98b089032c0e4s+1))or($OSWAP_fd3294d3be61b407cae98b089032c0e4s=='0')){ $t['下一页连接']='javascript:return false;'; }else{ $t['下一页连接']=$this->cakurl().'/networkissues/index/'.$lx.'/'.($OSWAP_fd3294d3be61b407cae98b089032c0e4+1).'/'; } TEMPLATE::assign('t',$t); $OSWAP_8e5fe8b0072876b7292728c12d5c33ee=$OSWAP_fd3294d3be61b407cae98b089032c0e4size*($OSWAP_fd3294d3be61b407cae98b089032c0e4 - 1); $this->conn->query("select * from 网络故障 where 状态='$OSWAP_15c6b99c98babaf660acd58495510426' order by 最近更新 desc limit $OSWAP_8e5fe8b0072876b7292728c12d5c33ee,$OSWAP_fd3294d3be61b407cae98b089032c0e4size"); $OSWAP_9ad0a90d349c03b274a3c5eff195e14c =array(); while($OSWAP_51d4cad9672e6605c99e0c3d678f456e = $this->conn->fetch_assoc()) { $OSWAP_9ad0a90d349c03b274a3c5eff195e14c[]=$OSWAP_51d4cad9672e6605c99e0c3d678f456e; } TEMPLATE::assign('net',$OSWAP_9ad0a90d349c03b274a3c5eff195e14c); TEMPLATE::display('networkissues.tpl'); } function serverstatus(){ $OSWAP_b33d82f395f5ef712ae68b580dbf13d8=mac_url_get(1); $OSWAP_b8aefb02a820d8893d9f2353e3bd998b=mac_url_get(2); $OSWAP_076b709fc91aae68072f2c80b18fcdf6=mac_url_get(3); if($OSWAP_b33d82f395f5ef712ae68b580dbf13d8=='stats'){ $this->conn->select('服务器表','*',"id='".$OSWAP_b8aefb02a820d8893d9f2353e3bd998b."'"); $OSWAP_f8c16f19236fd4a7fafdc9fe97e2ea1a = $this->conn->fetch_array(); if($OSWAP_f8c16f19236fd4a7fafdc9fe97e2ea1a['服务器状态地址']!=''){ $OSWAP_b621f80804e754a8520827d3b0523910=@file_get_contents($OSWAP_f8c16f19236fd4a7fafdc9fe97e2ea1a['服务器状态地址']); if($OSWAP_b621f80804e754a8520827d3b0523910!='') echo $OSWAP_b621f80804e754a8520827d3b0523910; else{ echo json_encode(array( 'load'=>$this->lang['serverstatus']['不可用'], 'uptime'=>$this->lang['serverstatus']['不可用'], 'phpver'=>$this->lang['serverstatus']['不可用'], 'mysqlver'=>$this->lang['serverstatus']['不可用'], 'zendver'=>$this->lang['serverstatus']['不可用'] )); } }else{ echo json_encode(array( 'load'=>$this->lang['serverstatus']['不可用'], 'uptime'=>$this->lang['serverstatus']['不可用'], 'phpver'=>$this->lang['serverstatus']['不可用'], 'mysqlver'=>$this->lang['serverstatus']['不可用'], 'zendver'=>$this->lang['serverstatus']['不可用'] )); } exit(); }else if($OSWAP_b33d82f395f5ef712ae68b580dbf13d8=='port'){ $this->conn->select('服务器表','*',"id='".$OSWAP_b8aefb02a820d8893d9f2353e3bd998b."'"); $OSWAP_f8c16f19236fd4a7fafdc9fe97e2ea1a = $this->conn->fetch_array(); function ping($OSWAP_94069357985fb2ce32ce7236d060876a,$OSWAP_14635fb92ee0b0e7eddeb8859de672fb){ $fp = @fsockopen($OSWAP_94069357985fb2ce32ce7236d060876a,$OSWAP_14635fb92ee0b0e7eddeb8859de672fb,$OSWAP_f268be7bf536705b15b92a6f559c8ff4,$OSWAP_805dcdbf55a040fa064475ecf3503be4,1); if(!$fp) return false; return true; } if(ping($OSWAP_f8c16f19236fd4a7fafdc9fe97e2ea1a['ip'],$OSWAP_076b709fc91aae68072f2c80b18fcdf6)) echo $this->lang['serverstatus']['正常']; else echo $this->lang['serverstatus']['关闭']; exit(); } $this->conn->select('服务器表','*',"禁用='0'"); $OSWAP_c97540fe0b3c5b2a38ea210c2e542b97 = array(); while($OSWAP_51d4cad9672e6605c99e0c3d678f456e = $this->conn->fetch_assoc()) { $OSWAP_c97540fe0b3c5b2a38ea210c2e542b97[]=$OSWAP_51d4cad9672e6605c99e0c3d678f456e; } TEMPLATE::assign('servers',$OSWAP_c97540fe0b3c5b2a38ea210c2e542b97); TEMPLATE::display('serverstatus.tpl'); } } 