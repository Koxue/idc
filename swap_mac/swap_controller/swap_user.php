<?php  defined('SWAP_ROOT') or die('非法操作'); class swap_user extends controller { function index(){ do_temp_plug('用户页面列表'); TEMPLATE::display('user.tpl'); } function pay(){ do_temp_plug('存款支付网关前端'); do_temp_plug('预存款列表'); do_temp_plug('用户页面列表'); TEMPLATE::display('pay.tpl'); } function password(){ do_temp_plug('用户页面列表'); if(_POST('password')!=''){ $OSWAP_c9d58e6756676f02d347c255bcb6b03b=_POST('password'); $OSWAP_7f227926b90fcca61b2b52d8c4058f1a=_POST('newpassword'); $OSWAP_88003e7369c8d313bb5a3d43056c1107=_POST('renewpassword'); if(($OSWAP_c9d58e6756676f02d347c255bcb6b03b=='')or($OSWAP_7f227926b90fcca61b2b52d8c4058f1a=='')or($OSWAP_88003e7369c8d313bb5a3d43056c1107=='')){ exit(redirect($this->cakurl().'/user/password/?warning='.$this->lang['password']['请添写全部密码'])); } if(!$this->IsUsername($OSWAP_7f227926b90fcca61b2b52d8c4058f1a)){ exit(redirect($this->cakurl().'/user/password/?warning='.$this->lang['password']['新密码格式不正确'])); } if(!$this->IsSame($OSWAP_7f227926b90fcca61b2b52d8c4058f1a,$OSWAP_88003e7369c8d313bb5a3d43056c1107)){ exit(redirect($this->cakurl().'/user/password/?warning='.$this->lang['password']['2次新密码不一样'])); } $this->conn->select('用户','*',"uid='".$this->OSWAP_b59487239706386f068f2549a4adfa62."' and (密码='".md5('swap'.$OSWAP_c9d58e6756676f02d347c255bcb6b03b)."' or 密码=PASSWORD('".$OSWAP_c9d58e6756676f02d347c255bcb6b03b."') or 密码=OLD_PASSWORD('".$OSWAP_c9d58e6756676f02d347c255bcb6b03b."'))"); if($this->conn->db_num_rows()==0){ exit(redirect($this->cakurl().'/user/password/?error='.$this->lang['password']['密码不正确'])); } $this->conn->update('用户',"密码='".md5('swap'.$OSWAP_7f227926b90fcca61b2b52d8c4058f1a)."'","uid='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); do_swap_plug('密码修改成功',$this->OSWAP_b59487239706386f068f2549a4adfa62,$OSWAP_7f227926b90fcca61b2b52d8c4058f1a); exit(redirect($this->cakurl().'/user/password/?success='.$this->lang['password']['密码修改成功'])); } TEMPLATE::display('password.tpl'); } function info(){ do_temp_plug('用户页面列表'); if(_POST('name')!=''){ if((_POST('country')=='')or(_POST('address')=='')or(_POST('zip')=='')){ exit(redirect($this->cakurl().'/user/info/?error='.$this->lang['info']['请填写完整信息'])); } $this->conn->update('用户',"姓名='"._POST('name')."',国家='"._POST('country')."',地址='"._POST('address')."',邮编='"._POST('zip')."'","uid='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); exit(redirect($this->cakurl().'/user/index/?success='.$this->lang['info']['修改个人信息成功'])); } TEMPLATE::display('info.tpl'); } } 