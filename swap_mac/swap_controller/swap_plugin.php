<?php  defined('SWAP_ROOT') or die('非法操作'); class swap_plugin extends controller { function main(){ $OSWAP_d24d2b57d10dc1011c9eb09c5125e396=strtolower($GLOBALS['swap_mac']['method']); $config_name=$OSWAP_d24d2b57d10dc1011c9eb09c5125e396.'_config'; if(($OSWAP_d24d2b57d10dc1011c9eb09c5125e396=='index')or(!file_exists(SWAP_PLUGINS.$OSWAP_d24d2b57d10dc1011c9eb09c5125e396.SWAP_DIR_END.$OSWAP_d24d2b57d10dc1011c9eb09c5125e396.'_controller.php')) or (!function_exists($config_name))) exit(redirect($this->cakurl().'/index/index/')); requirer(SWAP_PLUGINS.$OSWAP_d24d2b57d10dc1011c9eb09c5125e396.SWAP_DIR_END.$OSWAP_d24d2b57d10dc1011c9eb09c5125e396.'_controller.php'); $OSWAP_7e4e3bf3d3a4ea80633ad2986615ceeb=strtolower(mac_url_get(0)); if($OSWAP_7e4e3bf3d3a4ea80633ad2986615ceeb=='') $OSWAP_7e4e3bf3d3a4ea80633ad2986615ceeb='index'; if(!class_exists($OSWAP_d24d2b57d10dc1011c9eb09c5125e396)) die(swap_main_error_module('模块已经损坏',$OSWAP_d24d2b57d10dc1011c9eb09c5125e396)); else $GLOBALS['swap_mac']['plugin']['controller']=new $OSWAP_d24d2b57d10dc1011c9eb09c5125e396; if(!method_exists($GLOBALS['swap_mac']['plugin']['controller'],$OSWAP_7e4e3bf3d3a4ea80633ad2986615ceeb)) die(swap_main_error_module('非法操作',$OSWAP_7e4e3bf3d3a4ea80633ad2986615ceeb)); if(!file_exists(SWAP_PLUGINS.$OSWAP_d24d2b57d10dc1011c9eb09c5125e396.SWAP_DIR_END.'lang'.SWAP_DIR_END.$GLOBALS['swap_mac']['config']['language'].SWAP_DIR_END.'lang_'.$OSWAP_7e4e3bf3d3a4ea80633ad2986615ceeb.'.php')){ $GLOBALS['swap_mac']['config']['language']='Chinese'; if(!file_exists(SWAP_PLUGINS.$OSWAP_d24d2b57d10dc1011c9eb09c5125e396.SWAP_DIR_END.'lang'.SWAP_DIR_END.$GLOBALS['swap_mac']['config']['language'].SWAP_DIR_END.'lang_'.$OSWAP_7e4e3bf3d3a4ea80633ad2986615ceeb.'.php')) die(swap_main_error_module('没有发现插件的语言包,并没有找到默认中文',$OSWAP_d24d2b57d10dc1011c9eb09c5125e396)); } require SWAP_PLUGINS.$OSWAP_d24d2b57d10dc1011c9eb09c5125e396.SWAP_DIR_END.'lang'.SWAP_DIR_END.$GLOBALS['swap_mac']['config']['language'].SWAP_DIR_END.'lang_'.$OSWAP_7e4e3bf3d3a4ea80633ad2986615ceeb.'.php'; isset($lang)?$GLOBALS['swap_mac']['template']->assign("plang",$lang,true):NULL; $GLOBALS['swap_mac']['plugin']['controller']->lang=$lang; TEMPLATE::assign('hostname',$this->c['网站名称'],true); $config=$config_name(); if(isset($lang['title'])) TEMPLATE::assign('title',$lang['title'],true); else{ if(mb_substr($config['swap_plug'], -2)=="插件") $config['swap_plug']=mb_substr($config['swap_plug'], 0, -2); TEMPLATE::assign('title',$config['swap_plug'],true); } TEMPLATE::assign('lang',$this->lang['index']); if(!method_exists($GLOBALS['swap_mac']['plugin']['controller'],'config')) die(swap_main_error_module('插件错误','没有找到插件的模版配置文件')); $conf=$GLOBALS['swap_mac']['plugin']['controller']->config(); if($conf['swap_no_login'][$OSWAP_7e4e3bf3d3a4ea80633ad2986615ceeb]!='1') $this->needlogin(); if($conf[$OSWAP_7e4e3bf3d3a4ea80633ad2986615ceeb]=='1'){ do_temp_plug('用户页面列表'); TEMPLATE::display('plugin_header.tpl'); } TEMPLATE::dir(SWAP_PLUGINS.$OSWAP_d24d2b57d10dc1011c9eb09c5125e396.SWAP_DIR_END.'templates'); $GLOBALS['swap_mac']['plugin_template']='1'; $GLOBALS['swap_mac']['plugin_template_dir']=$OSWAP_d24d2b57d10dc1011c9eb09c5125e396; $GLOBALS['swap_mac']['plugin']['controller']->$OSWAP_7e4e3bf3d3a4ea80633ad2986615ceeb(); if($conf[$OSWAP_7e4e3bf3d3a4ea80633ad2986615ceeb]=='1'){ TEMPLATE::dir('.'.DS.SWAP_TEMPLATES_ROOT.DS); $GLOBALS['swap_mac']['plugin_template']='0'; $GLOBALS['swap_mac']['plugin_template_dir']=''; TEMPLATE::display('plugin_footer.tpl'); } exit(); } } 