<?php  defined('SWAP_ROOT') or die('非法操作'); class swap_control extends controller { function index(){ do_temp_plug("服务页面初始化"); $this->conn->select('服务','*',"帐号id='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); $OSWAP_b7da14f6d30a57d6556466c8bacc5350=array(); while($OSWAP_51d4cad9672e6605c99e0c3d678f456e = $this->conn->fetch_assoc()){ if(strstr($OSWAP_51d4cad9672e6605c99e0c3d678f456e['周期'],'{') or strstr($OSWAP_51d4cad9672e6605c99e0c3d678f456e['周期'],'"\\')){ $OSWAP_51d4cad9672e6605c99e0c3d678f456e['周期']=json_decode($OSWAP_51d4cad9672e6605c99e0c3d678f456e['周期'],true); } $OSWAP_b7da14f6d30a57d6556466c8bacc5350[]=$OSWAP_51d4cad9672e6605c99e0c3d678f456e; } $OSWAP_c97540fe0b3c5b2a38ea210c2e542b97=array(); foreach($OSWAP_b7da14f6d30a57d6556466c8bacc5350 as $temp){ $this->conn->select('产品','*',"id='".$temp['产品id']."'"); $temparry=$this->conn->fetch_array(); $temp['产品类型']=$temparry['名称']; if(strstr($temparry['周期'],'{')){ $temparry['周期']=json_decode($temparry['周期'],true); } $temp['产品周期']=$temparry['周期']; $OSWAP_c97540fe0b3c5b2a38ea210c2e542b97[]=$temp; } TEMPLATE::assign('servers',$OSWAP_c97540fe0b3c5b2a38ea210c2e542b97); TEMPLATE::display('cpanel.tpl'); } function detail(){ $OSWAP_772c54c801ca4abfbd5c33ed8b85403f=mac_url_get(1); if($OSWAP_772c54c801ca4abfbd5c33ed8b85403f=='') exit(redirect($this->cakurl().'/control/index/?error='.$this->lang['error']['服务id为空'])); $this->conn->select('服务','*',"id='".$OSWAP_772c54c801ca4abfbd5c33ed8b85403f."' and 帐号id='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); if($this->conn->db_num_rows()==0) exit(redirect($this->cakurl().'/control/index/?error='.$this->lang['error']['无法找到此服务'])); $OSWAP_b7da14f6d30a57d6556466c8bacc5350=$this->conn->fetch_array(); if(($OSWAP_b7da14f6d30a57d6556466c8bacc5350['状态']!='激活')and($OSWAP_b7da14f6d30a57d6556466c8bacc5350['状态']!='暂停')) exit(redirect($this->cakurl().'/control/index/?warning='.$this->lang['error']['产品已经到期或并未开通!'])); $this->conn->select('产品','*',"id='".$OSWAP_b7da14f6d30a57d6556466c8bacc5350['产品id']."'"); $OSWAP_89720a73ec6cb9a6aca9ad17954ff42d=$this->conn->fetch_array(); if(strstr($OSWAP_b7da14f6d30a57d6556466c8bacc5350['周期'],'{') or strstr($OSWAP_b7da14f6d30a57d6556466c8bacc5350['周期'],'"\\')){ $OSWAP_b7da14f6d30a57d6556466c8bacc5350['周期']=json_decode($OSWAP_b7da14f6d30a57d6556466c8bacc5350['周期'],true); $OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['开启升级选项']=0; } $OSWAP_26f5c7e93f11d85a7328be7da0af3019=true; if(strstr($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期'],'{')){ $OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=json_decode($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期'],true); $temp=array(); foreach($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期'] as $OSWAP_6291cc79354613208317e7b10b238055=>$OSWAP_0d07de59261cc2c9023b194184c575fb){ if($OSWAP_0d07de59261cc2c9023b194184c575fb['启用']&&$OSWAP_0d07de59261cc2c9023b194184c575fb['续费']) $temp[$OSWAP_6291cc79354613208317e7b10b238055]=$OSWAP_0d07de59261cc2c9023b194184c575fb; } $OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['可续期周期']=$temp; $OSWAP_26f5c7e93f11d85a7328be7da0af3019=false; $OSWAP_bb07c2182c42177899751c5f67c92f20=0; }else{ if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']=='免费'){ if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=='日付'){ $OSWAP_bb07c2182c42177899751c5f67c92f20=30; }else if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=='月付'){ $OSWAP_bb07c2182c42177899751c5f67c92f20=1; }else if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=='年付'){ $OSWAP_bb07c2182c42177899751c5f67c92f20=1; } }else $OSWAP_bb07c2182c42177899751c5f67c92f20=round(($this->OSWAP_30b31a94e0c5a437f6c1c6006e473bc5['登陆预存款']/($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']?$OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']:1)),0); } $OSWAP_b7da14f6d30a57d6556466c8bacc5350['密码']=decrypt($OSWAP_b7da14f6d30a57d6556466c8bacc5350['密码']); $this->conn->select('服务器表','*',"id='".$OSWAP_b7da14f6d30a57d6556466c8bacc5350['服务器id']."'"); $OSWAP_c97540fe0b3c5b2a38ea210c2e542b97=$this->conn->fetch_array(); $OSWAP_b7da14f6d30a57d6556466c8bacc5350['ip地址']=$OSWAP_c97540fe0b3c5b2a38ea210c2e542b97['ip']; $OSWAP_b7da14f6d30a57d6556466c8bacc5350['主机名']=$OSWAP_c97540fe0b3c5b2a38ea210c2e542b97['主机名']; $OSWAP_b7da14f6d30a57d6556466c8bacc5350['DNS服务器1']=$OSWAP_c97540fe0b3c5b2a38ea210c2e542b97['DNS服务器1']; $OSWAP_b7da14f6d30a57d6556466c8bacc5350['DNS服务器2']=$OSWAP_c97540fe0b3c5b2a38ea210c2e542b97['DNS服务器2']; $OSWAP_b7da14f6d30a57d6556466c8bacc5350['DNS服务器3']=$OSWAP_c97540fe0b3c5b2a38ea210c2e542b97['DNS服务器3']; $OSWAP_b7da14f6d30a57d6556466c8bacc5350['DNS服务器4']=$OSWAP_c97540fe0b3c5b2a38ea210c2e542b97['DNS服务器4']; $OSWAP_b7da14f6d30a57d6556466c8bacc5350['DNS服务器5']=$OSWAP_c97540fe0b3c5b2a38ea210c2e542b97['DNS服务器5']; $OSWAP_6c5cee550b682ff7d674773f07a17f33=ModuleBuildParams($OSWAP_772c54c801ca4abfbd5c33ed8b85403f); $OSWAP_865aa7615d4c4826c335cc1645f994e2=ServerFunction($OSWAP_6c5cee550b682ff7d674773f07a17f33,'ClientAreaCustomButtonArray'); if($OSWAP_865aa7615d4c4826c335cc1645f994e2!="服务器模块不支持的功能"){ $OSWAP_604b3eb8a563fb94883138d516baf340=$OSWAP_865aa7615d4c4826c335cc1645f994e2; $tempbarray=$OSWAP_604b3eb8a563fb94883138d516baf340; unset($tempbarray['notsee']); TEMPLATE::assign('barray',$tempbarray); }else{ $OSWAP_604b3eb8a563fb94883138d516baf340=array(); TEMPLATE::assign('barray',$OSWAP_604b3eb8a563fb94883138d516baf340); } $a=mac_url_get(2); if($a=='pay'){ if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['禁止续费'] || $OSWAP_b7da14f6d30a57d6556466c8bacc5350['周期']=='一次性') exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?error='.$this->lang['error']['服务禁止续费!!'])); if($OSWAP_26f5c7e93f11d85a7328be7da0af3019){ if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']!='免费'){ $OSWAP_c7ff9a54db2f6defc8cfbefa08395009=round(_POST('day')); if(($OSWAP_c7ff9a54db2f6defc8cfbefa08395009<=0)) exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?warning='.$this->lang['error']['天数错误'])); } if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']=='免费'){ $OSWAP_c7ff9a54db2f6defc8cfbefa08395009=1; }else{ $OSWAP_ae19c156b22bae4ad0694d158f0cddb3=$OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']; $OSWAP_ae19c156b22bae4ad0694d158f0cddb3=($OSWAP_ae19c156b22bae4ad0694d158f0cddb3*$OSWAP_c7ff9a54db2f6defc8cfbefa08395009); } }else{ $OSWAP_0b9d870f05f7e996c462424f26bae27e=_POST('cycleid'); if(!isset($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['可续期周期'][$OSWAP_0b9d870f05f7e996c462424f26bae27e])) exit(redirect($this->cakurl().'/control/index/?error='.$this->lang['error']['不存在的周期'])); $OSWAP_ecd5611555a600e7f5823c5b9e6e1329=$OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['可续期周期'][$OSWAP_0b9d870f05f7e996c462424f26bae27e]; $OSWAP_ae19c156b22bae4ad0694d158f0cddb3=$OSWAP_ecd5611555a600e7f5823c5b9e6e1329['价格']; $OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']=$OSWAP_ecd5611555a600e7f5823c5b9e6e1329['价格']; $OSWAP_c7ff9a54db2f6defc8cfbefa08395009=$OSWAP_ecd5611555a600e7f5823c5b9e6e1329['时间']; } if($this->OSWAP_30b31a94e0c5a437f6c1c6006e473bc5['登陆预存款']<$OSWAP_ae19c156b22bae4ad0694d158f0cddb3) exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?warning='.$this->lang['error']['预存款不足,还差'].($OSWAP_ae19c156b22bae4ad0694d158f0cddb3-$this->OSWAP_30b31a94e0c5a437f6c1c6006e473bc5['登陆预存款']).$this->c['交易币名称'])); $OSWAP_b49c296da6da30d2c546bbebc9f145c1=false; $this->conn->update('服务',"购买数量='".$OSWAP_c7ff9a54db2f6defc8cfbefa08395009."'","id='".$OSWAP_772c54c801ca4abfbd5c33ed8b85403f."' AND 帐号id='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); if($OSWAP_b7da14f6d30a57d6556466c8bacc5350['状态']=='暂停'){ $OSWAP_420735a1bd2987e7155fd1410e5cac94=ServerUnsuspendAccount($OSWAP_772c54c801ca4abfbd5c33ed8b85403f); if($OSWAP_420735a1bd2987e7155fd1410e5cac94=='成功') $OSWAP_b49c296da6da30d2c546bbebc9f145c1=true; }else{ $OSWAP_420735a1bd2987e7155fd1410e5cac94=ServerCustomFunction($OSWAP_772c54c801ca4abfbd5c33ed8b85403f,'ServerRenewalAccount'); if($OSWAP_420735a1bd2987e7155fd1410e5cac94=='成功' or $OSWAP_420735a1bd2987e7155fd1410e5cac94=="服务器模块不支持的功能") $OSWAP_b49c296da6da30d2c546bbebc9f145c1=true; } if($OSWAP_b49c296da6da30d2c546bbebc9f145c1){ if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']=='免费'){ if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=='日付'){ $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday="+ INTERVAL 30 DAY"; }else if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=='月付'){ $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday="+ INTERVAL 1 MONTH"; }else if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=='年付'){ $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday="+ INTERVAL 1 YEAR"; } }else{ $this->conn->update('用户',"预存款='".($this->OSWAP_30b31a94e0c5a437f6c1c6006e473bc5['登陆预存款']-$OSWAP_ae19c156b22bae4ad0694d158f0cddb3)."'","uid='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); if($OSWAP_26f5c7e93f11d85a7328be7da0af3019){ if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=='日付'){ $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday="+ INTERVAL ".$OSWAP_c7ff9a54db2f6defc8cfbefa08395009." DAY"; }else if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=='月付'){ $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday="+ INTERVAL ".$OSWAP_c7ff9a54db2f6defc8cfbefa08395009." MONTH"; }else if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=='年付'){ $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday="+ INTERVAL ".$OSWAP_c7ff9a54db2f6defc8cfbefa08395009." YEAR"; } }else{ $this->conn->update('服务',"周期='".str_replace('\\','\\\\',is_array($OSWAP_ecd5611555a600e7f5823c5b9e6e1329)?json_encode($OSWAP_ecd5611555a600e7f5823c5b9e6e1329):$OSWAP_ecd5611555a600e7f5823c5b9e6e1329)."'","id='".$OSWAP_772c54c801ca4abfbd5c33ed8b85403f."' AND 帐号id='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday="+ INTERVAL ".$OSWAP_ecd5611555a600e7f5823c5b9e6e1329['时间']." DAY"; } } $this->conn->update('服务',"到期时间=到期时间 ".$OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday.",状态='激活',购买数量='".$OSWAP_c7ff9a54db2f6defc8cfbefa08395009."'","id='".$OSWAP_772c54c801ca4abfbd5c33ed8b85403f."' AND 帐号id='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); if($OSWAP_26f5c7e93f11d85a7328be7da0af3019){ if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']=='免费') exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?success='.$this->lang['error']['免费产品已经帮您续期到当前时间的最大续期时间!!'])); } exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?success='.$this->lang['error']['产品续期成功!!'])); }else{ if(strstr($OSWAP_420735a1bd2987e7155fd1410e5cac94,'公开信息:')) exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?warning='.str_replace('公开信息:','',$OSWAP_420735a1bd2987e7155fd1410e5cac94))); exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?error='.$this->lang['error']['请求服务器续期失败!!'])); } }else if($a=='repass'){ $OSWAP_c9d58e6756676f02d347c255bcb6b03b = createServerPassword(); update_query( "服务", array( "密码" => encrypt($OSWAP_c9d58e6756676f02d347c255bcb6b03b) ), array( "id" => $OSWAP_772c54c801ca4abfbd5c33ed8b85403f ) ); if(ServerChangePassword($OSWAP_772c54c801ca4abfbd5c33ed8b85403f)=='成功') exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?success='.$this->lang['error']['重置密码成功!!'])); else{ update_query( "服务", array( "密码" => encrypt($OSWAP_b7da14f6d30a57d6556466c8bacc5350['密码']) ), array( "id" => $OSWAP_772c54c801ca4abfbd5c33ed8b85403f ) ); exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?error='.$this->lang['error']['请求服务器重置密码失败!!'])); } }else if($a=='stop'){ if(ServerTerminateAccount($OSWAP_772c54c801ca4abfbd5c33ed8b85403f)=='成功') exit(redirect($this->cakurl().'/control/index/?success='.$this->lang['error']['停止产品成功,操作不可逆转!!'])); else exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?error='.$this->lang['error']['请求服务器停止服务失败!!'])); }else if($a=='action'){ if($OSWAP_b7da14f6d30a57d6556466c8bacc5350['状态']!='激活') exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?error='.$this->lang['error']['服务不是激活状态!!'])); $f=mac_url_get(3); if($f=='') exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?error='.$this->lang['error']['自定义函数名不能为空!!'])); if(in_array($f,$OSWAP_604b3eb8a563fb94883138d516baf340)){ $OSWAP_4c31c7e36ba871dcf8b7aded1e15f34b=ServerFunction($OSWAP_6c5cee550b682ff7d674773f07a17f33,$f); if($OSWAP_4c31c7e36ba871dcf8b7aded1e15f34b=="成功") exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?success='.$OSWAP_604b3eb8a563fb94883138d516baf340[$f].' '.$this->lang['error']['执行成功!!'])); else exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?error='.$OSWAP_4c31c7e36ba871dcf8b7aded1e15f34b)); }else exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?error='.$this->lang['error']['不允许调用的自定义函数!!'])); } $OSWAP_7999a54850ff6beafac272f0adf91aa2 = ServerClientArea($OSWAP_772c54c801ca4abfbd5c33ed8b85403f); TEMPLATE::assign('payday',$OSWAP_bb07c2182c42177899751c5f67c92f20); TEMPLATE::assign('logins',$OSWAP_7999a54850ff6beafac272f0adf91aa2); add_swap_plug('产品控制面板详情','clientareatemplib'); $this->conn->select('主机配置选项','*',"服务id='".$OSWAP_772c54c801ca4abfbd5c33ed8b85403f."'"); $OSWAP_64ef673aa39c0293f01b6e580402e685=array(); while($OSWAP_51d4cad9672e6605c99e0c3d678f456e = $this->conn->fetch_assoc()){ $OSWAP_64ef673aa39c0293f01b6e580402e685[]=$OSWAP_51d4cad9672e6605c99e0c3d678f456e; } $OSWAP_2ffeee53ec6eab6273dbc15ca8e3e33d=array(); foreach($OSWAP_64ef673aa39c0293f01b6e580402e685 as $OSWAP_51d4cad9672e6605c99e0c3d678f456e){ $this->conn->select('产品配置选项名称','选项名称',"id='".$OSWAP_51d4cad9672e6605c99e0c3d678f456e['选项id']."'"); $temp=$this->conn->fetch_array(); $OSWAP_31bb5897a4cf8155e2d7054f8ef132dd=$temp['选项名称']; $this->conn->select('产品配置选项','选项名称',"id='".$OSWAP_51d4cad9672e6605c99e0c3d678f456e['配置id']."'"); $temp=$this->conn->fetch_array(); $OSWAP_0d07de59261cc2c9023b194184c575fb=$temp['选项名称']; $OSWAP_2ffeee53ec6eab6273dbc15ca8e3e33d[]=array('名称'=>$OSWAP_0d07de59261cc2c9023b194184c575fb,'值'=>$OSWAP_31bb5897a4cf8155e2d7054f8ef132dd); } TEMPLATE::assign('options',$OSWAP_2ffeee53ec6eab6273dbc15ca8e3e33d); $this->conn->select('主机自定义配置选项','*',"服务id='".$OSWAP_772c54c801ca4abfbd5c33ed8b85403f."'"); $config=array(); while($OSWAP_51d4cad9672e6605c99e0c3d678f456e = $this->conn->fetch_assoc()){ $config[]=$OSWAP_51d4cad9672e6605c99e0c3d678f456e; } do_temp_plug('产品控制面板详情',$OSWAP_89720a73ec6cb9a6aca9ad17954ff42d,$OSWAP_b7da14f6d30a57d6556466c8bacc5350,$config); TEMPLATE::assign('goods',$OSWAP_89720a73ec6cb9a6aca9ad17954ff42d); TEMPLATE::assign('server',$OSWAP_b7da14f6d30a57d6556466c8bacc5350); TEMPLATE::assign('configs',$config); TEMPLATE::display('detail.tpl'); } function invoice(){ $OSWAP_772c54c801ca4abfbd5c33ed8b85403f=mac_url_get(1); if($OSWAP_772c54c801ca4abfbd5c33ed8b85403f=='') exit(redirect($this->cakurl().'/control/index/?error='.$this->lang['error']['服务id为空'])); $this->conn->select('服务','*',"id='".$OSWAP_772c54c801ca4abfbd5c33ed8b85403f."' and 帐号id='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); if($this->conn->db_num_rows()==0) exit(redirect($this->cakurl().'/control/index/?error='.$this->lang['error']['无法找到此服务'])); $OSWAP_b7da14f6d30a57d6556466c8bacc5350=$this->conn->fetch_array(); if($OSWAP_b7da14f6d30a57d6556466c8bacc5350['状态']!='等待付款') exit(redirect($this->cakurl().'/control/index/?info='.$this->lang['error']['产品已经进行付款,并已经开通,续期请到管理进行!'])); $this->conn->select('产品','*',"id='".$OSWAP_b7da14f6d30a57d6556466c8bacc5350['产品id']."'"); $OSWAP_89720a73ec6cb9a6aca9ad17954ff42d=$this->conn->fetch_array(); if(strstr($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期'],'{')){ $OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=json_decode($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期'],true); $temp=array(); foreach($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期'] as $OSWAP_6291cc79354613208317e7b10b238055=>$OSWAP_0d07de59261cc2c9023b194184c575fb){ if($OSWAP_0d07de59261cc2c9023b194184c575fb['启用']) $temp[$OSWAP_6291cc79354613208317e7b10b238055]=$OSWAP_0d07de59261cc2c9023b194184c575fb; } $OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=$temp; } if(strstr($OSWAP_b7da14f6d30a57d6556466c8bacc5350['周期'],'{')){ $OSWAP_b7da14f6d30a57d6556466c8bacc5350['周期']=json_decode($OSWAP_b7da14f6d30a57d6556466c8bacc5350['周期'],true); } TEMPLATE::assign('goods',$OSWAP_89720a73ec6cb9a6aca9ad17954ff42d); TEMPLATE::assign('server',$OSWAP_b7da14f6d30a57d6556466c8bacc5350); TEMPLATE::display('invoice.tpl'); } function pay(){ $OSWAP_772c54c801ca4abfbd5c33ed8b85403f=mac_url_get(1); if($OSWAP_772c54c801ca4abfbd5c33ed8b85403f=='') exit(redirect($this->cakurl().'/buy/index/?error='.$this->lang['error']['服务id为空'])); $this->conn->select('服务','*',"id='".$OSWAP_772c54c801ca4abfbd5c33ed8b85403f."' and 帐号id='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); if($this->conn->db_num_rows()==0) exit(redirect($this->cakurl().'/buy/index/?error='.$this->lang['error']['无法找到此服务'])); $temp=$this->conn->fetch_array(); define('CPID',$temp['产品id']); $OSWAP_97a016e66275c6039729b703b9d85f30=CPID; if($OSWAP_97a016e66275c6039729b703b9d85f30=='') exit(redirect($this->cakurl().'/buy/index/?error='.$this->lang['error']['产品id为空'])); $this->conn->select('产品','*',"id='".$OSWAP_97a016e66275c6039729b703b9d85f30."'"); if($this->conn->db_num_rows()==0) exit(redirect($this->cakurl().'/buy/index/?error='.$this->lang['error']['无法找到此产品'])); $OSWAP_9a173a393306a25aca4de03b9f1c4e98=$this->conn->fetch_array(); if($OSWAP_9a173a393306a25aca4de03b9f1c4e98['下架']=='1') exit(redirect($this->cakurl().'/buy/index/?warning='.$this->lang['error']['此产品已经下架'])); if($OSWAP_9a173a393306a25aca4de03b9f1c4e98['只能买一次']){ $this->conn->select('服务','*',"帐号id='".$this->OSWAP_b59487239706386f068f2549a4adfa62."' and (状态='激活' or 状态='暂停' or 状态='等待审核') AND 产品id='".$OSWAP_97a016e66275c6039729b703b9d85f30."'"); if($this->conn->db_num_rows()!=0) exit(redirect($this->cakurl().'/control/index/?error='.$this->lang['error']['这个产品只能买一个,请停止目前的产品后再试!'])); } $OSWAP_26f5c7e93f11d85a7328be7da0af3019=true; if(strstr($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期'],'[')){ $OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']=json_decode($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期'],true); $temp=array(); foreach($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期'] as $OSWAP_6291cc79354613208317e7b10b238055=>$OSWAP_0d07de59261cc2c9023b194184c575fb){ if($OSWAP_0d07de59261cc2c9023b194184c575fb['启用']) $temp[$OSWAP_6291cc79354613208317e7b10b238055]=$OSWAP_0d07de59261cc2c9023b194184c575fb; } $OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']=$temp; $OSWAP_26f5c7e93f11d85a7328be7da0af3019=false; } if($OSWAP_26f5c7e93f11d85a7328be7da0af3019){ if($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']!='一次性'){ $OSWAP_c7ff9a54db2f6defc8cfbefa08395009=round(_POST('days')); if(($OSWAP_c7ff9a54db2f6defc8cfbefa08395009<=0)) exit(redirect($this->cakurl().'/control/index/?error='.$this->lang['error']['天数错误'])); }else $OSWAP_c7ff9a54db2f6defc8cfbefa08395009=1; $OSWAP_ecd5611555a600e7f5823c5b9e6e1329=$OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']; }else{ $OSWAP_0b9d870f05f7e996c462424f26bae27e=_POST('cycleid'); if(!isset($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期'][$OSWAP_0b9d870f05f7e996c462424f26bae27e])) exit(redirect($this->cakurl().'/control/index/?error='.$this->lang['error']['不存在的周期'])); $OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']=$OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期'][$OSWAP_0b9d870f05f7e996c462424f26bae27e]; $OSWAP_ecd5611555a600e7f5823c5b9e6e1329=$OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']['名称']; $OSWAP_9a173a393306a25aca4de03b9f1c4e98['价格']=$OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']['价格']; $OSWAP_9a173a393306a25aca4de03b9f1c4e98['开通方式']=$OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']['自动']?'自动开通':'审核开通'; $OSWAP_c7ff9a54db2f6defc8cfbefa08395009=$OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']['时间']; } if($OSWAP_9a173a393306a25aca4de03b9f1c4e98['价格']=='免费'){ if($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']=='日付'){ if($OSWAP_c7ff9a54db2f6defc8cfbefa08395009>30) exit(redirect($this->cakurl().'/control/index/?error='.$this->lang['error']['免费产品最多买30天'])); }else if($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']=='月付'){ if($OSWAP_c7ff9a54db2f6defc8cfbefa08395009!=1) exit(redirect($this->cakurl().'/control/index/?error='.$this->lang['error']['免费产品最多买1个月'])); }else if($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']=='年付'){ if($OSWAP_c7ff9a54db2f6defc8cfbefa08395009!=1) exit(redirect($this->cakurl().'/control/index/?error='.$this->lang['error']['免费产品最多买1年'])); } } $OSWAP_feca98aae73a7e04beef319618026dfa=0; $OSWAP_d127cd68f7e59c97652e367d3a6eb780=_POST('promocode'); if($OSWAP_d127cd68f7e59c97652e367d3a6eb780!=''){ $this->conn->select('优惠码表','*',"优惠码='".$OSWAP_d127cd68f7e59c97652e367d3a6eb780."'"); if($this->conn->db_num_rows()!=0){ $OSWAP_2822f7e8a80d473ecff69cdf4b7378d2=$this->conn->fetch_array(); $OSWAP_287a254c9f12cdd910b97c773adb4f3b=time(); if($OSWAP_2822f7e8a80d473ecff69cdf4b7378d2['开始时间']!='0000-00-00 00:00:00'){ $OSWAP_b33d82f395f5ef712ae68b580dbf13d8=strtotime($OSWAP_2822f7e8a80d473ecff69cdf4b7378d2['开始时间']); $OSWAP_cf104113aea177d5d1ff1177185f8b8b=$OSWAP_b33d82f395f5ef712ae68b580dbf13d8-$OSWAP_287a254c9f12cdd910b97c773adb4f3b; if($OSWAP_cf104113aea177d5d1ff1177185f8b8b>0) $OSWAP_feca98aae73a7e04beef319618026dfa++; } if($OSWAP_2822f7e8a80d473ecff69cdf4b7378d2['到期时间']!='0000-00-00 00:00:00'){ $OSWAP_b8aefb02a820d8893d9f2353e3bd998b=strtotime($OSWAP_2822f7e8a80d473ecff69cdf4b7378d2['到期时间']); $OSWAP_cf104113aea177d5d1ff1177185f8b8b=$OSWAP_b8aefb02a820d8893d9f2353e3bd998b-$OSWAP_287a254c9f12cdd910b97c773adb4f3b; if($OSWAP_cf104113aea177d5d1ff1177185f8b8b<0) $OSWAP_feca98aae73a7e04beef319618026dfa++; } if($OSWAP_2822f7e8a80d473ecff69cdf4b7378d2['最多使用次数']!='0'){ if($OSWAP_2822f7e8a80d473ecff69cdf4b7378d2['最多使用次数']<=$OSWAP_2822f7e8a80d473ecff69cdf4b7378d2['已经使用次数']) $OSWAP_feca98aae73a7e04beef319618026dfa++; } if($OSWAP_2822f7e8a80d473ecff69cdf4b7378d2['只能一次']){ $this->conn->select('优惠码日志表','*',"优惠码='".$OSWAP_d127cd68f7e59c97652e367d3a6eb780."' AND uid='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); if($this->conn->db_num_rows()!=0) $OSWAP_feca98aae73a7e04beef319618026dfa++; } } }else $OSWAP_feca98aae73a7e04beef319618026dfa=1; if($OSWAP_feca98aae73a7e04beef319618026dfa==0){ if($OSWAP_2822f7e8a80d473ecff69cdf4b7378d2['类型']=='指定产品'){ if($OSWAP_2822f7e8a80d473ecff69cdf4b7378d2['适用产品']!=$OSWAP_97a016e66275c6039729b703b9d85f30) exit(redirect($this->cakurl().'/control/index/?warning='.$this->lang['error']['产品下单成功,但由于使用了不适用产品的优惠码导致无法开通!!'])); } } if($OSWAP_26f5c7e93f11d85a7328be7da0af3019){ if($OSWAP_9a173a393306a25aca4de03b9f1c4e98['价格']=='免费') $OSWAP_ae19c156b22bae4ad0694d158f0cddb3=0; else $OSWAP_ae19c156b22bae4ad0694d158f0cddb3=$OSWAP_9a173a393306a25aca4de03b9f1c4e98['价格']; $OSWAP_ae19c156b22bae4ad0694d158f0cddb3=($OSWAP_ae19c156b22bae4ad0694d158f0cddb3*$OSWAP_c7ff9a54db2f6defc8cfbefa08395009); }else{ $OSWAP_ae19c156b22bae4ad0694d158f0cddb3=$OSWAP_9a173a393306a25aca4de03b9f1c4e98['价格']; } if($OSWAP_feca98aae73a7e04beef319618026dfa==0){ if($OSWAP_2822f7e8a80d473ecff69cdf4b7378d2['价值']>=$OSWAP_ae19c156b22bae4ad0694d158f0cddb3) $OSWAP_64aaf009c819802c1898685c5e146279=1; else $OSWAP_ae19c156b22bae4ad0694d158f0cddb3=($OSWAP_ae19c156b22bae4ad0694d158f0cddb3-$OSWAP_2822f7e8a80d473ecff69cdf4b7378d2['价值']); } if($OSWAP_64aaf009c819802c1898685c5e146279!=1){ if($this->OSWAP_30b31a94e0c5a437f6c1c6006e473bc5['登陆预存款']<$OSWAP_ae19c156b22bae4ad0694d158f0cddb3) exit(redirect($this->cakurl().'/control/index/?warning='.$this->lang['error']['预存款不足,还差'].($OSWAP_ae19c156b22bae4ad0694d158f0cddb3-$this->OSWAP_30b31a94e0c5a437f6c1c6006e473bc5['登陆预存款']).$this->c['交易币名称'])); $this->conn->update('用户',"预存款='".($this->OSWAP_30b31a94e0c5a437f6c1c6006e473bc5['登陆预存款']-$OSWAP_ae19c156b22bae4ad0694d158f0cddb3)."'","uid='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); $OSWAP_64aaf009c819802c1898685c5e146279=1; } if($OSWAP_feca98aae73a7e04beef319618026dfa==0){ $this->conn->update('优惠码表',"已经使用次数=已经使用次数+1","优惠码='".$OSWAP_d127cd68f7e59c97652e367d3a6eb780."'"); $this->conn->insert('优惠码日志表','uid,优惠码',"'".$this->OSWAP_b59487239706386f068f2549a4adfa62."','".$OSWAP_d127cd68f7e59c97652e367d3a6eb780."'"); } if($OSWAP_26f5c7e93f11d85a7328be7da0af3019){ if($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']=='日付'){ $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday="+ INTERVAL ".$OSWAP_c7ff9a54db2f6defc8cfbefa08395009." DAY"; }else if($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']=='月付'){ $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday="+ INTERVAL ".$OSWAP_c7ff9a54db2f6defc8cfbefa08395009." MONTH"; }else if($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']=='年付'){ $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday="+ INTERVAL ".$OSWAP_c7ff9a54db2f6defc8cfbefa08395009." YEAR"; }else if($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']=='一次性'){ $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday=""; } }else{ $this->conn->update('服务',"周期='".str_replace('\\','\\\\',is_array($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期'])?json_encode($OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期']):$OSWAP_9a173a393306a25aca4de03b9f1c4e98['周期'])."'","id='".$OSWAP_772c54c801ca4abfbd5c33ed8b85403f."' AND 帐号id='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); $OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday="+ INTERVAL ".$OSWAP_c7ff9a54db2f6defc8cfbefa08395009." DAY"; } $this->conn->update('服务',"开通时间=now(),到期时间=now() ".$OSWAP_fe7a81a7636f76f8b5ade2206bd80b9eday.",状态='等待审核',购买数量='".$OSWAP_c7ff9a54db2f6defc8cfbefa08395009."',优惠码='".$OSWAP_d127cd68f7e59c97652e367d3a6eb780."',开通付费='".$OSWAP_ae19c156b22bae4ad0694d158f0cddb3."'","id='".$OSWAP_772c54c801ca4abfbd5c33ed8b85403f."' AND 帐号id='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); if($OSWAP_9a173a393306a25aca4de03b9f1c4e98['开通方式']=='自动开通'){ $OSWAP_93e86675a14bf45114306ac2be631499=ServerCreateAccount($OSWAP_772c54c801ca4abfbd5c33ed8b85403f); if($OSWAP_93e86675a14bf45114306ac2be631499=='成功') exit(redirect($this->cakurl().'/control/index/?success='.$this->lang['error']['开通产品成功!'])); else if($OSWAP_93e86675a14bf45114306ac2be631499=='存在的域名') exit(redirect($this->cakurl().'/control/index/?warning='.$this->lang['error']['您开通的域名已经在系统中存在,请停止后再开通!'])); elseif(strstr($OSWAP_93e86675a14bf45114306ac2be631499,'公开信息:')) exit(redirect($this->cakurl().'/control/index/?warning='.str_replace('公开信息:','',$OSWAP_93e86675a14bf45114306ac2be631499))); else exit(redirect($this->cakurl().'/control/index/?warning='.$this->lang['error']['产品下单成功,但产品配置有问题或者通信问题无法自动开通,请质询管理员!'])); }else exit(redirect($this->cakurl().'/control/index/?success='.$this->lang['error']['请管理员等待审核开通!'])); } function package(){ $OSWAP_772c54c801ca4abfbd5c33ed8b85403f=mac_url_get(1); if($OSWAP_772c54c801ca4abfbd5c33ed8b85403f=='') exit(redirect($this->cakurl().'/control/index/?error='.$this->lang['error']['服务id为空'])); $this->conn->select('服务','*',"id='".$OSWAP_772c54c801ca4abfbd5c33ed8b85403f."' and 帐号id='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); if($this->conn->db_num_rows()==0) exit(redirect($this->cakurl().'/control/index/?error='.$this->lang['error']['无法找到此服务'])); $OSWAP_b7da14f6d30a57d6556466c8bacc5350=$this->conn->fetch_array(); if(strstr($OSWAP_b7da14f6d30a57d6556466c8bacc5350['周期'],'{') || $OSWAP_b7da14f6d30a57d6556466c8bacc5350['周期']=='一次性') exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?warning='.$this->lang['error']['当前周期不支持升降级操作!'])); if($OSWAP_b7da14f6d30a57d6556466c8bacc5350['状态']!='激活') exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?info='.$this->lang['error']['产品必须为激活状态下才能进行升降级操作!'])); $this->conn->select('产品','*',"id='".$OSWAP_b7da14f6d30a57d6556466c8bacc5350['产品id']."'"); $OSWAP_89720a73ec6cb9a6aca9ad17954ff42d=$this->conn->fetch_array(); if(!$OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['开启升级选项']) exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?warning='.$this->lang['error']['这个产品不支持升级降级操作'])); $OSWAP_bb2edda852520824a9e29e817bde62e9=json_decode($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['升级包']); $temps=array(); if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=='日付'){ $OSWAP_361ba26c4fe1efbf408ad16ef9b6a043s=round((strtotime($OSWAP_b7da14f6d30a57d6556466c8bacc5350['到期时间'])-time())/3600/24); }else if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=='月付'){ $OSWAP_361ba26c4fe1efbf408ad16ef9b6a043s=round((strtotime($OSWAP_b7da14f6d30a57d6556466c8bacc5350['到期时间'])-time())/3600/24/30); }else if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['周期']=='年付'){ $OSWAP_361ba26c4fe1efbf408ad16ef9b6a043s=round((strtotime($OSWAP_b7da14f6d30a57d6556466c8bacc5350['到期时间'])-time())/3600/24/365); } if($OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']=='免费') $OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']=0; foreach($OSWAP_bb2edda852520824a9e29e817bde62e9 as $temp){ $this->conn->select('产品','*',"id='".$temp."'"); $temps[$temp]=$this->conn->fetch_array(); if($temps[$temp]['价格']=='免费') $temps[$temp]['价格']=0; if($temps[$temp]['价格']>$OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']) $OSWAP_0bead33f7592a3ca9198c6e1c2770086=$temps[$temp]['价格']-$OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']; else $OSWAP_0bead33f7592a3ca9198c6e1c2770086=0; $temps[$temp]['消耗预存款']=($OSWAP_361ba26c4fe1efbf408ad16ef9b6a043s*$OSWAP_0bead33f7592a3ca9198c6e1c2770086); if($this->OSWAP_30b31a94e0c5a437f6c1c6006e473bc5['登陆预存款']>=$temps[$temp]['消耗预存款']) $temps[$temp]['不足预存款']=0.00; else $temps[$temp]['不足预存款']=($temps[$temp]['消耗预存款']-$this->OSWAP_30b31a94e0c5a437f6c1c6006e473bc5['登陆预存款']); } $a=mac_url_get(2); if($a=='submit'){ $OSWAP_e297c143a8c421f2662aec3882494842=_POST('upid'); $this->conn->select('产品','*',"id='".$OSWAP_e297c143a8c421f2662aec3882494842."'"); if($this->conn->db_num_rows()==0) exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?error='.$this->lang['error']['无法找到此服务'])); $OSWAP_5d55d85047d408ef6af45f8e3bd257fa=$this->conn->fetch_array(); if($OSWAP_5d55d85047d408ef6af45f8e3bd257fa['价格']=='免费') $OSWAP_5d55d85047d408ef6af45f8e3bd257fa['价格']=0; if($OSWAP_5d55d85047d408ef6af45f8e3bd257fa['价格']>$OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']) $OSWAP_0bead33f7592a3ca9198c6e1c2770086=$OSWAP_5d55d85047d408ef6af45f8e3bd257fa['价格']-$OSWAP_89720a73ec6cb9a6aca9ad17954ff42d['价格']; else $OSWAP_0bead33f7592a3ca9198c6e1c2770086=0; $OSWAP_5d55d85047d408ef6af45f8e3bd257fa['消耗预存款']=($OSWAP_361ba26c4fe1efbf408ad16ef9b6a043s*$OSWAP_0bead33f7592a3ca9198c6e1c2770086); if($this->OSWAP_30b31a94e0c5a437f6c1c6006e473bc5['登陆预存款']>=$OSWAP_5d55d85047d408ef6af45f8e3bd257fa['消耗预存款']) $OSWAP_5d55d85047d408ef6af45f8e3bd257fa['不足预存款']=0.00; else exit(redirect($this->cakurl().'/control/package/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?warning='.$this->lang['error']['预存款不足,还差'].($OSWAP_5d55d85047d408ef6af45f8e3bd257fa['消耗预存款']-$this->OSWAP_30b31a94e0c5a437f6c1c6006e473bc5['登陆预存款']).$this->c['交易币名称'])); update_query( "服务", array( "产品id" => $OSWAP_e297c143a8c421f2662aec3882494842 ), array( "id" => $OSWAP_772c54c801ca4abfbd5c33ed8b85403f ) ); $OSWAP_420735a1bd2987e7155fd1410e5cac94=ServerChangePackage($OSWAP_772c54c801ca4abfbd5c33ed8b85403f); if($OSWAP_420735a1bd2987e7155fd1410e5cac94=='成功'){ $this->conn->update('用户',"预存款='".($this->OSWAP_30b31a94e0c5a437f6c1c6006e473bc5['登陆预存款']-$OSWAP_5d55d85047d408ef6af45f8e3bd257fa['消耗预存款'])."'","uid='".$this->OSWAP_b59487239706386f068f2549a4adfa62."'"); exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?success='.$this->lang['error']['升降级产品成功!'])); }else{ update_query( "服务", array( "产品id" => $OSWAP_b7da14f6d30a57d6556466c8bacc5350['产品id'] ), array( "id" => $OSWAP_772c54c801ca4abfbd5c33ed8b85403f ) ); if(strstr($OSWAP_420735a1bd2987e7155fd1410e5cac94,'公开信息:')) exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?warning='.str_replace('公开信息:','',$OSWAP_420735a1bd2987e7155fd1410e5cac94))); exit(redirect($this->cakurl().'/control/detail/'.$OSWAP_772c54c801ca4abfbd5c33ed8b85403f.'/?warning='.$this->lang['error']['产品升降级失败,可能是网络通信问题,请质询管理员!'])); } } TEMPLATE::assign('packages',$temps); TEMPLATE::display('package.tpl'); } }